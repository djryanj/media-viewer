{"config":{"lang":["en"],"separator":"[\\s\\-,:!=$$()\"/]+|(?!\\b)(?=[A-Z][a-z])|\\.(?!\\d)|&[lg]t;","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Media Viewer","text":"<p>Media Viewer is a self-hosted web application for browsing, organizing, and viewing your personal media collection. It provides a responsive gallery interface that works seamlessly across desktop and mobile devices, with support for images, videos, and playlists.</p>"},{"location":"#demo","title":"Demo","text":""},{"location":"#desktop-interface","title":"Desktop Interface","text":"<p>Gallery browsing, lightbox viewer, and favorites on desktop</p> <p>Full-text search with tag filtering</p>"},{"location":"#mobile-experience","title":"Mobile Experience","text":"<p>Responsive mobile interface with selection mode and bulk tagging</p> <p>Biometric authentication with passkeys</p>"},{"location":"#key-features","title":"Key Features","text":"<ul> <li>Gallery Browsing: Navigate your media library with an intuitive grid-based interface</li> <li>Infinite Scroll: Seamlessly browse large libraries with automatic pagination</li> <li>Tagging System: Organize media with custom tags for easy categorization and retrieval</li> <li>Favorites: Mark frequently accessed items for quick access</li> <li>Search: Full-text fuzzy search by name, tag, or file type with suggestions</li> <li>Playlists: Play Windows Media Player (.wpl) playlist files</li> <li>Progressive Web App: Install on mobile devices for a native app experience</li> <li>Responsive Design: Optimized for desktop, tablet, and mobile viewing</li> <li>Video Transcoding: Automatic transcoding for browser compatibility</li> <li>Thumbnail Generation: Fast thumbnail generation with incremental updates</li> </ul>"},{"location":"#quick-links","title":"Quick Links","text":""},{"location":"#for-users","title":"For Users","text":"<ul> <li>Installation Guide - Get Media Viewer running on your server</li> <li>Quick Start - Learn the basics in five minutes</li> <li>User Guide - Comprehensive usage documentation</li> <li>Keyboard Shortcuts - Speed up your workflow</li> </ul>"},{"location":"#for-administrators","title":"For Administrators","text":"<ul> <li>Admin Guide - Server administration and monitoring</li> <li>Metrics &amp; Monitoring - Prometheus metrics and performance tuning</li> <li>Security - Authentication and security best practices</li> </ul>"},{"location":"#for-developers","title":"For Developers","text":"<ul> <li>Architecture - System design and technical overview</li> <li>Testing Guide - Writing and running tests</li> <li>Contributing - How to contribute to the project</li> </ul>"},{"location":"#system-requirements","title":"System Requirements","text":""},{"location":"#production-docker-recommended","title":"Production (Docker - Recommended)","text":"<ul> <li>Docker and Docker Compose</li> <li>Modern web browser (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)</li> <li>Sufficient storage for media files and thumbnail cache</li> </ul>"},{"location":"#production-from-source","title":"Production (From Source)","text":"<ul> <li>Go 1.21 or later</li> <li>FFmpeg (for video transcoding and thumbnail generation)</li> <li>GCC (for SQLite CGO compilation)</li> <li>Modern web browser (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)</li> <li>Sufficient storage for media files and thumbnail cache</li> </ul>"},{"location":"#development","title":"Development","text":"<ul> <li>All production requirements (from source)</li> <li>Node.js 18+ (for frontend tooling: linting, formatting, live reload)</li> <li>Make (optional, for build automation)</li> </ul> <p>Note: Node.js is only required for development. The frontend is static HTML/CSS/JavaScript and does not require a Node.js runtime in production.</p>"},{"location":"#support","title":"Support","text":"<p>For bug reports and feature requests, visit the GitHub Issues page.</p>"},{"location":"faq/","title":"Frequently Asked Questions","text":"<p>Common questions about Media Viewer features, setup, and usage.</p>"},{"location":"faq/#general","title":"General","text":""},{"location":"faq/#what-is-media-viewer","title":"What is Media Viewer?","text":"<p>Media Viewer is a self-hosted web application for browsing and organizing your personal media collection. It provides a clean interface for viewing images and videos, with features like tagging, favorites, search, and progressive web app (PWA) support for mobile devices</p>"},{"location":"faq/#why-did-you-make-this-why-not-use-insert-favorite-app-here","title":"Why did you make this? Why not use \\&lt;insert favorite app here&gt;","text":"<p>The short version is because those apps didn't meet my needs, so I wrote this. This is not intended to replace those apps per se (I still use Immich, for example), but if you find it useful and compatible with what you want, great!</p>"},{"location":"faq/#diddo-you-use-ai-to-help-write-this","title":"Did/do you use AI to help write this?","text":"<p>AI has been used throughout the development of this project as an assistant. Have a look at the AI disclosure document in the repo.</p>"},{"location":"faq/#is-this-a-media-manager-app","title":"Is this a media manager app?","text":"<p>NO. The intention behind this app is one of viewing, meaning read-only access to the underlying library. The library features (tagging, favorites, etc.) are included to help search for what you want, but they are completely self-contained in the app.</p>"},{"location":"faq/#can-i-upload-media-through-the-app-to-my-library","title":"Can I upload media through the app to my library?","text":"<p>NO. As above, this is intended as a viewer, not a manager. There is no intention of including this as a feature.</p>"},{"location":"faq/#is-it-vibe-coded","title":"Is it vibe coded?","text":"<p>Like most things in the AI space, I think the term \"vibe coded\" is evolving. Initially, it meant any use of AI tools to generate code focusing on \"vibes\" rather than line-by-line coding and by that definition, the answer is yes.</p> <p>However (and maybe I'm just saying this to make myself feel better), I think that true vibe coding is done by people who have no idea how to code and won't recognize problems in the code generated by AI. While I won't claim to be an expert developer, the amount of time I have spent diving deep into the code output by AI during the development of this application is likely far higher than your average \"vibe coded in a weekend\" project.</p>"},{"location":"faq/#is-media-viewer-free","title":"Is Media Viewer free?","text":"<p>Yes, Media Viewer is open source and free to use. It's licensed under the MIT License.</p>"},{"location":"faq/#can-multiple-users-access-media-viewer","title":"Can multiple users access Media Viewer?","text":"<p>Media Viewer is designed as a single-user application. While multiple people can use the same account, there's only one password and one set of favorites, tags, and preferences.</p>"},{"location":"faq/#why-did-you-include-webauthnpasskeys","title":"Why did you include WebAuthN/passkeys?","text":"<p>Being able to log in to the app on my mobile device with a fingerprint was a great quality of life improvement for the application. It should be noted that I don't really consider it a security feature (even though it does increase the security of the application if passkeys are used), largely because it's a single-user app that is not designed to be exposed to the web; it's purely for convenience when accessing the app.</p>"},{"location":"faq/#what-file-formats-are-supported","title":"What file formats are supported?","text":"<p>Media Viewer supports:</p> <ul> <li>Images: JPEG, PNG, GIF, WebP, BMP, and other formats supported by browsers</li> <li>Videos: MP4, WebM, MOV, AVI, MKV, and other formats (automatically transcoded if needed)</li> <li>Playlists: Windows Media Player (.wpl) format</li> </ul>"},{"location":"faq/#why-windows-media-player-playlists","title":"Why Windows Media Player playlists?","text":"<p>Because I have one particular playlist that I use often that is in that format.</p> <p>Other playlist functionality is planned.</p>"},{"location":"faq/#do-i-need-a-powerful-server-to-run-media-viewer","title":"Do I need a powerful server to run Media Viewer?","text":"<p>No. Media Viewer is lightweight and runs efficiently on:</p> <ul> <li>Raspberry Pi (ARM64)</li> <li>Small VPS instances</li> <li>NAS devices</li> <li>Desktop computers</li> </ul> <p>Memory usage scales with library size, but most collections run well with 512MB-1GB RAM.</p>"},{"location":"faq/#installation-setup","title":"Installation &amp; Setup","text":""},{"location":"faq/#how-do-i-install-media-viewer","title":"How do I install Media Viewer?","text":"<p>The easiest method is using Docker Compose. See the Installation Guide for detailed instructions.</p>"},{"location":"faq/#can-i-run-media-viewer-without-docker","title":"Can I run Media Viewer without Docker?","text":"<p>Yes, you can build and run Media Viewer directly from source. You'll need:</p> <ul> <li>Go 1.21 or higher</li> <li>FFmpeg installed</li> <li>CGO enabled (for SQLite FTS5 support)</li> </ul> <p>See Installation from Source for details.</p>"},{"location":"faq/#how-do-i-set-up-the-initial-password","title":"How do I set up the initial password?","text":"<p>On first launch, Media Viewer will prompt you to create a password through the web interface. You can change it later in the Settings menu, or if you forget it, use the <code>resetpw</code> utility to reset it.</p>"},{"location":"faq/#what-directories-need-to-be-mounted","title":"What directories need to be mounted?","text":"<p>Three directories are recommended:</p> <ol> <li>Media directory (<code>/media</code>): Your photos and videos (read-only)</li> <li>Cache directory (<code>/cache</code>): Thumbnails and transcoded videos</li> <li>Database directory (<code>/database</code>): SQLite database and metadata</li> </ol>"},{"location":"faq/#features","title":"Features","text":""},{"location":"faq/#how-does-search-work","title":"How does search work?","text":"<p>Media Viewer uses SQLite FTS5 (Full-Text Search) with trigram tokenization for fuzzy filename matching. You can also search by tags using <code>tag:tagname</code> syntax or exclude tags with <code>-tag:tagname</code>. See the Search Guide for details.</p>"},{"location":"faq/#what-are-tags-and-how-do-i-use-them","title":"What are tags and how do I use them?","text":"<p>Tags are labels you can assign to files for organization. Examples: \"vacation\", \"family\", \"2024\". You can:</p> <ul> <li>Add tags via the tag button on items</li> <li>Bulk tag multiple items in selection mode</li> <li>Search by tag using <code>tag:tagname</code></li> <li>Click any tag to search for items with that tag</li> </ul> <p>See the Tagging Guide for more information.</p>"},{"location":"faq/#what-are-favorites","title":"What are favorites?","text":"<p>Favorites are items you pin to the top of your home page for quick access. They appear in a special section above the regular gallery.</p>"},{"location":"faq/#can-i-organize-files-into-albums","title":"Can I organize files into albums?","text":"<p>Media Viewer doesn't create albums, but you can:</p> <ul> <li>Use your existing folder structure (folders appear as navigable directories)</li> <li>Use tags to create virtual collections (e.g., tag items with \"vacation 2024\")</li> <li>Add items to favorites for a quick access collection</li> </ul> <p>Note that this functionality is planned.</p>"},{"location":"faq/#does-media-viewer-support-playlists","title":"Does Media Viewer support playlists?","text":"<p>Yes, Media Viewer supports Windows Media Player (.wpl) playlist files. It will display playlist files in the gallery, and clicking them opens a video player with the playlist contents.</p>"},{"location":"faq/#can-you-create-playlists-in-the-app","title":"Can you create playlists in the app?","text":"<p>No, Media Viewer does not currently have this functionality, but it is planned.</p>"},{"location":"faq/#what-is-pwa-mode","title":"What is PWA mode?","text":"<p>Progressive Web App (PWA) mode allows you to \"install\" Media Viewer on mobile devices. It provides:</p> <ul> <li>Home screen icon</li> <li>Full-screen viewing</li> <li>Faster load times</li> </ul> <p>See PWA Support for details.</p>"},{"location":"faq/#what-are-passkeys-webauthn","title":"What are passkeys (WebAuthn)?","text":"<p>Passkeys are a modern authentication method using biometrics (fingerprint, face recognition) or hardware security keys. They're more secure and convenient than passwords. See WebAuthn/Passkeys Guide.</p>"},{"location":"faq/#thumbnails-caching","title":"Thumbnails &amp; Caching","text":""},{"location":"faq/#how-are-thumbnails-generated","title":"How are thumbnails generated?","text":"<p>Thumbnails are generated:</p> <ol> <li>On-demand when you first view a file</li> <li>In background batches after indexing completes</li> </ol> <p>They're stored in the cache directory for fast subsequent access.</p>"},{"location":"faq/#why-are-my-thumbnails-blurry-or-low-quality","title":"Why are my thumbnails blurry or low quality?","text":"<p>Thumbnails are intentionally small (300x300px by default) for fast loading. To view full quality, click the item to open it in the lightbox viewer.</p>"},{"location":"faq/#how-do-i-regenerate-thumbnails","title":"How do I regenerate thumbnails?","text":"<ol> <li>Open Settings (gear icon)</li> <li>Go to the \"Cache\" tab</li> <li>Click \"Regenerate Thumbnails\"</li> </ol> <p>This will delete all thumbnails and regenerate them on next access.</p>"},{"location":"faq/#how-much-disk-space-do-thumbnails-use","title":"How much disk space do thumbnails use?","text":"<p>Thumbnail size varies by library, but expect roughly:</p> <ul> <li>20-50 KB per image thumbnail</li> <li>50-100 KB per video thumbnail</li> </ul> <p>For a library of 10,000 files, thumbnails typically use 300-700 MB.</p>"},{"location":"faq/#video-playback","title":"Video Playback","text":""},{"location":"faq/#why-do-some-videos-need-to-transcode","title":"Why do some videos need to transcode?","text":"<p>Videos are transcoded if your browser doesn't natively support the codec. Media Viewer automatically detects this and transcodes to H.264/AAC (MP4), which is universally supported.</p>"},{"location":"faq/#how-long-does-transcoding-take","title":"How long does transcoding take?","text":"<p>Transcoding is done in real-time as you watch. The video starts playing within seconds, and transcoding continues in the background. Transcoded files are cached for future viewing.</p>"},{"location":"faq/#can-i-disable-transcoding","title":"Can I disable transcoding?","text":"<p>Transcoding happens automatically only when needed. If your videos are already in browser-compatible formats (H.264/H.265), they'll stream directly without transcoding.</p>"},{"location":"faq/#where-are-transcoded-videos-stored","title":"Where are transcoded videos stored?","text":"<p>Transcoded videos are stored in the cache directory under the <code>transcode/</code> subdirectory. They're kept for future viewing to avoid re-transcoding.</p>"},{"location":"faq/#performance","title":"Performance","text":""},{"location":"faq/#why-is-indexing-slow-on-my-nasnfs-share","title":"Why is indexing slow on my NAS/NFS share?","text":"<p>Network filesystems add latency to each file operation. To improve performance:</p> <ul> <li>Use <code>async</code> mount option for NFS</li> <li>Increase <code>INDEX_INTERVAL</code> to reduce frequency</li> <li>Monitor filesystem metrics to identify bottlenecks</li> </ul> <p>See Troubleshooting for more details.</p>"},{"location":"faq/#how-can-i-monitor-performance","title":"How can I monitor performance?","text":"<p>Media Viewer exposes Prometheus metrics on port 9090 internally (port 9091 when using Docker Compose). You can use Grafana or other monitoring tools to visualize:</p> <ul> <li>Memory usage</li> <li>Indexing performance</li> <li>Filesystem latency</li> <li>Search response times</li> </ul> <p>See Metrics &amp; Monitoring for details.</p>"},{"location":"faq/#my-gallery-loads-slowly-what-can-i-do","title":"My gallery loads slowly. What can I do?","text":"<ul> <li>Organize files into subdirectories (avoid 10,000+ files in one folder)</li> <li>Ensure thumbnails are generated</li> <li>Check network connection if accessing remotely</li> <li>Monitor server resources (CPU, memory, disk I/O)</li> </ul>"},{"location":"faq/#security-privacy","title":"Security &amp; Privacy","text":""},{"location":"faq/#is-media-viewer-secure","title":"Is Media Viewer secure?","text":"<p>Media Viewer includes several security features:</p> <ul> <li>Password and/or passkey authentication</li> <li>Session management with configurable timeouts</li> <li>HTTPS support (when configured behind a reverse proxy)</li> <li>Read-only media mounting option</li> </ul> <p>See Security for best practices.</p>"},{"location":"faq/#should-i-expose-media-viewer-to-the-internet","title":"Should I expose Media Viewer to the internet?","text":"<p>Media Viewer is designed for personal/private use and it is not recommended to expose it to the internet. The app has some security features built into the backend to avoid common problems, but has not been tested to be secure when exposed.</p> <p>However, if you must:</p> <ul> <li>Use a reverse proxy with HTTPS, or something like CloudFlare tunnels</li> <li>Set up strong authentication (passkeys recommended)</li> <li>Consider VPN access instead of public exposure</li> <li>Keep the software updated</li> </ul>"},{"location":"faq/#how-is-my-password-stored","title":"How is my password stored?","text":"<p>Passwords are hashed using bcrypt before storage. The plaintext password is never stored in the database.</p>"},{"location":"faq/#what-data-does-media-viewer-collect","title":"What data does Media Viewer collect?","text":"<p>Media Viewer is self-hosted and collects no data. All information stays on your server:</p> <ul> <li>File metadata (paths, sizes, dates)</li> <li>Tags and favorites you create</li> <li>Thumbnails and transcoded videos</li> <li>Authentication credentials (hashed)</li> </ul>"},{"location":"faq/#troubleshooting","title":"Troubleshooting","text":""},{"location":"faq/#i-forgot-my-password-how-do-i-reset-it","title":"I forgot my password. How do I reset it?","text":"<p>Use the <code>resetpw</code> utility:</p> <pre><code>docker exec -it &lt;container-name&gt; resetpw\n</code></pre> <p>See Troubleshooting for details.</p>"},{"location":"faq/#thumbnails-arent-showing-up-whats-wrong","title":"Thumbnails aren't showing up. What's wrong?","text":"<p>Use the \"Rebuild Thumbnails\" button in the Settings (Gear Icon -&gt; Cache tab -&gt; Rebuild Thumbnails). Let the process run for a few minutes, then reload the page.</p> <p>If that doesn't work, check:</p> <ol> <li>Cache directory is writable</li> <li>FFmpeg is available (for video thumbnails)</li> <li>Server logs for errors during thumbnail generation</li> <li>Disk space in cache directory</li> </ol> <p>See Troubleshooting for more solutions.</p>"},{"location":"faq/#the-gallery-is-empty-where-are-my-files","title":"The gallery is empty. Where are my files?","text":"<p>Verify:</p> <ol> <li>Media directory is mounted correctly (<code>docker exec -it &lt;container&gt; ls /media</code>)</li> <li>Files have supported extensions</li> <li>Indexing has completed (check logs)</li> <li>File permissions allow reading</li> </ol> <p>See Troubleshooting.</p>"},{"location":"faq/#media-viewer-is-using-too-much-memory-how-do-i-fix-it","title":"Media Viewer is using too much memory. How do I fix it?","text":"<p>During development, a library containing roughly 40,000 miscellaneous items is the target and memory usage was aggressively tuned. Thumbnail generation takes the most memory and because of how Go handles it, that size of library will typically cause the container to use between 1Gb and 1.5 Gb of memory, which will then drop to around 600-700 Mb for a steady state.</p> <ol> <li>Set <code>GOMEMLIMIT</code> environment variable to cap memory usage. Note that this might cause the container to get killed by Docker/Kubernetes.</li> <li>Reduce <code>THUMBNAIL_INTERVAL</code> frequency for very large libraries</li> <li>Reduce <code>INDEX_INTERVAL</code> frequency for very large libraries</li> <li>Monitor with Prometheus metrics</li> <li>Restart container periodically if needed</li> </ol> <p>See Troubleshooting.</p>"},{"location":"faq/#advanced-topics","title":"Advanced Topics","text":""},{"location":"faq/#can-i-customize-the-interface","title":"Can I customize the interface?","text":"<p>Currently, Media Viewer doesn't support themes or extensive customization. The interface is optimized for the default dark mode style.</p>"},{"location":"faq/#does-media-viewer-support-raw-image-files","title":"Does Media Viewer support RAW image files?","text":"<p>Media Viewer displays whatever your browser can render. Most browsers don't natively support RAW formats (CR2, NEF, ARW, etc.). You would need to convert RAW files to JPEG/PNG first.</p>"},{"location":"faq/#can-i-use-media-viewer-for-music-or-audio-files","title":"Can I use Media Viewer for music or audio files?","text":"<p>Media Viewer is designed specifically for images and videos. Audio files aren't currently supported.</p>"},{"location":"faq/#how-do-i-back-up-my-media-viewer-data","title":"How do I back up my Media Viewer data?","text":"<p>Back up these directories:</p> <ol> <li>Database directory: Contains SQLite database with tags, favorites, and metadata</li> <li>Cache directory (optional): Contains thumbnails and transcoded videos (can be regenerated)</li> </ol> <p>Your original media files should have their own backup strategy.</p>"},{"location":"faq/#can-i-contribute-to-media-viewer","title":"Can I contribute to Media Viewer?","text":"<p>Yes! Media Viewer is open source. See the Contributing Guide for how to:</p> <ul> <li>Report bugs</li> <li>Suggest features</li> <li>Submit pull requests</li> <li>Improve documentation</li> </ul>"},{"location":"faq/#getting-help","title":"Getting Help","text":""},{"location":"faq/#where-can-i-get-support","title":"Where can I get support?","text":"<ul> <li>Check the Documentation</li> <li>Review Troubleshooting</li> <li>Search GitHub Issues</li> <li>Open a new issue if your problem isn't covered</li> </ul>"},{"location":"faq/#how-do-i-report-a-bug","title":"How do I report a bug?","text":"<p>Open an issue on GitHub with:</p> <ul> <li>Media Viewer version</li> <li>Deployment method (Docker, source, etc.)</li> <li>Steps to reproduce</li> <li>Expected vs. actual behavior</li> <li>Relevant log output</li> </ul>"},{"location":"faq/#how-do-i-request-a-feature","title":"How do I request a feature?","text":"<p>Open a feature request on GitHub describing:</p> <ul> <li>What you'd like to accomplish</li> <li>Why it would be useful</li> <li>Any relevant examples from other applications</li> </ul>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<p>Solutions to common issues with Media Viewer.</p>"},{"location":"troubleshooting/#login-issues","title":"Login Issues","text":""},{"location":"troubleshooting/#cannot-log-in","title":"Cannot Log In","text":"<p>Symptoms: Password is rejected even though it's correct.</p> <p>Solutions:</p> <ol> <li>Verify you're entering the correct password (passwords are case-sensitive)</li> <li>Try using the <code>resetpw</code> utility if you've forgotten your password</li> <li>Check server logs for authentication errors</li> <li>Try restarting the container</li> </ol>"},{"location":"troubleshooting/#session-expires-quickly","title":"Session Expires Quickly","text":"<p>Symptoms: Frequently logged out while actively using the application.</p> <p>Solutions:</p> <ol> <li>Increase <code>SESSION_DURATION</code> in your configuration</li> <li>Check for network issues that might interrupt keepalive requests</li> <li>Ensure your browser accepts cookies</li> </ol>"},{"location":"troubleshooting/#display-issues","title":"Display Issues","text":""},{"location":"troubleshooting/#thumbnails-not-loading","title":"Thumbnails Not Loading","text":"<p>Symptoms: Gallery shows placeholder icons instead of thumbnails.</p> <p>Solutions:</p> <ol> <li>Wait for thumbnail generation (first load takes time)</li> <li>Check that the data directory is writable</li> <li>Clear and rebuild thumbnails using the cache button</li> <li>Check server logs for errors</li> </ol>"},{"location":"troubleshooting/#gallery-is-empty","title":"Gallery Is Empty","text":"<p>Symptoms: No items appear in the gallery.</p> <p>Solutions:</p> <ol> <li>Verify the media directory is mounted correctly</li> <li>Check that media files have supported extensions</li> <li>Verify file permissions allow reading</li> <li>Check server logs for indexing errors</li> </ol>"},{"location":"troubleshooting/#layout-issues-on-mobile","title":"Layout Issues on Mobile","text":"<p>Symptoms: Interface doesn't display correctly on mobile devices.</p> <p>Solutions:</p> <ol> <li>Ensure you're using a supported browser</li> <li>Try clearing browser cache</li> <li>Disable browser extensions that might interfere</li> <li>Check if zoom is enabled and reset to 100%</li> </ol>"},{"location":"troubleshooting/#performance-issues","title":"Performance Issues","text":""},{"location":"troubleshooting/#slow-gallery-loading","title":"Slow Gallery Loading","text":"<p>Symptoms: Gallery takes a long time to load.</p> <p>Solutions:</p> <ol> <li>Large directories load slower; consider organizing into subfolders</li> <li>Check network connection speed</li> <li>Thumbnails generate on first view; subsequent loads are faster</li> <li>Consider increasing server resources</li> <li>Use Prometheus metrics to identify bottlenecks</li> </ol>"},{"location":"troubleshooting/#high-memory-usage","title":"High Memory Usage","text":"<p>Symptoms: Server uses excessive memory.</p> <p>Solutions:</p> <ol> <li>Very large libraries require more memory for thumbnail generation and steady state afterwards</li> <li>Set memory limits in Docker configuration (<code>GOMEMLIMIT</code> environment variable)</li> <li>Monitor memory metrics: <code>media_viewer_memory_usage_ratio</code> and <code>media_viewer_go_memalloc_bytes</code></li> <li>Restart the container to clear memory</li> <li>See Metrics &amp; Monitoring for memory tuning guidance</li> </ol>"},{"location":"troubleshooting/#slow-indexing","title":"Slow Indexing","text":"<p>Symptoms: Media indexing takes a very long time, especially on NFS.</p> <p>Solutions:</p> <ol> <li>Tune worker count: Set <code>INDEX_WORKERS=3</code> (or lower) for NFS mounts - see INDEX_WORKERS</li> <li>Monitor filesystem latency metrics: <code>media_viewer_filesystem_operation_duration_seconds</code></li> <li>Check NFS mount performance with <code>nfsstat</code> or <code>nfsiostat</code></li> <li>Review indexer metrics: <code>media_viewer_indexer_files_per_second</code> and <code>media_viewer_indexer_batch_duration_seconds</code></li> <li>For NFS, ensure <code>async</code> mount option is used for better performance</li> <li>Consider local caching layer for metadata-heavy operations</li> <li>See Metrics &amp; Monitoring for indexing performance analysis</li> </ol>"},{"location":"troubleshooting/#nfs-stale-file-handle-errors","title":"NFS Stale File Handle Errors","text":"<p>Symptoms: Errors in logs like \"stale file handle\" (ESTALE), \"broken pipe\", or application crashes when browsing rapidly on NFS.</p> <p>Background: NFS can return stale file handle errors when files are modified, deleted, or the NFS connection is interrupted. Media Viewer automatically retries these operations.</p> <p>Automatic Retry: Media Viewer includes built-in retry logic for NFS operations:</p> <ul> <li>File stat operations retry up to 3 times with exponential backoff (50ms \u2192 500ms)</li> <li>File open operations use the same retry logic</li> <li>Only ESTALE errors trigger retries; other errors fail immediately</li> <li>Successful retries are logged: \"NFS Stat succeeded on retry X for \" <p>If you're still seeing ESTALE errors:</p> <ol> <li>Reduce indexer workers: Lower <code>INDEX_WORKERS</code> to 1-2 to reduce concurrent NFS operations</li> <li>Check NFS mount options:     <pre><code># Recommended NFS mount options\nmount -t nfs -o rsize=131072,wsize=131072,hard,intr,async nfs-server:/path /media\n</code></pre></li> <li>Check NFS server logs: Look for server-side issues causing file handle invalidation</li> <li>Monitor NFS performance: Use <code>nfsstat</code> or <code>nfsiostat</code> to check for saturation</li> <li>Verify network stability: Check for packet loss or high latency</li> <li>Check server resources: Ensure NFS server has adequate CPU and memory</li> </ol> <p>Understanding the retry metrics:</p> <p>Monitor these Prometheus metrics to see retry effectiveness:</p> <ul> <li><code>media_viewer_filesystem_retry_attempts_total{operation=\"stat|open\"}</code> - Number of retry attempts</li> <li><code>media_viewer_filesystem_retry_success_total{operation=\"stat|open\"}</code> - Successful retries (recovered from ESTALE)</li> <li><code>media_viewer_filesystem_retry_failures_total{operation=\"stat|open\"}</code> - Failed retries (exhausted all attempts)</li> <li><code>media_viewer_filesystem_estale_errors_total{operation=\"stat|open\"}</code> - Total ESTALE errors encountered</li> <li><code>media_viewer_filesystem_retry_duration_seconds{operation=\"stat|open\"}</code> - Operation duration including retries</li> <li>Look for INFO log messages: \"NFS Stat succeeded on retry N\" indicates recoverable errors</li> <li>ERROR log messages: \"NFS Stat failed after N retries\" indicates persistent issues</li> </ul> <p>Example PromQL queries:</p> <pre><code># Rate of retry attempts per second\nrate(media_viewer_filesystem_retry_attempts_total[5m])\n\n# Retry success rate\nrate(media_viewer_filesystem_retry_success_total[5m]) / rate(media_viewer_filesystem_retry_attempts_total[5m])\n\n# ESTALE error rate\nrate(media_viewer_filesystem_estale_errors_total[5m])\n\n# 99th percentile retry duration\nhistogram_quantile(0.99, rate(media_viewer_filesystem_retry_duration_seconds_bucket[5m]))\n</code></pre>"},{"location":"troubleshooting/#video-playback-issues","title":"Video Playback Issues","text":"<p>Symptoms: Videos don't play or buffer slowly.</p> <p>Solutions:</p> <ol> <li>Check that the video format is supported</li> <li>Verify network bandwidth is sufficient</li> <li>Large video files may buffer slowly on slow connections</li> <li>Try a different browser</li> </ol>"},{"location":"troubleshooting/#data-issues","title":"Data Issues","text":""},{"location":"troubleshooting/#tags-not-saving","title":"Tags Not Saving","text":"<p>Symptoms: Added tags disappear after refresh.</p> <p>Solutions:</p> <ol> <li>Check that the data directory is writable</li> <li>Verify the database file isn't corrupted</li> <li>Check server logs for database errors</li> <li>Ensure sufficient disk space</li> </ol>"},{"location":"troubleshooting/#favorites-not-persisting","title":"Favorites Not Persisting","text":"<p>Symptoms: Favorites disappear after restart.</p> <p>Solutions:</p> <ol> <li>Ensure the data volume is properly mounted</li> <li>Check that the volume persists between container restarts</li> <li>Verify database file permissions</li> </ol>"},{"location":"troubleshooting/#search-not-finding-items","title":"Search Not Finding Items","text":"<p>Symptoms: Search returns no results for items that exist.</p> <p>Solutions:</p> <ol> <li>Wait for indexing to complete after adding new files</li> <li>Check the exact spelling (search is case-insensitive but exact)</li> <li>For tag search, use the <code>tag:</code> prefix</li> <li>Try rebuilding the index by restarting the server</li> </ol>"},{"location":"troubleshooting/#installation-issues","title":"Installation Issues","text":""},{"location":"troubleshooting/#container-wont-start","title":"Container Won't Start","text":"<p>Symptoms: Docker container exits immediately.</p> <p>Solutions:</p> <ol> <li>Check logs: <code>docker logs media-viewer</code></li> <li>Ensure ports aren't already in use</li> <li>Check volume mount paths exist</li> <li>Verify all required directories are properly mounted</li> </ol>"},{"location":"troubleshooting/#permission-denied-errors","title":"Permission Denied Errors","text":"<p>Symptoms: Errors about file permissions in logs.</p> <p>Solutions:</p> <ol> <li>Check ownership of mounted directories</li> <li>Ensure the container user can read media files</li> <li>Ensure the container user can write to the data directory</li> <li>On Linux, check SELinux or AppArmor policies</li> </ol>"},{"location":"troubleshooting/#port-already-in-use","title":"Port Already in Use","text":"<p>Symptoms: Error binding to port 8080.</p> <p>Solutions:</p> <ol> <li>Change the port mapping: <code>-p 3000:8080</code></li> <li>Find and stop the conflicting service</li> <li>Use <code>netstat</code> or <code>lsof</code> to identify what's using the port</li> </ol>"},{"location":"troubleshooting/#pwa-issues","title":"PWA Issues","text":""},{"location":"troubleshooting/#pwa-wont-install","title":"PWA Won't Install","text":"<p>Symptoms: No install option appears in browser.</p> <p>Solutions:</p> <ol> <li>PWA requires HTTPS (except localhost)</li> <li>Clear browser cache and try again</li> <li>Check browser compatibility</li> <li>Ensure the manifest file loads correctly</li> </ol>"},{"location":"troubleshooting/#pwa-shows-old-content","title":"PWA Shows Old Content","text":"<p>Symptoms: Updates aren't reflected in the installed PWA.</p> <p>Solutions:</p> <ol> <li>Close and reopen the PWA</li> <li>Clear PWA data in device settings</li> <li>Uninstall and reinstall the PWA</li> </ol>"},{"location":"troubleshooting/#getting-help","title":"Getting Help","text":"<p>If these solutions don't resolve your issue:</p> <ol> <li>Check the GitHub Issues for similar problems</li> <li>Search closed issues for solutions</li> <li>Open a new issue with:<ul> <li>Detailed description of the problem</li> <li>Steps to reproduce</li> <li>Server logs (if applicable)</li> <li>Browser and device information</li> </ul> </li> </ol>"},{"location":"admin/docker-gpu/","title":"GPU Support in Docker","text":"<p>This document explains how to enable GPU-accelerated video transcoding in Docker deployments.</p>"},{"location":"admin/docker-gpu/#overview","title":"Overview","text":"<p>The application supports three GPU acceleration methods:</p> <ul> <li>NVIDIA NVENC - NVIDIA GPUs (requires Debian-based image)</li> <li>Intel/AMD VA-API - Intel Quick Sync and AMD GPUs (amd64 only)</li> <li>Apple VideoToolbox - macOS (not applicable to Docker)</li> </ul> <p>Important: NVIDIA GPU support requires using <code>Dockerfile.nvidia</code> (Debian-based) instead of the standard Alpine-based Dockerfile. See Docker Images section below.</p> <p>Architecture Notes:</p> <ul> <li>amd64/x86_64: Supports both NVIDIA (Debian image) and VA-API (any image) GPU acceleration</li> <li>arm64: Supports NVIDIA GPU acceleration only (Debian image), no Intel/AMD VA-API hardware</li> <li>Both architectures fall back to CPU transcoding if no GPU is available</li> </ul>"},{"location":"admin/docker-gpu/#docker-images","title":"Docker Images","text":""},{"location":"admin/docker-gpu/#standard-dockerfile-alpine-based","title":"Standard Dockerfile (Alpine-based)","text":"<p>The standard <code>Dockerfile</code> uses Alpine Linux and includes VA-API support for Intel/AMD GPUs.</p> <p>GPU Support:</p> <ul> <li>Intel/AMD VA-API: \u2705 Fully supported on amd64</li> <li>NVIDIA NVENC: \u274c Not compatible</li> <li>Reason: Alpine uses musl libc, but NVIDIA drivers require glibc</li> </ul> <p>Architecture Support:</p> <ul> <li>amd64/x86_64: Full VA-API support with Intel/AMD GPU drivers</li> <li>arm64: CPU transcoding only (VA-API packages excluded)</li> </ul> <p>Pros:</p> <ul> <li>Smallest image size (~150MB)</li> <li>Fast builds</li> <li>Works with Intel/AMD GPUs on x86_64</li> <li>CPU fallback always available</li> </ul> <p>Cons:</p> <ul> <li>Cannot use NVIDIA GPUs due to musl/glibc incompatibility</li> </ul>"},{"location":"admin/docker-gpu/#dockerfilenvidia-debian-based","title":"Dockerfile.nvidia (Debian-based)","text":"<p>Required for NVIDIA GPU support. Uses Debian Bookworm for glibc compatibility with NVIDIA drivers.</p> <p>GPU Support:</p> <ul> <li>NVIDIA NVENC: \u2705 Fully supported (glibc-compatible)</li> <li>Intel/AMD VA-API: \u274c Not included (use standard Dockerfile for VA-API)</li> </ul> <p>Why Debian?</p> <p>NVIDIA drivers are compiled against glibc and cannot be loaded in musl-based Alpine containers, even with NVIDIA Container Toolkit properly configured. The Debian base provides the necessary glibc runtime.</p> <p>Architecture Support:</p> <ul> <li>amd64/x86_64: Full NVIDIA GPU support</li> <li>arm64: Full NVIDIA GPU support</li> </ul> <p>Published Image Tags:</p> <pre><code># Latest stable release with NVIDIA support\ndocker pull ghcr.io/djryanj/media-viewer:latest-nvidia\n\n# Specific version with NVIDIA support\ndocker pull ghcr.io/djryanj/media-viewer:v1.0.0-nvidia\n</code></pre> <p>Building from Source (optional):</p> <pre><code>docker build -f Dockerfile.nvidia -t media-viewer:nvidia .\n</code></pre> <p>Pros:</p> <ul> <li>Full NVIDIA GPU support</li> <li>Compatible with NVIDIA Container Toolkit</li> <li>Works with <code>--gpus all</code> flag</li> </ul> <p>Cons:</p> <ul> <li>Larger image size (~300MB vs ~150MB for Alpine)</li> <li>No VA-API support (use standard Dockerfile for Intel/AMD GPUs)</li> </ul>"},{"location":"admin/docker-gpu/#docker-runtime-configuration","title":"Docker Runtime Configuration","text":"<p>GPU support requires runtime configuration to expose GPU devices to the container.</p>"},{"location":"admin/docker-gpu/#nvidia-gpu-nvenc","title":"NVIDIA GPU (NVENC)","text":"<p>Prerequisites:</p> <ul> <li>NVIDIA GPU with NVENC support</li> <li>NVIDIA Container Toolkit installed on host</li> <li>Must use <code>:latest-nvidia</code> or <code>:vX.X.X-nvidia</code> image tags (Debian-based) - Standard Alpine-based image is incompatible</li> <li>Windows users: See Windows/WSL2 Setup section for additional requirements</li> </ul> <p>Pull the NVIDIA-optimized image:</p> <pre><code>docker pull ghcr.io/djryanj/media-viewer:latest-nvidia\n</code></pre> <p>Docker Compose:</p> <pre><code>services:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest-nvidia  # Use NVIDIA-optimized image\n        runtime: nvidia # Use NVIDIA runtime\n        environment:\n            - GPU_ACCEL=nvidia # or 'auto'\n        volumes:\n            - ./media:/media:ro\n            - ./cache:/cache\n            - ./database:/database\n</code></pre> <p>Docker Run:</p> <pre><code>docker run -d \\\n  --name media-viewer \\\n  --gpus all \\\n  -e GPU_ACCEL=nvidia \\\n  -v /path/to/media:/media:ro \\\n  -v /path/to/cache:/cache \\\n  -v /path/to/database:/database \\\n  -p 8080:8080 \\\n  media-viewer:nvidia\n</code></pre> <p>Verification: Check logs for:</p> <pre><code>[INFO] \u2713 GPU acceleration enabled: nvidia (encoder: h264_nvenc)\n</code></pre>"},{"location":"admin/docker-gpu/#intelamd-gpu-va-api","title":"Intel/AMD GPU (VA-API)","text":"<p>Use the standard Alpine-based image (<code>:latest</code> or <code>:vX.X.X</code> tags without <code>-nvidia</code> suffix).</p> <p>Prerequisites:</p> <ul> <li>Intel GPU with Quick Sync or AMD GPU with VCE/VCN</li> <li><code>/dev/dri</code> devices available on host</li> </ul> <p>Docker Compose:</p> <pre><code>services:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest  # Standard image, not -nvidia\n        devices:\n            - /dev/dri:/dev/dri # Map DRI devices\n        environment:\n            - GPU_ACCEL=vaapi # or 'auto'\n        volumes:\n            - ./media:/media:ro\n            - ./cache:/cache\n            - ./database:/database\n</code></pre> <p>Docker Run:</p> <pre><code>docker run -d \\\n  --name media-viewer \\\n  --device=/dev/dri:/dev/dri \\\n  -e GPU_ACCEL=vaapi \\\n  -v /path/to/media:/media:ro \\\n  -v /path/to/cache:/cache \\\n  -v /path/to/database:/database \\\n  -p 8080:8080 \\\n  ghcr.io/djryanj/media-viewer:latest\n</code></pre> <p>Verification: Check logs for:</p> <pre><code>[INFO] \u2713 Found DRI device: /dev/dri/renderD128\n[INFO] \u2713 GPU acceleration enabled: vaapi (encoder: h264_vaapi)\n</code></pre>"},{"location":"admin/docker-gpu/#auto-detection","title":"Auto-Detection","text":"<p>Use <code>GPU_ACCEL=auto</code> (the default) to automatically detect and use any available GPU:</p> <pre><code>environment:\n    - GPU_ACCEL=auto # Tests NVIDIA, VA-API, VideoToolbox in order\n</code></pre> <p>The application will:</p> <ol> <li>Check for NVIDIA GPU and test NVENC</li> <li>Check for VA-API devices and test h264_vaapi</li> <li>Fall back to CPU encoding if no GPU works</li> </ol>"},{"location":"admin/docker-gpu/#troubleshooting","title":"Troubleshooting","text":""},{"location":"admin/docker-gpu/#windowswsl2-setup","title":"Windows/WSL2 Setup","text":"<p>If you're running Docker Desktop on Windows with WSL2, NVIDIA GPU passthrough requires additional setup:</p> <p>Prerequisites:</p> <ol> <li>Windows 11 or Windows 10 version 21H2 or higher</li> <li>NVIDIA GPU drivers installed in Windows (not WSL2)</li> <li>WSL2 enabled and updated</li> <li>Docker Desktop with WSL2 backend enabled</li> </ol> <p>Steps:</p> <ol> <li> <p>Install NVIDIA drivers in Windows (not inside WSL2):</p> <ul> <li>Download from NVIDIA website</li> <li>Version must be 510.06 or higher for WSL2 support</li> </ul> </li> <li> <p>Verify GPU visibility in WSL2:</p> <pre><code># Inside WSL2 terminal\nnvidia-smi\n</code></pre> <p>Should show your GPU. If not, update Windows and GPU drivers.</p> </li> <li> <p>Install NVIDIA Container Toolkit in WSL2:</p> <pre><code># Inside WSL2 terminal\ndistribution=$(. /etc/os-release;echo $ID$VERSION_ID)\ncurl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg\ncurl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.list | \\\n    sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \\\n    sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list\n\nsudo apt-get update\nsudo apt-get install -y nvidia-container-toolkit\n</code></pre> </li> <li> <p>Configure Docker in WSL2:</p> <pre><code>sudo nvidia-ctk runtime configure --runtime=docker\nsudo systemctl restart docker\n</code></pre> </li> <li> <p>Test GPU access:</p> <pre><code>docker run --rm --gpus all nvidia/cuda:12.0-base nvidia-smi\n</code></pre> <p>Should display your GPU information. If this fails, the application won't see the GPU either.</p> </li> <li> <p>Run media-viewer with GPU: <pre><code>docker run --rm --name media-viewer \\\n  --gpus all \\\n  -e GPU_ACCEL=nvidia \\\n  -e LOG_LEVEL=debug \\\n  -v D:\\media:/media:ro \\\n  -p 8081:8080 \\\n  ghcr.io/djryanj/media-viewer:latest-nvidia\n</code></pre></p> </li> </ol> <p>Common Windows/WSL2 Issues:</p> <ul> <li>\"no such file or directory\" for /dev/nvidia* - NVIDIA Container Toolkit not installed in WSL2</li> <li>\"nvidia-smi not found\" in WSL2 - Windows GPU drivers outdated (need 510.06+)</li> <li>GPU works in Windows but not WSL2 - WSL needs update: <code>wsl --update</code></li> <li>Docker Desktop doesn't see GPU - Ensure WSL2 backend is enabled in Docker Desktop settings</li> </ul>"},{"location":"admin/docker-gpu/#check-gpu-device-access","title":"Check GPU Device Access","text":"<p>NVIDIA:</p> <pre><code># Check if NVIDIA GPU is visible in container\ndocker run --rm --gpus all nvidia/cuda:12.0-base nvidia-smi\n</code></pre> <p>VA-API:</p> <pre><code># Check if DRI devices exist\nls -la /dev/dri/\n\n# Check permissions (should be accessible to container user)\nstat /dev/dri/renderD128\n</code></pre>"},{"location":"admin/docker-gpu/#enable-debug-logging","title":"Enable Debug Logging","text":"<p>Set <code>DEBUG=1</code> to see detailed GPU detection and encoder test output:</p> <pre><code>environment:\n    - DEBUG=1\n    - GPU_ACCEL=auto\n</code></pre> <p>Look for logs like:</p> <pre><code>[DEBUG] Checking GPU encoder: vaapi (accel=vaapi, encoder=h264_vaapi, filter=\"format=nv12,hwupload\")\n[DEBUG]   Device check passed for vaapi\n[DEBUG] Testing h264_vaapi with real encode (accel=vaapi, filter=\"format=nv12,hwupload\")...\n[DEBUG]   Adding video filter: format=nv12,hwupload\n[DEBUG]   Adding VA-API qp: 30\n[DEBUG]   Running: ffmpeg [...]\n[INFO] \u2713 GPU acceleration enabled: vaapi (encoder: h264_vaapi)\n</code></pre>"},{"location":"admin/docker-gpu/#common-issues","title":"Common Issues","text":""},{"location":"admin/docker-gpu/#common-issues_1","title":"Common Issues","text":"<p>NVIDIA GPU: \"No GPU encoder available\" despite <code>nvidia-smi</code> working in test container</p> <p>This means you're using the Alpine-based standard image, which is incompatible with NVIDIA drivers:</p> <ul> <li>Alpine Linux uses musl libc, NVIDIA drivers require glibc</li> <li>Even with NVIDIA Container Toolkit and <code>--gpus all</code>, Alpine cannot load NVIDIA libraries</li> <li>Solution: Use the NVIDIA-optimized Debian-based image:     <pre><code>docker pull ghcr.io/djryanj/media-viewer:latest-nvidia\ndocker run --rm --gpus all -e GPU_ACCEL=nvidia ghcr.io/djryanj/media-viewer:latest-nvidia\n</code></pre></li> <li>Test with Alpine images will always fail: <code>docker run --rm --gpus all alpine:latest nvidia-smi</code> \u274c</li> <li>Test with Debian works: <code>docker run --rm --gpus all nvidia/cuda:12.0-base nvidia-smi</code> \u2705</li> </ul> <p>\"No GPU encoder available\" / \"stat /dev/nvidia0: no such file or directory\"</p> <p>This means the container cannot see the GPU devices:</p> <ul> <li>Linux: Ensure NVIDIA Container Toolkit is installed and <code>--gpus all</code> flag is used</li> <li>Windows/WSL2: Follow the complete Windows/WSL2 Setup above - the <code>--gpus all</code> flag alone is not enough</li> <li>Test with: <code>docker run --rm --gpus all nvidia/cuda:12.0-base nvidia-smi</code></li> <li>If the test fails, the toolkit isn't properly configured</li> </ul> <p>VA-API: \"stat /dev/dri/renderD128: no such file or directory\"</p> <ul> <li>Verify <code>/dev/dri</code> devices exist on host: <code>ls -la /dev/dri/</code></li> <li>Ensure devices are mapped: <code>--device=/dev/dri:/dev/dri</code></li> <li>Check that ffmpeg has VA-API support: <code>docker exec media-viewer ffmpeg -encoders | grep vaapi</code></li> </ul> <p>\"Hardware initialization failed\"</p> <ul> <li>VA-API: Install correct drivers on host (intel-media-driver or mesa-va-gallium)</li> <li>NVIDIA: Update GPU drivers and ensure NVENC is enabled</li> <li>Check device permissions (user must have access to GPU devices)</li> </ul> <p>Transcoding works but still using CPU</p> <ul> <li>Verify GPU_ACCEL is set correctly</li> <li>Check logs for GPU detection messages</li> <li>Look for <code>[GPU: ...]</code> tag in transcode start logs</li> </ul>"},{"location":"admin/docker-gpu/#performance-monitoring","title":"Performance Monitoring","text":"<p>Check if GPU is being used for transcodes:</p> <pre><code># Watch container logs\ndocker logs -f media-viewer\n\n# Look for:\n[INFO] Using GPU encoder: h264_vaapi (vaapi) with filters: format=nv12,hwupload\n[INFO] FFmpeg started [GPU: vaapi/h264_vaapi], streaming to client...\n</code></pre> <p>Monitor GPU usage:</p> <p>NVIDIA:</p> <pre><code>nvidia-smi -l 1\n</code></pre> <p>Intel:</p> <pre><code>intel_gpu_top\n</code></pre> <p>AMD:</p> <pre><code>radeontop\n</code></pre>"},{"location":"admin/docker-gpu/#building-gpu-optimized-image","title":"Building GPU-Optimized Image","text":"<p>To build with the enhanced GPU support:</p> <pre><code>docker build -f Dockerfile.gpu -t media-viewer:gpu .\n</code></pre> <p>Or use in docker-compose:</p> <pre><code>services:\n    media-viewer:\n        build:\n            context: .\n            dockerfile: Dockerfile.gpu\n        # ... rest of configuration\n</code></pre>"},{"location":"admin/docker-gpu/#kubernetes-deployment","title":"Kubernetes Deployment","text":"<p>For Kubernetes, GPU device plugins are required:</p> <p>NVIDIA:</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n    name: media-viewer\nspec:\n    containers:\n        - name: media-viewer\n          image: ghcr.io/djryanj/media-viewer:latest-nvidia  # Use NVIDIA-optimized image\n          env:\n              - name: GPU_ACCEL\n                value: 'nvidia'\n          resources:\n              limits:\n                  nvidia.com/gpu: 1 # Request 1 GPU\n</code></pre> <p>Intel/AMD (Manual Device Mount):</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n    name: media-viewer\nspec:\n    containers:\n        - name: media-viewer\n          image: ghcr.io/djryanj/media-viewer:latest  # Use standard image (not -nvidia)\n          env:\n              - name: GPU_ACCEL\n                value: 'vaapi'\n          volumeMounts:\n              - name: dri\n                mountPath: /dev/dri\n    volumes:\n        - name: dri\n          hostPath:\n              path: /dev/dri\n</code></pre> <p>Intel GPU with Device Plugin:</p> <p>If using the Intel GPU Device Plugin, you can request GPU resources:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n    name: media-viewer\nspec:\n    template:\n        spec:\n            nodeSelector:\n                intel.feature.node.kubernetes.io/gpu: 'true'\n            containers:\n                - name: media-viewer\n                  image: ghcr.io/djryanj/media-viewer:latest  # Use standard image (not -nvidia)\n                  env:\n                      - name: GPU_ACCEL\n                        value: 'vaapi'\n                  resources:\n                      requests:\n                          gpu.intel.com/i915: '1'\n                      limits:\n                          gpu.intel.com/i915: '1'\n</code></pre> <p>Note: The Intel GPU Device Plugin automatically mounts <code>/dev/dri</code> devices when GPU resources are requested.</p>"},{"location":"admin/docker-gpu/#performance-expectations","title":"Performance Expectations","text":"<p>With GPU acceleration enabled:</p> <ul> <li>2-5x faster transcode times vs CPU</li> <li>50-80% lower CPU usage during transcoding</li> <li>Especially beneficial for:<ul> <li>4K/8K video</li> <li>Multiple concurrent transcodes</li> <li>Systems with limited CPU capacity</li> </ul> </li> </ul> <p>Example: 4K HEVC video \u2192 1080p H.264</p> <ul> <li>CPU only: ~30-45 seconds</li> <li>NVIDIA NVENC: ~8-12 seconds</li> <li>Intel VA-API: ~10-15 seconds</li> </ul>"},{"location":"admin/environment-variables/","title":"Environment Variables","text":"<p>Complete reference for all environment variables supported by Media Viewer.</p>"},{"location":"admin/environment-variables/#quick-reference","title":"Quick Reference","text":"Variable Default Description Paths <code>MEDIA_DIR</code> <code>/media</code> Media directory path <code>CACHE_DIR</code> <code>/cache</code> Cache directory for thumbnails and transcoded videos <code>DATABASE_DIR</code> <code>/database</code> Database directory path <code>TRANSCODER_LOG_DIR</code> (none) Transcoder log directory (optional) Video Transcoding <code>GPU_ACCEL</code> <code>auto</code> GPU acceleration (auto/nvidia/vaapi/videotoolbox/none) Network <code>PORT</code> <code>8080</code> HTTP server port <code>METRICS_PORT</code> <code>9090</code> Prometheus metrics port <code>METRICS_ENABLED</code> <code>true</code> Enable/disable metrics server Indexing &amp; Scanning <code>INDEX_INTERVAL</code> <code>30m</code> Full media re-index interval <code>POLL_INTERVAL</code> <code>30s</code> Filesystem change detection interval <code>THUMBNAIL_INTERVAL</code> <code>6h</code> Thumbnail generation scan interval <code>INDEX_WORKERS</code> <code>3</code> Parallel indexer workers (tune for NFS/local) <code>THUMBNAIL_WORKERS</code> (auto) Thumbnail generation workers (tune for performance) Authentication &amp; Sessions <code>SESSION_DURATION</code> <code>24h</code> User session lifetime <code>SESSION_CLEANUP</code> <code>1h</code> Expired session cleanup interval WebAuthn <code>WEBAUTHN_ENABLED</code> <code>false</code> Enable passkey authentication <code>WEBAUTHN_RP_ID</code> (none) Relying Party ID (required if enabled) <code>WEBAUTHN_RP_NAME</code> <code>Media Viewer</code> Display name for WebAuthn prompts <code>WEBAUTHN_ORIGINS</code> (none) Allowed origins (required if enabled) Memory Management <code>MEMORY_LIMIT</code> (none) Container memory limit in bytes <code>MEMORY_RATIO</code> <code>0.85</code> Go heap allocation ratio (0.75 recommended) <code>GOGC</code> <code>150</code> Go GC target percentage (Go default: 100) <code>GOMEMLIMIT</code> (none) Direct Go memory limit override Logging <code>LOG_LEVEL</code> <code>info</code> Log verbosity (debug/info/warn/error) <code>LOG_STATIC_FILES</code> <code>false</code> Log static file requests <code>LOG_HEALTH_CHECKS</code> <code>true</code> Log health check requests <code>SLOW_QUERY_THRESHOLD_MS</code> <code>100</code> Threshold (ms) for logging slow database queries"},{"location":"admin/environment-variables/#paths","title":"Paths","text":""},{"location":"admin/environment-variables/#media_dir","title":"MEDIA_DIR","text":"<p>Path to the media directory inside the container.</p> <pre><code>MEDIA_DIR=/media\n</code></pre> <ul> <li>Default: <code>/media</code></li> <li>Should match your volume mount</li> <li>Mounted as read-only recommended</li> </ul>"},{"location":"admin/environment-variables/#cache_dir","title":"CACHE_DIR","text":"<p>Path to the cache directory for thumbnails and transcoded videos.</p> <pre><code>CACHE_DIR=/cache\n</code></pre> <ul> <li>Default: <code>/cache</code></li> <li>Must be writable</li> <li>Should be persisted between container restarts</li> </ul>"},{"location":"admin/environment-variables/#database_dir","title":"DATABASE_DIR","text":"<p>Path to the database directory.</p> <pre><code>DATABASE_DIR=/database\n</code></pre> <ul> <li>Default: <code>/database</code></li> <li>Must be writable</li> <li>Should be persisted between container restarts</li> </ul>"},{"location":"admin/environment-variables/#transcoder_log_dir","title":"TRANSCODER_LOG_DIR","text":"<p>Path to the transcoder log directory (optional).</p> <pre><code>TRANSCODER_LOG_DIR=/logs/transcoder\n</code></pre> <ul> <li>Default: (not configured)</li> <li>Optional: If not set, transcoder logs are not saved</li> <li>When configured, FFmpeg logs for each transcode operation are saved to this directory</li> <li>Log files are named: <code>YYYYMMDD-HHMMSS-videoname-wWIDTH.log</code></li> <li>Useful for debugging transcode issues</li> </ul>"},{"location":"admin/environment-variables/#gpu_accel","title":"GPU_ACCEL","text":"<p>Enables GPU-accelerated video transcoding for better performance.</p> <pre><code>GPU_ACCEL=auto\n</code></pre> <ul> <li>Default: <code>auto</code> (automatically detect available GPU)</li> <li>Options:<ul> <li><code>auto</code> - Auto-detect GPU (tries NVIDIA \u2192 VA-API \u2192 VideoToolbox)</li> <li><code>nvidia</code> - Force NVIDIA NVENC (requires NVIDIA GPU and drivers)</li> <li><code>vaapi</code> - Force VA-API (Intel/AMD GPUs on Linux)</li> <li><code>videotoolbox</code> - Force VideoToolbox (macOS/Apple Silicon)</li> <li><code>none</code> - Disable GPU acceleration (CPU-only)</li> </ul> </li> </ul> <p>GPU Requirements:</p> <ul> <li>NVIDIA: Requires NVIDIA GPU with NVENC support and CUDA drivers<ul> <li>Docker: Use <code>--gpus all</code> flag or <code>--runtime=nvidia</code></li> <li>Docker Compose: Add <code>runtime: nvidia</code> or use <code>deploy.resources.reservations.devices</code></li> </ul> </li> <li>Intel/AMD (VA-API): Requires <code>/dev/dri</code> device access<ul> <li>Docker: Add <code>--device /dev/dri:/dev/dri</code></li> <li>Docker Compose: Add device mapping under <code>devices:</code></li> </ul> </li> <li>macOS (VideoToolbox): Native support, no additional configuration needed</li> </ul> <p>Performance Impact:</p> <p>GPU transcoding can be 2-5x faster than CPU transcoding while using less CPU resources. Particularly beneficial for:</p> <ul> <li>High-resolution videos (4K, 8K)</li> <li>Multiple concurrent transcoding operations</li> <li>Systems with limited CPU capacity</li> </ul> <p>Example Docker Run with GPU:</p> <pre><code># NVIDIA GPU\ndocker run --gpus all -e GPU_ACCEL=nvidia ...\n\n# Intel/AMD GPU (VA-API)\ndocker run --device /dev/dri:/dev/dri -e GPU_ACCEL=vaapi ...\n</code></pre> <p>Example Docker Compose with GPU:</p> <pre><code>services:\n  media-viewer:\n    # NVIDIA\n    runtime: nvidia\n    environment:\n      - GPU_ACCEL=nvidia\n\n    # OR for Intel/AMD\n    devices:\n      - /dev/dri:/dev/dri\n    environment:\n      - GPU_ACCEL=vaapi\n</code></pre> <p>If a GPU is not available or initialization fails, the system automatically falls back to CPU transcoding.</p>"},{"location":"admin/environment-variables/#network","title":"Network","text":""},{"location":"admin/environment-variables/#port","title":"PORT","text":"<p>Port the HTTP server listens on.</p> <pre><code>PORT=8080\n</code></pre> <ul> <li>Default: <code>8080</code></li> <li>Change if running multiple instances or if port conflicts exist</li> </ul>"},{"location":"admin/environment-variables/#metrics_port","title":"METRICS_PORT","text":"<p>Port for the Prometheus metrics endpoint.</p> <pre><code>METRICS_PORT=9090\n</code></pre> <ul> <li>Default: <code>9090</code></li> <li>Exposes <code>/metrics</code> endpoint for Prometheus scraping</li> </ul>"},{"location":"admin/environment-variables/#metrics_enabled","title":"METRICS_ENABLED","text":"<p>Enable or disable the metrics server.</p> <pre><code>METRICS_ENABLED=true\n</code></pre> <ul> <li>Default: <code>true</code></li> <li>Set to <code>false</code> to disable metrics collection</li> </ul>"},{"location":"admin/environment-variables/#indexing-scanning","title":"Indexing &amp; Scanning","text":""},{"location":"admin/environment-variables/#index_interval","title":"INDEX_INTERVAL","text":"<p>How often to perform a full re-index of the media directory.</p> <pre><code>INDEX_INTERVAL=30m\n</code></pre> <ul> <li>Default: <code>30m</code> (30 minutes)</li> <li>Accepts Go duration format: <code>s</code>, <code>m</code>, <code>h</code></li> <li>Examples: <code>15m</code>, <code>1h</code>, <code>2h30m</code></li> </ul>"},{"location":"admin/environment-variables/#poll_interval","title":"POLL_INTERVAL","text":"<p>How often to check for filesystem changes (lightweight scan).</p> <pre><code>POLL_INTERVAL=30s\n</code></pre> <ul> <li>Default: <code>30s</code> (30 seconds)</li> <li>Detects new/modified/deleted files without full index</li> <li>Accepts Go duration format: <code>s</code>, <code>m</code>, <code>h</code></li> </ul> <p>Recommended values:</p> <ul> <li>Frequently changing library: <code>10s</code>-<code>30s</code></li> <li>Stable library: <code>1m</code>-<code>5m</code></li> <li>Minimal resource usage: <code>5m</code>-<code>15m</code></li> </ul>"},{"location":"admin/environment-variables/#thumbnail_interval","title":"THUMBNAIL_INTERVAL","text":"<p>How often the thumbnail generator performs a full scan.</p> <pre><code>THUMBNAIL_INTERVAL=6h\n</code></pre> <ul> <li>Default: <code>6h</code> (6 hours)</li> <li>Incremental updates happen automatically after indexing</li> <li>This is a fallback for missed changes</li> <li>Accepts Go duration format: <code>s</code>, <code>m</code>, <code>h</code></li> </ul> <p>Recommended values:</p> <ul> <li>Small library (&lt; 1000 files): <code>6h</code></li> <li>Medium library (1000-10000 files): <code>12h</code></li> <li>Large library (&gt; 10000 files): <code>24h</code></li> </ul>"},{"location":"admin/environment-variables/#index_workers","title":"INDEX_WORKERS","text":"<p>Number of parallel workers for directory indexing. Critical for NFS stability and performance.</p> <pre><code>INDEX_WORKERS=3\n</code></pre> <ul> <li>Default: <code>3</code> (NFS-safe default)</li> <li>For NFS mounts: Set to <code>3</code> or lower</li> <li>For local filesystems: Can increase to <code>8</code>-<code>16</code> for better performance</li> <li>Must be a positive integer</li> </ul> <p>Why this matters:</p> <p>NFS servers can be overwhelmed by concurrent metadata operations during indexing. Too many parallel workers reading directory structures simultaneously can cause:</p> <ul> <li>Stale file handle errors (ESTALE)</li> <li>Slow indexing performance</li> <li>NFS server load spikes</li> <li>Server crashes or hangs during rapid browsing</li> </ul> <p>NFS Resilience Features:</p> <p>Media Viewer includes automatic retry logic for NFS operations:</p> <ul> <li>Stale file handle errors (ESTALE) trigger automatic retry with exponential backoff</li> <li>Up to 3 retry attempts (50ms \u2192 100ms \u2192 200ms backoff)</li> <li>Applies to file stat and open operations</li> <li>Zero overhead for successful operations (~100ns)</li> <li>Successful retries logged for monitoring</li> </ul> <p>This retry logic works best when combined with appropriate worker tuning via <code>INDEX_WORKERS</code>.</p> <p>Recommended values:</p> <ul> <li>NFS mount: <code>1</code>-<code>3</code> workers (start with 3)</li> <li>Local SSD/HDD: <code>4</code>-<code>8</code> workers</li> <li>High-performance local storage: <code>8</code>-<code>16</code> workers</li> </ul> <p>Example configurations:</p> <pre><code># For NFS-mounted media (conservative)\nenvironment:\n    - INDEX_WORKERS=3\n\n# For NFS-mounted media (aggressive, if NFS is fast)\nenvironment:\n    - INDEX_WORKERS=5\n\n# For local SSD (use default)\nenvironment:\n    # INDEX_WORKERS not set - uses default of 3\n\n# For high-performance local storage\nenvironment:\n    - INDEX_WORKERS=16\n</code></pre> <p>When to adjust:</p> <ul> <li>Seeing \"stale file handle\" errors in logs \u2192 reduce to 1-2</li> <li>Indexing is slow on fast local storage \u2192 increase to 8-16</li> <li>NFS server CPU high during indexing \u2192 reduce to 1-2</li> </ul>"},{"location":"admin/environment-variables/#thumbnail_workers","title":"THUMBNAIL_WORKERS","text":"<p>Number of parallel workers for thumbnail generation. Auto-calculated based on CPU cores but can be overridden.</p> <pre><code>THUMBNAIL_WORKERS=6\n</code></pre> <ul> <li>Default: Auto-calculated (1.5\u00d7 CPU cores, max 6)</li> <li>For most systems: Use default (no override needed   )</li> <li>For resource-constrained: Set to <code>2</code>-<code>4</code> to limit resource usage</li> <li>For high-performance: Set to <code>8</code>-<code>12</code> for faster thumbnail generation</li> <li>Must be a positive integer</li> </ul> <p>Why this matters:</p> <p>Thumbnail generation uses both CPU (for image decoding/encoding) and I/O (reading media files). The default auto-calculation provides good balance:</p> <ul> <li>Uses libvips for efficient image processing</li> <li>Respects container CPU limits (via GOMAXPROCS)</li> <li>Capped at 6 workers to prevent overwhelming NFS mounts</li> <li>Automatically reduced under memory pressure</li> </ul> <p>Recommended values:</p> <ul> <li>Default (no override): Let the system auto-calculate (recommended for most users)</li> <li>Resource-constrained: <code>2</code>-<code>4</code> to limit CPU/memory usage</li> <li>High-performance local storage: <code>8</code>-<code>12</code> workers</li> </ul> <p>Example configurations:</p> <pre><code># Use default auto-calculated workers (recommended)\nenvironment:\n    # THUMBNAIL_WORKERS not set - auto-calculated\n\n# Limit resources on constrained system\nenvironment:\n    - THUMBNAIL_WORKERS=2\n\n# High-performance system with fast storage\nenvironment:\n    - THUMBNAIL_WORKERS=10\n</code></pre> <p>When to adjust:</p> <ul> <li>System running out of memory during thumbnail generation \u2192 reduce to 2-4</li> <li>Thumbnails generating too slowly on powerful system \u2192 increase to 8-12</li> <li>High CPU usage during thumbnail scans \u2192 reduce to 2-4</li> </ul>"},{"location":"admin/environment-variables/#authentication-sessions","title":"Authentication &amp; Sessions","text":""},{"location":"admin/environment-variables/#session_duration","title":"SESSION_DURATION","text":"<p>How long user sessions remain valid.</p> <pre><code>SESSION_DURATION=24h\n</code></pre> <ul> <li>Default: <code>24h</code> (24 hours)</li> <li>Uses sliding expiration (extends on activity)</li> <li>Accepts Go duration format: <code>s</code>, <code>m</code>, <code>h</code></li> <li>Minimum recommended: <code>5m</code> (below this may cause issues)</li> <li>Examples: <code>30m</code>, <code>12h</code>, <code>7d</code></li> </ul>"},{"location":"admin/environment-variables/#session_cleanup","title":"SESSION_CLEANUP","text":"<p>How often to clean up expired sessions from the database.</p> <pre><code>SESSION_CLEANUP=1h\n</code></pre> <ul> <li>Default: <code>1h</code> (1 hour)</li> <li>Removes expired sessions periodically</li> <li>Accepts Go duration format: <code>s</code>, <code>m</code>, <code>h</code></li> </ul>"},{"location":"admin/environment-variables/#webauthn-passkey-authentication","title":"WebAuthn (Passkey Authentication)","text":""},{"location":"admin/environment-variables/#webauthn_enabled","title":"WEBAUTHN_ENABLED","text":"<p>Enable passkey (WebAuthn) authentication.</p> <pre><code>WEBAUTHN_ENABLED=true\n</code></pre> <ul> <li>Default: <code>false</code></li> <li>Requires HTTPS (except localhost)</li> <li>Requires <code>WEBAUTHN_RP_ID</code> to be set</li> </ul>"},{"location":"admin/environment-variables/#webauthn_rp_id","title":"WEBAUTHN_RP_ID","text":"<p>WebAuthn Relying Party ID (domain name).</p> <pre><code>WEBAUTHN_RP_ID=example.com\n</code></pre> <ul> <li>Default: none (required if WebAuthn enabled)</li> <li>Must match your domain</li> <li>For <code>https://media.example.com</code>, use <code>example.com</code></li> <li>Must be a valid domain suffix of the origin</li> </ul>"},{"location":"admin/environment-variables/#webauthn_rp_name","title":"WEBAUTHN_RP_NAME","text":"<p>Display name shown in WebAuthn prompts.</p> <pre><code>WEBAUTHN_RP_NAME=\"My Media Viewer\"\n</code></pre> <ul> <li>Default: <code>Media Viewer</code></li> <li>Shown to users during passkey registration</li> </ul>"},{"location":"admin/environment-variables/#webauthn_origins","title":"WEBAUTHN_ORIGINS","text":"<p>Comma-separated list of allowed origins.</p> <pre><code>WEBAUTHN_ORIGINS=https://example.com,https://media.example.com\n</code></pre> <ul> <li>Default: none (required if WebAuthn enabled)</li> <li>Must include all origins where app is accessed</li> <li>Must use <code>https://</code> (except <code>http://localhost</code>)</li> </ul>"},{"location":"admin/environment-variables/#memory-management","title":"Memory Management","text":""},{"location":"admin/environment-variables/#memory_limit","title":"MEMORY_LIMIT","text":"<p>Container memory limit in bytes (Kubernetes Downward API).</p> <pre><code>MEMORY_LIMIT=536870912\n</code></pre> <ul> <li>Default: none</li> <li>Usually set via Kubernetes Downward API</li> <li>Enables automatic GOMEMLIMIT configuration</li> <li>Example: <code>536870912</code> (512 MiB)</li> </ul>"},{"location":"admin/environment-variables/#memory_ratio","title":"MEMORY_RATIO","text":"<p>Percentage of <code>MEMORY_LIMIT</code> to allocate to Go heap.</p> <pre><code>MEMORY_RATIO=0.85\n</code></pre> <ul> <li>Default: <code>0.85</code> (85%)</li> <li>Range: <code>0.0</code> to <code>1.0</code></li> <li>Remainder reserved for FFmpeg, OS buffers, etc.</li> </ul> <p>Recommended values:</p> <ul> <li>Small library, few videos: <code>0.85</code> (default)</li> <li>Large library, active transcoding: <code>0.75</code> (recommended for production)</li> <li>Heavy concurrent thumbnail generation: <code>0.70</code></li> </ul> <p>Benchmark Results:</p> <p>Testing with 3,106 thumbnail generation workload:</p> MEMORY_RATIO GC CPU % Idle GC Rate Load GC Rate Memory Usage 0.85 (default) 0.18% 0.3/s 7/s 520 MB 0.75 (recommended) 0.16% 0.2/s 6/s 534 MB 0.70 0.20% 0.4/s 8/s 480 MB <p>Why 0.75 is optimal:</p> <ul> <li>\u2705 Lowest GC overhead (0.16%)</li> <li>\u2705 Adaptive: scales with workload</li> <li>\u2705 More cache space (+6% vs default)</li> <li>\u2705 Container-aware (respects memory limits)</li> </ul> <p>For detailed tuning guidance, see Memory and GC Tuning.</p>"},{"location":"admin/environment-variables/#gogc","title":"GOGC","text":"<p>Go garbage collection target percentage. Controls how much the heap can grow before triggering GC.</p> <pre><code>GOGC=150\n</code></pre> <ul> <li>Default: <code>100</code> (Go runtime default)</li> <li>Alternative to MEMORY_RATIO: Use <code>150</code> for non-containerized deployments</li> <li>Effect: Higher values = less frequent GC, more memory usage</li> <li>Note: MEMORY_RATIO approach is preferred for production containerized deployments</li> </ul> <p>Comparison:</p> Approach Idle Overhead Load Overhead Memory Behavior MEMORY_RATIO=0.75 0.009% 0.16% Adaptive \u2705 GOGC=150 0.15% 0.15% Fixed \ud83d\udcca <p>How GOGC works:</p> <ul> <li><code>GOGC=100</code>: GC triggers at 2x live heap (e.g., 10MB \u2192 20MB)</li> <li><code>GOGC=150</code>: GC triggers at 2.5x live heap (e.g., 10MB \u2192 25MB)</li> <li><code>GOGC=200</code>: GC triggers at 3x live heap (e.g., 10MB \u2192 30MB)</li> </ul> <p>When to use GOGC:</p> <ul> <li> <p>Use GOGC=150 when:</p> <ul> <li>Not using containers (bare metal, VMs)</li> <li>Memory is unlimited</li> <li>Want simple, predictable configuration</li> </ul> </li> <li> <p>Use MEMORY_RATIO=0.75 when:</p> <ul> <li>Running in Docker/Kubernetes</li> <li>Have memory limits set</li> <li>Want adaptive behavior</li> <li>Need optimal performance (recommended)</li> </ul> </li> </ul> <p>For comprehensive tuning guidance, benchmarks, and troubleshooting, see Memory and GC Tuning.</p>"},{"location":"admin/environment-variables/#gomemlimit","title":"GOMEMLIMIT","text":"<p>Direct override for Go's memory limit.</p> <pre><code>GOMEMLIMIT=400MiB\n</code></pre> <ul> <li>Default: none</li> <li>Takes precedence over <code>MEMORY_LIMIT</code></li> <li>Accepts values like <code>400MiB</code>, <code>1GiB</code>, <code>512MB</code></li> <li>Use for manual memory tuning</li> </ul>"},{"location":"admin/environment-variables/#logging","title":"Logging","text":""},{"location":"admin/environment-variables/#log_level","title":"LOG_LEVEL","text":"<p>Server log verbosity level.</p> <pre><code>LOG_LEVEL=info\n</code></pre> <ul> <li>Default: <code>info</code></li> <li>Values: <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code></li> <li><code>debug</code> provides detailed debugging information</li> </ul>"},{"location":"admin/environment-variables/#log_static_files","title":"LOG_STATIC_FILES","text":"<p>Log static file requests.</p> <pre><code>LOG_STATIC_FILES=false\n</code></pre> <ul> <li>Default: <code>false</code></li> <li>Set to <code>true</code> to log CSS, JS, image requests</li> <li>Can be noisy in production</li> </ul>"},{"location":"admin/environment-variables/#log_health_checks","title":"LOG_HEALTH_CHECKS","text":"<p>Log health check endpoint requests.</p> <pre><code>LOG_HEALTH_CHECKS=true\n</code></pre> <ul> <li>Default: <code>true</code></li> <li>Set to <code>false</code> to reduce log noise from monitoring</li> </ul>"},{"location":"admin/environment-variables/#slow_query_threshold_ms","title":"SLOW_QUERY_THRESHOLD_MS","text":"<p>Threshold in milliseconds for logging slow database queries.</p> <pre><code>SLOW_QUERY_THRESHOLD_MS=100\n</code></pre> <ul> <li>Default: <code>100</code> (100 milliseconds)</li> <li>Queries exceeding this threshold will be logged as warnings</li> <li>Useful for identifying performance bottlenecks in production</li> <li>Set to a higher value (e.g., <code>500</code>) if you want to only log very slow queries</li> <li>Set to <code>0</code> to log all queries (not recommended for production)</li> <li>Example log output: <code>Slow query detected: operation=list_directory duration=0.235s status=success</code></li> </ul>"},{"location":"admin/environment-variables/#duration-format","title":"Duration Format","text":"<p>Duration values (<code>INDEX_INTERVAL</code>, <code>POLL_INTERVAL</code>, <code>THUMBNAIL_INTERVAL</code>, <code>SESSION_DURATION</code>, <code>SESSION_CLEANUP</code>) use Go's duration format:</p> Unit Suffix Example Nanoseconds <code>ns</code> <code>500ns</code> Microseconds <code>us</code> <code>100us</code> Milliseconds <code>ms</code> <code>500ms</code> Seconds <code>s</code> <code>30s</code> Minutes <code>m</code> <code>30m</code> Hours <code>h</code> <code>6h</code> <p>Examples:</p> <pre><code>POLL_INTERVAL=30s           # 30 seconds\nINDEX_INTERVAL=1h30m        # 1 hour 30 minutes\nSESSION_DURATION=24h        # 24 hours\nTHUMBNAIL_INTERVAL=6h       # 6 hours\n</code></pre> <p>Invalid formats:</p> <pre><code>POLL_INTERVAL=30            # Missing unit\nTHUMBNAIL_INTERVAL=1d       # Days not supported (use 24h)\n</code></pre>"},{"location":"admin/environment-variables/#boolean-format","title":"Boolean Format","text":"<p>Boolean environment variables accept:</p> <ul> <li>True: <code>true</code>, <code>1</code>, <code>t</code>, <code>T</code>, <code>TRUE</code></li> <li>False: <code>false</code>, <code>0</code>, <code>f</code>, <code>F</code>, <code>FALSE</code></li> </ul>"},{"location":"admin/environment-variables/#example-configurations","title":"Example Configurations","text":""},{"location":"admin/environment-variables/#docker-compose-basic","title":"Docker Compose - Basic","text":"<pre><code>services:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest\n        environment:\n            - MEDIA_DIR=/media\n            - CACHE_DIR=/cache\n            - DATABASE_DIR=/database\n            - PORT=8080\n            - SESSION_DURATION=24h\n        volumes:\n            - /path/to/media:/media:ro\n            - media-cache:/cache\n            - media-database:/database\n\nvolumes:\n    media-cache:\n    media-database:\n</code></pre>"},{"location":"admin/environment-variables/#docker-compose-full-configuration","title":"Docker Compose - Full Configuration","text":"<pre><code>services:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest\n        environment:\n            # Paths\n            - MEDIA_DIR=/media\n            - CACHE_DIR=/cache\n            - DATABASE_DIR=/database\n\n            # Network\n            - PORT=8080\n            - METRICS_PORT=9090\n            - METRICS_ENABLED=true\n\n            # Indexing\n            - INDEX_INTERVAL=30m\n            - POLL_INTERVAL=30s\n            - THUMBNAIL_INTERVAL=6h\n            - INDEX_WORKERS=3 # Set to 3 for NFS mounts, 8-16 for fast local storage\n\n            # Sessions\n            - SESSION_DURATION=24h\n            - SESSION_CLEANUP=1h\n\n            # WebAuthn\n            - WEBAUTHN_ENABLED=true\n            - WEBAUTHN_RP_ID=example.com\n            - WEBAUTHN_RP_NAME=Media Viewer\n            - WEBAUTHN_ORIGINS=https://example.com,https://media.example.com\n\n            # Logging\n            - LOG_LEVEL=info\n            - LOG_STATIC_FILES=false\n            - LOG_HEALTH_CHECKS=true\n        volumes:\n            - /path/to/media:/media:ro\n            - media-cache:/cache\n            - media-database:/database\n        ports:\n            - '8080:8080'\n            - '9090:9090'\n\nvolumes:\n    media-cache:\n    media-database:\n</code></pre>"},{"location":"admin/environment-variables/#kubernetes-with-memory-management","title":"Kubernetes with Memory Management","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n    name: media-viewer\nspec:\n    containers:\n        - name: media-viewer\n          image: ghcr.io/djryanj/media-viewer:latest\n          env:\n              - name: MEDIA_DIR\n                value: '/media'\n              - name: CACHE_DIR\n                value: '/cache'\n              - name: DATABASE_DIR\n                value: '/database'\n              - name: MEMORY_LIMIT\n                valueFrom:\n                    resourceFieldRef:\n                        resource: limits.memory\n              - name: MEMORY_RATIO\n                value: '0.85'\n          resources:\n              limits:\n                  memory: '2Gi'\n                  cpu: '2'\n              requests:\n                  memory: '1Gi'\n                  cpu: '1'\n</code></pre>"},{"location":"admin/environment-variables/#environment-file","title":"Environment File","text":"<p>Using <code>.env</code> file with Docker Compose:</p> <pre><code>services:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest\n        env_file:\n            - .env\n</code></pre> <p><code>.env</code>:</p> <pre><code># Paths\nMEDIA_DIR=/media\nCACHE_DIR=/cache\nDATABASE_DIR=/database\n\n# Network\nPORT=8080\nMETRICS_PORT=9090\nMETRICS_ENABLED=true\n\n# Indexing\nINDEX_INTERVAL=30m\nPOLL_INTERVAL=30s\nTHUMBNAIL_INTERVAL=6h\nINDEX_WORKERS=3  # For NFS mounts; 8-16 for fast local storage\n\n# Sessions\nSESSION_DURATION=24h\nSESSION_CLEANUP=1h\n\n# Logging\nLOG_LEVEL=info\nLOG_STATIC_FILES=false\nLOG_HEALTH_CHECKS=true\n</code></pre>"},{"location":"admin/environment-variables/#see-also","title":"See Also","text":"<ul> <li>Server Configuration - Deployment and performance tuning</li> <li>Metrics &amp; Monitoring - Prometheus metrics reference</li> <li>WebAuthn Setup - Passkey authentication configuration</li> </ul>"},{"location":"admin/libvips/","title":"libvips Integration","text":""},{"location":"admin/libvips/#overview","title":"Overview","text":"<p>Media Viewer uses libvips for memory-efficient thumbnail generation. libvips provides decode-time downsampling for JPEG images, which dramatically reduces memory usage compared to standard image libraries.</p>"},{"location":"admin/libvips/#memory-benefits","title":"Memory Benefits","text":"<p>Standard Image Processing:</p> <ul> <li>Load full 6000x4000 JPEG \u2192 96MB in memory</li> <li>Resize to 1600x1600 \u2192 10MB</li> <li>Peak memory: 106MB per image</li> </ul> <p>With libvips:</p> <ul> <li>Decode directly to 1600x1600 \u2192 10MB</li> <li>Peak memory: 10MB per image</li> <li>~90% memory reduction for large images</li> </ul>"},{"location":"admin/libvips/#installation","title":"Installation","text":""},{"location":"admin/libvips/#docker-included","title":"Docker (Included)","text":"<p>The official Docker image includes libvips automatically. No additional setup required.</p>"},{"location":"admin/libvips/#development-local","title":"Development (Local)","text":"<p>libvips must be installed on your system for development builds:</p> <p>macOS (Homebrew):</p> <pre><code>brew install vips\n</code></pre> <p>Ubuntu/Debian:</p> <pre><code>sudo apt-get install libvips-dev\n</code></pre> <p>Alpine Linux:</p> <pre><code>apk add vips-dev\n</code></pre> <p>Fedora/RHEL:</p> <pre><code>sudo dnf install vips-devel\n</code></pre> <p>Windows: Download pre-built binaries from: https://github.com/libvips/build-win64-mxe</p>"},{"location":"admin/libvips/#building-without-libvips","title":"Building Without libvips","text":"<p>If libvips is not installed, the application will:</p> <ol> <li>Log a warning: <code>Failed to initialize libvips (will use fallback methods)</code></li> <li>Use two-stage resize for large JPEGs (less efficient but functional)</li> <li>Fall back to standard imaging library for all other formats</li> </ol> <p>The application remains fully functional without libvips, just with higher memory usage for large JPEG files.</p>"},{"location":"admin/libvips/#configuration","title":"Configuration","text":"<p>libvips is initialized automatically when thumbnail generation is enabled. Configuration:</p> <pre><code>vips.Startup(&amp;vips.Config{\n    ConcurrencyLevel: 1,              // Single image at a time\n    MaxCacheMem:      50 * 1024 * 1024, // 50MB cache\n    MaxCacheSize:     100,              // Max 100 operations\n})\n</code></pre> <p>These conservative settings prevent memory bloat while still providing excellent performance.</p> <p>Writable /tmp Directory Required</p> <p>libvips requires a writable <code>/tmp</code> directory for temporary file operations during image processing. Ensure your container or system has:</p> <ul> <li><code>/tmp</code> mounted with write permissions</li> <li>Sufficient disk space in <code>/tmp</code> (at least 1GB recommended)</li> <li>No <code>noexec</code> flag on the <code>/tmp</code> mount</li> </ul> <p>Docker users: The default Docker configuration provides a writable <code>/tmp</code>. No action needed.</p> <p>Custom deployments: If running with read-only root filesystem, ensure <code>/tmp</code> is mounted as a writable tmpfs volume:</p> <pre><code>volumes:\n  - type: tmpfs\n    target: /tmp\n</code></pre>"},{"location":"admin/libvips/#monitoring","title":"Monitoring","text":"<p>Check if libvips is active:</p> <ol> <li> <p>Startup logs:</p> <pre><code>[INFO] libvips initialized successfully (version: 8.15.0)\n</code></pre> </li> <li> <p>Debug logs during thumbnail generation:</p> <pre><code>[DEBUG] Successfully loaded image.jpg using libvips\n</code></pre> </li> <li> <p>If unavailable:</p> <pre><code>[WARN] Failed to initialize libvips: ... (will use fallback methods)\n</code></pre> </li> <li> <p>Memory metrics:    Monitor <code>media_viewer_thumbnail_memory_usage_bytes</code> - should be dramatically lower for large JPEGs when libvips is active.</p> </li> </ol>"},{"location":"admin/libvips/#troubleshooting","title":"Troubleshooting","text":""},{"location":"admin/libvips/#tmp-not-writable","title":"\"/tmp Not Writable\"","text":"<p>Symptoms:</p> <ul> <li>libvips initialization fails</li> <li>Errors mentioning temporary files</li> <li>\"Permission denied\" errors during image processing</li> </ul> <p>Cause: libvips cannot write to <code>/tmp</code> directory</p> <p>Solution:</p> <ol> <li> <p>Check /tmp permissions: <pre><code>ls -ld /tmp\n# Should show: drwxrwxrwt (permissions 1777)\n</code></pre></p> </li> <li> <p>Fix permissions if needed: <pre><code>sudo chmod 1777 /tmp\n</code></pre></p> </li> <li> <p>For read-only containers:    Mount tmpfs for <code>/tmp</code>:    <pre><code>volumes:\n  - type: tmpfs\n    target: /tmp\n    tmpfs:\n      size: 1G\n</code></pre></p> </li> <li> <p>Set alternative temp directory: <pre><code>export TMPDIR=/writable/path\n</code></pre></p> </li> </ol>"},{"location":"admin/libvips/#failed-to-initialize-libvips","title":"\"Failed to initialize libvips\"","text":"<p>Cause: libvips shared library not found</p> <p>Solution:</p> <ul> <li>Ensure libvips is installed: <code>vips --version</code></li> <li>Check library path: <code>ldconfig -p | grep vips</code> (Linux)</li> <li>Set <code>LD_LIBRARY_PATH</code> if needed: <code>export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH</code></li> </ul>"},{"location":"admin/libvips/#high-memory-usage-despite-libvips","title":"High Memory Usage Despite libvips","text":"<p>Check:</p> <ol> <li>Verify libvips initialization in logs</li> <li>Check file types - libvips only used for JPEG currently</li> <li>Monitor debug logs to confirm vips is being used</li> <li>PNG/WebP files still use standard library (higher memory)</li> </ol>"},{"location":"admin/libvips/#build-errors","title":"Build Errors","text":"<p>CGO Required: libvips requires CGO. Ensure:</p> <pre><code>CGO_ENABLED=1 go build\n</code></pre> <p>Missing Headers: Install development packages:</p> <ul> <li>Ubuntu: <code>libvips-dev</code></li> <li>macOS: Headers included with <code>brew install vips</code></li> </ul>"},{"location":"admin/libvips/#performance-characteristics","title":"Performance Characteristics","text":"Image Size Format Standard Library With libvips Reduction 6000x4000 JPEG ~106MB ~10MB 90% 4000x3000 JPEG ~60MB ~10MB 83% 2000x1500 JPEG ~15MB ~10MB 33% 1600x1200 JPEG ~10MB ~10MB 0% Any PNG Varies Not used N/A <p>Memory reduction is most dramatic for large JPEG files (&gt;4MP).</p>"},{"location":"admin/libvips/#future-enhancements","title":"Future Enhancements","text":"<p>Potential improvements:</p> <ul> <li>Extend libvips to PNG/WebP formats</li> <li>Use vips thumbnail pipeline for even lower memory</li> <li>Implement vips streaming for very large files</li> <li>Add vips-based image transformations (rotate, crop)</li> </ul>"},{"location":"admin/libvips/#references","title":"References","text":"<ul> <li>libvips Homepage</li> <li>govips Library</li> <li>libvips Performance</li> </ul>"},{"location":"admin/memory-tuning/","title":"Memory and Garbage Collection Tuning","text":"<p>This guide explains how to optimize memory usage and garbage collection (GC) performance for Media Viewer.</p>"},{"location":"admin/memory-tuning/#quick-start","title":"Quick Start","text":""},{"location":"admin/memory-tuning/#for-production-containerized-deployments","title":"For Production (Containerized Deployments)","text":"<p>Recommended configuration for Docker/Kubernetes with library of ~40,000 mixed items:</p> <pre><code>environment:\n    - MEMORY_LIMIT=2147483648 # 2 GiB\n    - MEMORY_RATIO=0.75\n</code></pre> <p>Result: 0.16% GC overhead under heavy load, adaptive behavior, excellent memory efficiency.</p>"},{"location":"admin/memory-tuning/#for-simple-deployments-no-container-limits","title":"For Simple Deployments (No Container Limits)","text":"<p>Alternative configuration for bare metal/VMs:</p> <pre><code>environment:\n    - GOGC=150\n</code></pre> <p>Result: 0.15% GC overhead, predictable behavior, simple configuration.</p>"},{"location":"admin/memory-tuning/#benchmark-results","title":"Benchmark Results","text":"<p>Real-world testing with 3,106 thumbnail generation (heavy image processing workload):</p> Configuration Idle GC Rate Load GC Rate GC CPU % Peak Memory Behavior Original (Manual GC) 31/s &gt;31/s 1.88% 502 MB \u274c Excessive GOGC=150 4.5/s 4.5/s 0.15% 502 MB \u2705 Good (predictable) MEMORY_RATIO=0.75 0.2/s 6/s 0.16% 534 MB \u2705 Best (adaptive)"},{"location":"admin/memory-tuning/#why-memory_ratio075-is-optimal","title":"Why MEMORY_RATIO=0.75 is Optimal","text":"<ol> <li> <p>Adaptive Performance: Scales GC frequency with workload</p> <ul> <li>Idle: 0.2 GCs/second (near-zero overhead)</li> <li>Heavy load: 6 GCs/second (still excellent)</li> <li>Automatically adjusts to allocation patterns</li> </ul> </li> <li> <p>Memory Bounded: Respects container resource limits</p> <ul> <li>Works with Kubernetes/Docker memory constraints</li> <li>Never triggers out-of-memory conditions</li> <li>Grew to only 33% of 1.61 GB limit under heavy load</li> </ul> </li> <li> <p>Better Caching: More memory for application data</p> <ul> <li>534 MB vs 502 MB (6% more cache space)</li> <li>Larger thumbnail cache improves performance</li> <li>More room for image buffers and decoded frames</li> </ul> </li> <li> <p>Production Ready: Designed for real-world deployments</p> <ul> <li>Container-aware</li> <li>Handles allocation spikes (235 MB/s peak tested)</li> <li>No manual tuning required</li> </ul> </li> </ol>"},{"location":"admin/memory-tuning/#understanding-gc-metrics","title":"Understanding GC Metrics","text":""},{"location":"admin/memory-tuning/#gc-cpu-fraction","title":"GC CPU Fraction","text":"<p>Metric: <code>media_viewer_go_gc_cpu_fraction</code></p> <p>What it measures: Percentage of CPU time spent in garbage collection.</p> <p>How to interpret:</p> <ul> <li>0.00 - 0.03 (0-3%): \u2705 Excellent - GC overhead is minimal</li> <li>0.03 - 0.05 (3-5%): \u26a0\ufe0f Acceptable - Some overhead but manageable</li> <li>0.05 - 0.10 (5-10%): \u26a0\ufe0f High - Consider tuning</li> <li>&gt; 0.10 (&gt;10%): \u274c Critical - GC consuming too much CPU</li> </ul> <p>Example:</p> <pre><code>GC CPU Fraction: 0.085 (8.5%)\nMeaning: 8.5% of CPU time is spent on garbage collection\nImpact: Application is ~9% slower than optimal\n</code></pre>"},{"location":"admin/memory-tuning/#gc-pause-duration","title":"GC Pause Duration","text":"<p>Metric: <code>media_viewer_go_gc_pause_last_seconds</code></p> <p>What it measures: Duration of the most recent stop-the-world GC pause.</p> <p>How to interpret:</p> <ul> <li>&lt; 1ms: \u2705 Excellent - Barely noticeable</li> <li>1-5ms: \u2705 Good - Acceptable for most workloads</li> <li>5-10ms: \u26a0\ufe0f Noticeable - May cause small latency spikes</li> <li>&gt; 10ms: \u274c Poor - Will cause visible request latency</li> </ul> <p>Why it matters: During GC pauses, ALL goroutines stop. A 10ms pause means HTTP requests, database queries, and thumbnail generation are all delayed by 10ms.</p>"},{"location":"admin/memory-tuning/#gc-frequency","title":"GC Frequency","text":"<p>Metric: <code>rate(media_viewer_go_gc_runs_total[5m])</code></p> <p>What it measures: How many garbage collections occur per second.</p> <p>How to interpret:</p> <ul> <li>&lt; 1 GC/s: \u2705 Excellent - Infrequent, efficient collection</li> <li>1-5 GC/s: \u2705 Good - Reasonable frequency</li> <li>5-10 GC/s: \u26a0\ufe0f High - Consider tuning</li> <li>&gt; 10 GC/s: \u274c Excessive - Memory pressure or poor configuration</li> </ul> <p>Why it matters: Each GC has overhead (pause, CPU cycles, cache invalidation).</p>"},{"location":"admin/memory-tuning/#memory-usage-ratio","title":"Memory Usage Ratio","text":"<p>Metric: <code>media_viewer_memory_usage_ratio</code></p> <p>What it measures: Current memory usage as a fraction of the configured limit.</p> <p>How to interpret:</p> <ul> <li>&lt; 0.70 (70%): Plenty of headroom</li> <li>0.70 - 0.85 (70-85%): Normal operating range</li> <li>0.85 - 0.95 (85-95%): High utilization, GC becomes aggressive</li> <li>&gt; 0.95 (95%): Critical - may trigger memory pressure pauses</li> </ul>"},{"location":"admin/memory-tuning/#configuration-approaches","title":"Configuration Approaches","text":""},{"location":"admin/memory-tuning/#approach-1-memory_ratio-recommended","title":"Approach 1: MEMORY_RATIO (Recommended)","text":"<p>Best for: Containerized deployments with memory limits (Docker, Kubernetes)</p>"},{"location":"admin/memory-tuning/#docker-compose-example","title":"Docker Compose Example","text":"<pre><code>services:\n    media-viewer:\n        environment:\n            - MEMORY_LIMIT=2147483648 # 2 GiB\n            - MEMORY_RATIO=0.75\n        deploy:\n            resources:\n                limits:\n                    memory: 2G\n</code></pre>"},{"location":"admin/memory-tuning/#kubernetes-example","title":"Kubernetes Example","text":"<pre><code>env:\n    - name: MEMORY_LIMIT\n      valueFrom:\n          resourceFieldRef:\n              resource: limits.memory\n    - name: MEMORY_RATIO\n      value: '0.75'\nresources:\n    limits:\n        memory: 2Gi\n</code></pre>"},{"location":"admin/memory-tuning/#how-it-works","title":"How It Works","text":"<p>MEMORY_RATIO sets what percentage of container memory is allocated to the Go heap. The remaining memory is available for:</p> <ul> <li>Operating system overhead</li> <li>FFmpeg video processing</li> <li>CGO allocations (libvips image processing)</li> <li>File system cache</li> </ul> <p>Values:</p> <ul> <li><code>0.75</code> (recommended): 75% for Go heap, 25% for other components</li> <li><code>0.80</code>: More cache, less headroom for FFmpeg/CGO</li> <li><code>0.70</code>: More headroom for heavy video transcoding</li> </ul>"},{"location":"admin/memory-tuning/#monitoring","title":"Monitoring","text":"<p>Watch for:</p> <ul> <li>GC CPU overhead &lt; 1%</li> <li>Memory usage &lt; 80% of limit</li> <li>No memory pressure pauses (<code>media_viewer_memory_gc_pauses_total</code>)</li> </ul>"},{"location":"admin/memory-tuning/#approach-2-gogc","title":"Approach 2: GOGC","text":"<p>Best for: Non-containerized deployments, simple setups, unlimited memory</p>"},{"location":"admin/memory-tuning/#configuration","title":"Configuration","text":"<pre><code>environment:\n    - GOGC=150\n</code></pre>"},{"location":"admin/memory-tuning/#how-it-works_1","title":"How It Works","text":"<p><code>GOGC</code> sets the percentage of heap growth before triggering GC:</p> <ul> <li> <p>GOGC=100 (Go default): GC triggers at 2x live heap</p> <ul> <li>Example: 200 MB heap \u2192 GC at 400 MB</li> </ul> </li> <li> <p>GOGC=150 (recommended): GC triggers at 2.5x live heap</p> <ul> <li>Example: 200 MB heap \u2192 GC at 500 MB</li> <li>Result: 33% fewer GCs</li> </ul> </li> <li> <p>GOGC=200 (aggressive): GC triggers at 3x live heap</p> <ul> <li>Example: 200 MB heap \u2192 GC at 600 MB</li> <li>Result: 50% fewer GCs</li> </ul> </li> </ul>"},{"location":"admin/memory-tuning/#when-to-use","title":"When to Use","text":"<ul> <li>Running on bare metal or VMs (not containerized)</li> <li>No memory limits set</li> <li>Want simple, fixed configuration</li> <li>Have abundant memory available</li> </ul>"},{"location":"admin/memory-tuning/#tuning-process","title":"Tuning Process","text":""},{"location":"admin/memory-tuning/#step-1-establish-baseline","title":"Step 1: Establish Baseline","text":"<p>Enable metrics and run under typical load:</p> <pre><code># Check current GC metrics\ncurl http://localhost:9091/metrics | grep -E \"gc_cpu|gc_runs|memory_usage\"\n</code></pre> <p>Record baseline values:</p> <ul> <li>GC CPU Fraction: ____</li> <li>GC Frequency: ____</li> <li>Memory Usage Ratio: ____</li> </ul>"},{"location":"admin/memory-tuning/#step-2-choose-configuration","title":"Step 2: Choose Configuration","text":"<p>If containerized (Docker/Kubernetes):</p> <pre><code>MEMORY_RATIO=0.75\n</code></pre> <p>If not containerized:</p> <pre><code>GOGC=150\n</code></pre>"},{"location":"admin/memory-tuning/#step-3-monitor-results","title":"Step 3: Monitor Results","text":"<p>Watch Prometheus metrics:</p> <pre><code># GC CPU overhead percentage\nmedia_viewer_go_gc_cpu_fraction * 100\n\n# GC frequency (per second)\nrate(media_viewer_go_gc_runs_total[5m])\n\n# Memory pressure\nmedia_viewer_memory_usage_ratio * 100\n</code></pre>"},{"location":"admin/memory-tuning/#step-4-adjust-if-needed","title":"Step 4: Adjust if Needed","text":""},{"location":"admin/memory-tuning/#if-gc-overhead-is-still-high-3","title":"If GC overhead is still high (&gt;3%)","text":"<p>With MEMORY_RATIO:</p> <ul> <li>Increase container memory limit</li> <li>Ensure MEMORY_LIMIT env var is set correctly</li> </ul> <p>With GOGC:</p> <ul> <li>Increase GOGC value (try 200)</li> <li>Ensure you have enough memory</li> </ul>"},{"location":"admin/memory-tuning/#if-memory-usage-is-too-high-90","title":"If memory usage is too high (&gt;90%)","text":"<p>With MEMORY_RATIO:</p> <ul> <li>Lower to 0.70 (more headroom for FFmpeg/CGO)</li> <li>Or increase container memory</li> </ul> <p>With GOGC:</p> <ul> <li>Lower GOGC value (try 100)</li> <li>Or add memory to the system</li> </ul>"},{"location":"admin/memory-tuning/#common-scenarios","title":"Common Scenarios","text":""},{"location":"admin/memory-tuning/#high-gc-frequency","title":"High GC Frequency","text":"<p>Symptoms:</p> <ul> <li>GC runs &gt; 10/second</li> <li>GC CPU fraction &gt; 5%</li> <li>High allocation rate</li> </ul> <p>Solution (preferred):</p> <pre><code>environment:\n    - MEMORY_LIMIT=2147483648 # Ensure adequate memory\n    - MEMORY_RATIO=0.75\n</code></pre> <p>Solution (alternative):</p> <pre><code>environment:\n    - GOGC=200 # Increase to reduce frequency\n</code></pre>"},{"location":"admin/memory-tuning/#memory-pressure","title":"Memory Pressure","text":"<p>Symptoms:</p> <ul> <li>Memory usage &gt; 85% of limit</li> <li>GC CPU fraction high (&gt;8%)</li> <li>Memory pressure pauses</li> </ul> <p>Solution:</p> <pre><code>environment:\n    - MEMORY_RATIO=0.70 # Was 0.75 - give more headroom\n</code></pre> <p>Or increase container memory:</p> <pre><code>deploy:\n    resources:\n        limits:\n            memory: 3G # Was 2G\n</code></pre>"},{"location":"admin/memory-tuning/#long-gc-pauses","title":"Long GC Pauses","text":"<p>Symptoms:</p> <ul> <li>Individual GC pauses &gt; 10ms</li> <li>Latency spikes in API requests</li> <li>Large heap size</li> </ul> <p>Analysis:</p> <ul> <li>Longer but less frequent pauses are often acceptable</li> <li>Check if it affects user experience</li> <li>Monitor P95/P99 request latency</li> </ul> <p>If truly problematic:</p> <ul> <li>Lower GOGC (reduces heap size)</li> <li>Or accept the trade-off for better throughput</li> </ul>"},{"location":"admin/memory-tuning/#out-of-memory-kills","title":"Out of Memory Kills","text":"<p>Symptoms:</p> <ul> <li>Container restarts unexpectedly</li> <li>Memory usage hits 100%</li> <li>OOM errors in logs</li> </ul> <p>Immediate fix:</p> <pre><code>environment:\n    - MEMORY_RATIO=0.70 # Was 0.75 or higher\n</code></pre> <p>Better solution:</p> <pre><code>deploy:\n    resources:\n        limits:\n            memory: 3G # Increase container memory\n</code></pre>"},{"location":"admin/memory-tuning/#performance-metrics","title":"Performance Metrics","text":""},{"location":"admin/memory-tuning/#before-optimization","title":"Before Optimization","text":"<p>With manual <code>runtime.GC()</code> calls in hot paths:</p> Metric Value GC CPU Overhead 1.88% GC Frequency (idle) 31/sec GC Frequency (load) 31/sec Peak Memory 502 MB Behavior Fixed"},{"location":"admin/memory-tuning/#after-optimization-memory_ratio075","title":"After Optimization (MEMORY_RATIO=0.75)","text":"Metric Value Change GC CPU Overhead 0.16% \u2193 91% GC Frequency (idle) 0.2/sec \u2193 99% GC Frequency (load) 6/sec \u2193 80% Peak Memory 534 MB +6% cache Behavior Adaptive \u2705"},{"location":"admin/memory-tuning/#after-optimization-gogc150","title":"After Optimization (GOGC=150)","text":"Metric Value Change GC CPU Overhead 0.15% \u2193 92% GC Frequency (idle) 4.5/sec \u2193 85% GC Frequency (load) 4.5/sec \u2193 85% Peak Memory 502 MB Stable Behavior Fixed Predictable"},{"location":"admin/memory-tuning/#monitoring-with-prometheus","title":"Monitoring with Prometheus","text":""},{"location":"admin/memory-tuning/#key-queries","title":"Key Queries","text":"<pre><code># GC CPU overhead percentage\nmedia_viewer_go_gc_cpu_fraction * 100\n\n# GC frequency (per second)\nrate(media_viewer_go_gc_runs_total[5m])\n\n# Average GC pause time (milliseconds)\nrate(media_viewer_go_gc_pause_total_seconds[5m]) * 1000\n\n# Memory pressure (% of limit)\nmedia_viewer_go_memalloc_bytes / media_viewer_go_memlimit_bytes * 100\n\n# Allocation rate (MB/second)\nrate(media_viewer_go_memalloc_bytes[5m]) / 1024 / 1024\n</code></pre>"},{"location":"admin/memory-tuning/#grafana-dashboard","title":"Grafana Dashboard","text":"<p>A pre-built dashboard with GC monitoring is available at:</p> <pre><code>hack/grafana/dashboard.json\n</code></pre> <p>The dashboard includes:</p> <ul> <li>GC CPU overhead over time</li> <li>GC frequency trends</li> <li>Memory usage ratio</li> <li>Pause time distribution</li> <li>Allocation rate patterns</li> </ul>"},{"location":"admin/memory-tuning/#alerting","title":"Alerting","text":""},{"location":"admin/memory-tuning/#example-prometheus-alerts","title":"Example Prometheus Alerts","text":"<pre><code># High GC overhead\n- alert: HighGCOverhead\n  expr: media_viewer_go_gc_cpu_fraction &gt; 0.05\n  for: 10m\n  annotations:\n      summary: 'GC consuming &gt;5% of CPU'\n      description: 'Consider increasing GOGC or container memory'\n\n# Memory pressure\n- alert: MemoryPressure\n  expr: media_viewer_memory_usage_ratio &gt; 0.90\n  for: 5m\n  annotations:\n      summary: 'Memory usage &gt;90% of limit'\n      description: 'May trigger aggressive GC or OOM'\n\n# Excessive GC frequency\n- alert: ExcessiveGC\n  expr: rate(media_viewer_go_gc_runs_total[5m]) &gt; 10\n  for: 10m\n  annotations:\n      summary: 'More than 10 GCs per second'\n      description: 'GC running too frequently, tune configuration'\n</code></pre>"},{"location":"admin/memory-tuning/#advanced-topics","title":"Advanced Topics","text":""},{"location":"admin/memory-tuning/#gomemlimit-direct-configuration","title":"GOMEMLIMIT Direct Configuration","text":"<p>For non-containerized deployments, you can set GOMEMLIMIT directly:</p> <pre><code># Set 4 GiB memory limit\nGOMEMLIMIT=4GiB\n\n# Or in bytes\nGOMEMLIMIT=4294967296\n</code></pre> <p>When to use:</p> <ul> <li>Running without containers</li> <li>Want explicit memory limit</li> <li>Not using MEMORY_RATIO</li> </ul> <p>Note: MEMORY_RATIO calculates GOMEMLIMIT automatically from container limits, which is preferred for containerized deployments.</p>"},{"location":"admin/memory-tuning/#allocation-rate-analysis","title":"Allocation Rate Analysis","text":"<p>Monitor allocation patterns to understand GC behavior:</p> <pre><code># Allocation rate during indexing\nrate(media_viewer_go_memalloc_bytes[5m])\n  and on() media_viewer_indexer_running == 1\n\n# Allocation rate during thumbnail generation\nrate(media_viewer_go_memalloc_bytes[1m])\n  and on() rate(media_viewer_thumbnail_generations_total[1m]) &gt; 0\n</code></pre> <p>Typical rates:</p> <ul> <li>Idle: 1-5 MB/s</li> <li>Light browsing: 5-20 MB/s</li> <li>Thumbnail generation: 50-150 MB/s</li> <li>Heavy transcoding: 100-300 MB/s</li> </ul>"},{"location":"admin/memory-tuning/#heap-size-vs-gc-frequency-trade-off","title":"Heap Size vs GC Frequency Trade-off","text":"<p>Understanding the fundamental trade-off:</p> Configuration Heap Size GC Frequency Pros Cons GOGC=50 Smaller High Low memory use High CPU overhead GOGC=100 Medium Medium Balanced (Go default) Moderate of both GOGC=150 Larger Low Low CPU overhead More memory needed GOGC=200 Largest Very low Minimal GC overhead Highest memory need MEMORY_RATIO Dynamic Adaptive Best of both, container-aware Requires limits"},{"location":"admin/memory-tuning/#troubleshooting","title":"Troubleshooting","text":""},{"location":"admin/memory-tuning/#gc-metrics-not-improving-after-tuning","title":"GC metrics not improving after tuning","text":"<p>Check:</p> <ol> <li>Configuration actually applied: <code>curl http://localhost:9091/metrics | grep memlimit</code></li> <li>Container has enough memory: <code>docker stats</code></li> <li>No memory leaks: Monitor <code>media_viewer_go_memsys_bytes</code> over days</li> </ol>"},{"location":"admin/memory-tuning/#container-being-oom-killed","title":"Container being OOM killed","text":"<p>Solutions:</p> <ol> <li>Lower MEMORY_RATIO: <code>0.70</code> instead of <code>0.75</code></li> <li>Increase container memory limit</li> <li>Reduce concurrent operations (INDEX_WORKERS, thumbnail workers)</li> </ol>"},{"location":"admin/memory-tuning/#still-seeing-high-gc-frequency-with-memory_ratio","title":"Still seeing high GC frequency with MEMORY_RATIO","text":"<p>Check:</p> <ol> <li>MEMORY_LIMIT env var is set correctly</li> <li>Container memory limit matches MEMORY_LIMIT</li> <li>Not hitting the limit (check <code>media_viewer_memory_usage_ratio</code>)</li> </ol>"},{"location":"admin/memory-tuning/#memory-usage-growing-endlessly","title":"Memory usage growing endlessly","text":"<p>This suggests a memory leak:</p> <ol> <li>Monitor <code>media_viewer_go_memsys_bytes</code> over time</li> <li>Check if it stabilizes or keeps growing</li> <li>File a bug report with metrics data</li> </ol>"},{"location":"admin/memory-tuning/#see-also","title":"See Also","text":"<ul> <li>Metrics Reference - Detailed metrics documentation</li> <li>Environment Variables - Configuration reference</li> <li>Server Configuration - Performance tuning options</li> <li>Go GC Guide - Official Go documentation</li> </ul>"},{"location":"admin/metrics/","title":"Prometheus Metrics","text":"<p>Media Viewer exposes comprehensive Prometheus metrics for monitoring performance, resource usage, and system health.</p>"},{"location":"admin/metrics/#accessing-metrics","title":"Accessing Metrics","text":"<p>Metrics are exposed at the <code>/metrics</code> endpoint:</p> <pre><code>http://your-server:9090/metrics\n</code></pre> <p>Note that the port (<code>9090</code>) is configurable via the <code>METRICS_PORT</code> environment variable.</p> <p>This endpoint returns metrics in Prometheus text format, suitable for scraping by a Prometheus server.</p>"},{"location":"admin/metrics/#metrics-categories","title":"Metrics Categories","text":""},{"location":"admin/metrics/#http-metrics","title":"HTTP Metrics","text":"<p>Monitor web server performance and request patterns.</p> Metric Type Labels Description <code>media_viewer_http_requests_total</code> Counter <code>method</code>, <code>path</code>, <code>status</code> Total HTTP requests by method, path, and status code <code>media_viewer_http_request_duration_seconds</code> Histogram <code>method</code>, <code>path</code> HTTP request duration distribution <code>media_viewer_http_requests_in_flight</code> Gauge - Number of HTTP requests currently being processed <p>Use cases:</p> <ul> <li>Identify slow endpoints with request duration percentiles</li> <li>Monitor error rates by status code</li> <li>Track request throughput and patterns</li> </ul>"},{"location":"admin/metrics/#database-metrics","title":"Database Metrics","text":"<p>Monitor SQLite database performance and health.</p> Metric Type Labels Description <code>media_viewer_db_queries_total</code> Counter <code>operation</code>, <code>status</code> Total database queries by operation type and status <code>media_viewer_db_query_duration_seconds</code> Histogram <code>operation</code> Database query duration distribution <code>media_viewer_db_connections_open</code> Gauge - Number of open database connections <code>media_viewer_db_size_bytes</code> Gauge <code>file</code> Size of SQLite files (main, WAL, SHM) in bytes <code>media_viewer_db_transaction_duration_seconds</code> Histogram <code>type</code> Transaction duration by type (commit/rollback) <code>media_viewer_db_rows_affected</code> Histogram <code>operation</code> Rows affected by operations (upsert_file, delete_files) <p>Use cases:</p> <ul> <li>Identify slow queries affecting performance</li> <li>Monitor database growth over time</li> <li>Track transaction performance during indexing</li> <li>Detect database lock contention</li> </ul>"},{"location":"admin/metrics/#indexer-metrics","title":"Indexer Metrics","text":"<p>Monitor media library indexing performance.</p> Metric Type Labels Description <code>media_viewer_indexer_runs_total</code> Counter - Total number of indexer runs <code>media_viewer_indexer_last_run_timestamp</code> Gauge - Unix timestamp of last indexer run <code>media_viewer_indexer_last_run_duration_seconds</code> Gauge - Duration of last indexer run <code>media_viewer_indexer_run_duration_seconds</code> Histogram - Distribution of indexer run durations <code>media_viewer_indexer_files_processed_total</code> Counter - Total files processed by indexer <code>media_viewer_indexer_folders_processed_total</code> Counter - Total folders processed by indexer <code>media_viewer_indexer_files_per_second</code> Gauge - Indexing throughput (files per second) <code>media_viewer_indexer_errors_total</code> Counter - Total indexer errors <code>media_viewer_indexer_running</code> Gauge - Whether indexer is running (1=running, 0=idle) <code>media_viewer_indexer_batch_duration_seconds</code> Histogram - Duration of batch database operations <code>media_viewer_indexer_parallel_workers</code> Gauge - Number of parallel workers in last run <p>Use cases:</p> <ul> <li>Monitor indexing performance on NFS/network storage</li> <li>Identify indexing bottlenecks</li> <li>Track indexing throughput and efficiency</li> <li>Alert on indexer failures or long runs</li> </ul>"},{"location":"admin/metrics/#polling-metrics","title":"Polling Metrics","text":"<p>Track change detection for automatic re-indexing.</p> Metric Type Labels Description <code>media_viewer_indexer_poll_checks_total</code> Counter - Total polling checks for file changes <code>media_viewer_indexer_poll_changes_detected_total</code> Counter - Times polling detected changes <code>media_viewer_indexer_poll_duration_seconds</code> Histogram - Duration of polling scans"},{"location":"admin/metrics/#thumbnail-metrics","title":"Thumbnail Metrics","text":"<p>Monitor thumbnail generation performance and cache efficiency.</p> Metric Type Labels Description <code>media_viewer_thumbnail_generations_total</code> Counter <code>type</code>, <code>status</code> Total thumbnail generations by type and status <code>media_viewer_thumbnail_generation_duration_seconds</code> Histogram <code>type</code> Overall thumbnail generation duration <code>media_viewer_thumbnail_generation_duration_detailed_seconds</code> Histogram <code>type</code>, <code>phase</code> Detailed timing by phase (decode/resize/encode/cache) <code>media_viewer_thumbnail_memory_usage_bytes</code> Histogram <code>type</code> Memory allocated during generation <code>media_viewer_thumbnail_ffmpeg_duration_seconds</code> Histogram <code>media_type</code> FFmpeg operation duration for images/videos <code>media_viewer_thumbnail_image_decode_duration_seconds</code> Histogram <code>format</code> Image decoding duration by format (jpeg/png/gif/webp) <code>media_viewer_thumbnail_cache_hits_total</code> Counter - Total thumbnail cache hits <code>media_viewer_thumbnail_cache_misses_total</code> Counter - Total thumbnail cache misses <code>media_viewer_thumbnail_cache_read_latency_seconds</code> Histogram - Cache read latency distribution <code>media_viewer_thumbnail_cache_write_latency_seconds</code> Histogram - Cache write latency distribution <code>media_viewer_thumbnail_cache_size_bytes</code> Gauge - Total cache size in bytes <code>media_viewer_thumbnail_cache_count</code> Gauge - Number of thumbnails in cache <code>media_viewer_thumbnail_generator_running</code> Gauge - Whether generator is running (1=running, 0=idle) <code>media_viewer_thumbnail_batch_processing_rate</code> Gauge - Current generation rate (files per second) <code>media_viewer_thumbnail_generation_batches_total</code> Counter <code>type</code> Completed batches (full/manual) <code>media_viewer_thumbnail_generation_last_duration_seconds</code> Gauge - Duration of last generation run <code>media_viewer_thumbnail_generation_last_timestamp</code> Gauge - Unix timestamp of last completion <code>media_viewer_thumbnail_generation_files</code> Gauge <code>status</code> Files by status (generated/skipped/failed) <p>Use cases:</p> <ul> <li>Monitor cache hit rate to assess cache efficiency</li> <li>Identify expensive thumbnail operations (video vs image)</li> <li>Track memory usage during thumbnail generation</li> <li>Optimize thumbnail generation based on phase timing</li> <li>Alert on high cache miss rates</li> </ul> <p>Phase timing breakdown:</p> <ul> <li><code>decode</code>: FFmpeg decoding (videos) or image library decoding</li> <li><code>resize</code>: Imaging library resize operation</li> <li><code>encode</code>: PNG encoding for thumbnail output</li> <li><code>cache</code>: Writing thumbnail to disk cache</li> </ul>"},{"location":"admin/metrics/#filesystem-metrics","title":"Filesystem Metrics","text":"<p>Monitor filesystem I/O performance, critical for NFS deployments.</p> Metric Type Labels Description <code>media_viewer_filesystem_operation_duration_seconds</code> Histogram <code>directory</code>, <code>operation</code> Filesystem operation duration by directory and type <code>media_viewer_filesystem_operation_errors_total</code> Counter <code>directory</code>, <code>operation</code> Filesystem operation errors <p>Operations: <code>stat</code>, <code>readdir</code>, <code>read</code>, <code>write</code> Directories: Media path, cache path, database path</p> <p>Use cases:</p> <ul> <li>Identify NFS latency issues during indexing</li> <li>Monitor cache directory performance</li> <li>Detect filesystem bottlenecks</li> <li>Compare performance across different storage paths</li> </ul>"},{"location":"admin/metrics/#media-library-metrics","title":"Media Library Metrics","text":"<p>Track library size and content.</p> Metric Type Labels Description <code>media_viewer_media_files_total</code> Gauge <code>type</code> Total files by type (image/video/playlist) <code>media_viewer_media_folders_total</code> Gauge - Total folders in library <code>media_viewer_favorites_total</code> Gauge - Total favorites <code>media_viewer_tags_total</code> Gauge - Total tags"},{"location":"admin/metrics/#transcoder-metrics","title":"Transcoder Metrics","text":"<p>Monitor video transcoding operations.</p> Metric Type Labels Description <code>media_viewer_transcoder_jobs_total</code> Counter <code>status</code> Total transcoding jobs by status <code>media_viewer_transcoder_job_duration_seconds</code> Histogram - Transcoding job duration distribution <code>media_viewer_transcoder_jobs_in_progress</code> Gauge - Transcoding jobs currently in progress <code>media_viewer_transcoder_cache_size_bytes</code> Gauge - Total size of transcoder cache directory <p>Use cases:</p> <ul> <li>Monitor cache growth over time</li> <li>Track transcoding job success and failure rates</li> <li>Identify long-running transcoding operations</li> <li>Determine when cache cleanup is needed</li> </ul>"},{"location":"admin/metrics/#authentication-metrics","title":"Authentication Metrics","text":"<p>Monitor authentication and session management.</p> Metric Type Labels Description <code>media_viewer_auth_attempts_total</code> Counter <code>status</code> Authentication attempts by status (success/failure) <code>media_viewer_active_sessions</code> Gauge - Number of active user sessions"},{"location":"admin/metrics/#memory-metrics","title":"Memory Metrics","text":"<p>Monitor memory usage and garbage collection.</p> Metric Type Labels Description <code>media_viewer_memory_usage_ratio</code> Gauge - Memory usage as ratio of limit (0.0-1.0) <code>media_viewer_memory_paused</code> Gauge - Whether processing is paused due to memory pressure <code>media_viewer_memory_gc_pauses_total</code> Counter - Times processing was paused due to memory pressure <code>media_viewer_go_memlimit_bytes</code> Gauge - Configured GOMEMLIMIT in bytes <code>media_viewer_go_memalloc_bytes</code> Gauge - Current Go heap allocation <code>media_viewer_go_memsys_bytes</code> Gauge - Total memory obtained from OS <code>media_viewer_go_gc_runs_total</code> Counter - Completed garbage collection cycles <code>media_viewer_go_gc_pause_total_seconds</code> Counter - Cumulative time spent in GC pauses <code>media_viewer_go_gc_pause_last_seconds</code> Gauge - Duration of most recent GC pause <code>media_viewer_go_gc_cpu_fraction</code> Gauge - Fraction of CPU time used by GC (0.0-1.0) <p>Use cases:</p> <ul> <li>Monitor memory pressure during indexing</li> <li>Tune GOMEMLIMIT and GOGC for your environment</li> <li>Detect memory leaks</li> <li>Measure GC CPU overhead and pause times</li> <li>Evaluate impact of GC configuration changes</li> </ul>"},{"location":"admin/metrics/#application-info","title":"Application Info","text":"Metric Type Labels Description <code>media_viewer_app_info</code> Gauge <code>version</code>, <code>commit</code>, <code>go_version</code> Application build information"},{"location":"admin/metrics/#prometheus-configuration","title":"Prometheus Configuration","text":"<p>Add Media Viewer to your Prometheus scrape configuration:</p> <pre><code>scrape_configs:\n    - job_name: 'media-viewer'\n      static_configs:\n          - targets: ['media-viewer:8080']\n      metrics_path: '/metrics'\n      scrape_interval: 30s\n</code></pre>"},{"location":"admin/metrics/#example-queries","title":"Example Queries","text":""},{"location":"admin/metrics/#indexing-performance","title":"Indexing Performance","text":"<pre><code># Indexing throughput over time\nrate(media_viewer_indexer_files_processed_total[5m])\n\n# P95 indexer run duration\nhistogram_quantile(0.95, rate(media_viewer_indexer_run_duration_seconds_bucket[5m]))\n\n# Indexing efficiency (files per second)\nmedia_viewer_indexer_files_per_second\n</code></pre>"},{"location":"admin/metrics/#thumbnail-performance","title":"Thumbnail Performance","text":"<pre><code># Cache hit rate\nrate(media_viewer_thumbnail_cache_hits_total[5m])\n  /\n(rate(media_viewer_thumbnail_cache_hits_total[5m])\n  + rate(media_viewer_thumbnail_cache_misses_total[5m]))\n\n# P99 thumbnail generation time by type\nhistogram_quantile(0.99,\n  rate(media_viewer_thumbnail_generation_duration_seconds_bucket[5m]))\n\n# Memory usage per thumbnail by type\nhistogram_quantile(0.95,\n  rate(media_viewer_thumbnail_memory_usage_bytes_bucket[5m]))\n\n# Phase timing breakdown\nhistogram_quantile(0.95,\n  rate(media_viewer_thumbnail_generation_duration_detailed_seconds_bucket[5m]))\n</code></pre>"},{"location":"admin/metrics/#filesystem-performance","title":"Filesystem Performance","text":"<pre><code># P95 filesystem operation latency by operation\nhistogram_quantile(0.95,\n  rate(media_viewer_filesystem_operation_duration_seconds_bucket[5m]))\n\n# Filesystem errors by directory\nrate(media_viewer_filesystem_operation_errors_total[5m])\n</code></pre>"},{"location":"admin/metrics/#database-performance","title":"Database Performance","text":"<pre><code># P95 query duration by operation\nhistogram_quantile(0.95,\n  rate(media_viewer_db_query_duration_seconds_bucket[5m]))\n\n# Transaction commit rate\nrate(media_viewer_db_transaction_duration_seconds_count{type=\"commit\"}[5m])\n\n# Database size growth\nrate(media_viewer_db_size_bytes{file=\"main\"}[1h])\n</code></pre>"},{"location":"admin/metrics/#garbage-collection-performance","title":"Garbage Collection Performance","text":"<p>Monitor CPU overhead and pause times from garbage collection:</p> <pre><code># GC frequency (collections per second)\nrate(media_viewer_go_gc_runs_total[5m])\n\n# Total GC pause time per second (in milliseconds)\nrate(media_viewer_go_gc_pause_total_seconds[5m]) * 1000\n\n# GC CPU overhead percentage\nmedia_viewer_go_gc_cpu_fraction * 100\n\n# Most recent GC pause duration (in milliseconds)\nmedia_viewer_go_gc_pause_last_seconds * 1000\n\n# Memory allocation rate (MB/s)\nrate(media_viewer_go_memalloc_bytes[5m]) / 1024 / 1024\n\n# Memory pressure (% of GOMEMLIMIT used)\nmedia_viewer_go_memalloc_bytes / media_viewer_go_memlimit_bytes * 100\n\n# GC efficiency: bytes allocated per GC cycle\nrate(media_viewer_go_memalloc_bytes[5m]) / rate(media_viewer_go_gc_runs_total[5m])\n</code></pre> <p>Interpreting GC metrics:</p> <ul> <li>GC CPU Fraction &gt; 0.05 (5%): GC overhead is high, consider tuning</li> <li>GC Frequency &gt; 1/sec: Very frequent collections, increase <code>GOGC</code> or <code>GOMEMLIMIT</code></li> <li>Pause Time &gt; 10ms: May cause latency spikes in request handling</li> <li>Memory Pressure &gt; 90%: Runtime is aggressively GC'ing to stay under limit</li> </ul> <p>For detailed tuning guidance, see Memory and GC Tuning.</p> <pre><code>### HTTP Performance\n\n```promql\n# Request rate by endpoint\nrate(media_viewer_http_requests_total[5m])\n\n# P95 request duration\nhistogram_quantile(0.95,\n  rate(media_viewer_http_request_duration_seconds_bucket[5m]))\n\n# Error rate (4xx + 5xx)\nsum(rate(media_viewer_http_requests_total{status=~\"4..|5..\"}[5m]))\n</code></pre>"},{"location":"admin/metrics/#transcoder-performance","title":"Transcoder Performance","text":"<pre><code># Transcoder cache size\nmedia_viewer_transcoder_cache_size_bytes\n\n# Transcoding job rate by status\nrate(media_viewer_transcoder_jobs_total[5m])\n\n# P95 transcoding duration\nhistogram_quantile(0.95,\n  rate(media_viewer_transcoder_job_duration_seconds_bucket[5m]))\n\n# Active transcoding jobs\nmedia_viewer_transcoder_jobs_in_progress\n</code></pre>"},{"location":"admin/metrics/#grafana-dashboard","title":"Grafana Dashboard","text":"<p>A pre-built Grafana dashboard is available at:</p> <pre><code>hack/grafana/dashboard.json\n</code></pre> <p>Import this dashboard to visualize:</p> <ul> <li>Indexing performance and throughput</li> <li>Thumbnail generation metrics and cache efficiency</li> <li>Filesystem I/O latency (critical for NFS)</li> <li>Database performance</li> <li>Memory usage and GC activity</li> <li>HTTP request rates and latencies</li> <li>Transcoder job performance and cache growth</li> </ul>"},{"location":"admin/metrics/#alerting-examples","title":"Alerting Examples","text":""},{"location":"admin/metrics/#indexer-alerts","title":"Indexer Alerts","text":"<pre><code># Indexer taking too long\n- alert: SlowIndexing\n  expr: media_viewer_indexer_last_run_duration_seconds &gt; 3600\n  for: 5m\n  annotations:\n      summary: 'Indexer run took over 1 hour'\n\n# Indexer stuck\n- alert: IndexerStuck\n  expr: time() - media_viewer_indexer_last_run_timestamp &gt; 14400\n  for: 10m\n  annotations:\n      summary: 'No indexer run in 4 hours'\n</code></pre>"},{"location":"admin/metrics/#thumbnail-alerts","title":"Thumbnail Alerts","text":"<pre><code># Low cache hit rate\n- alert: LowThumbnailCacheHitRate\n  expr: |\n      rate(media_viewer_thumbnail_cache_hits_total[15m])\n      /\n      (rate(media_viewer_thumbnail_cache_hits_total[15m])\n        + rate(media_viewer_thumbnail_cache_misses_total[15m])) &lt; 0.5\n  for: 30m\n  annotations:\n      summary: 'Thumbnail cache hit rate below 50%'\n</code></pre>"},{"location":"admin/metrics/#filesystem-alerts","title":"Filesystem Alerts","text":"<pre><code># High filesystem latency (NFS issues)\n- alert: HighFilesystemLatency\n  expr: |\n      histogram_quantile(0.95,\n        rate(media_viewer_filesystem_operation_duration_seconds_bucket[5m])) &gt; 1\n  for: 10m\n  annotations:\n      summary: 'P95 filesystem operation latency over 1 second'\n</code></pre>"},{"location":"admin/metrics/#transcoder-alerts","title":"Transcoder Alerts","text":"<pre><code># Large transcoder cache\n- alert: LargeTranscoderCache\n  expr: media_viewer_transcoder_cache_size_bytes &gt; 10737418240 # 10GB\n  for: 30m\n  annotations:\n      summary: 'Transcoder cache size exceeds 10GB'\n</code></pre>"},{"location":"admin/metrics/#memory-alerts","title":"Memory Alerts","text":"<pre><code># Memory pressure\n- alert: MemoryPressure\n  expr: media_viewer_memory_usage_ratio &gt; 0.9\n  for: 5m\n  annotations:\n      summary: 'Memory usage over 90% of limit'\n</code></pre>"},{"location":"admin/metrics/#performance-tuning","title":"Performance Tuning","text":"<p>Use metrics to guide performance optimization:</p> <ol> <li>NFS Latency: Monitor <code>filesystem_operation_duration</code> to identify slow storage</li> <li>Indexing Speed: Use <code>indexer_files_per_second</code> and <code>indexer_batch_duration</code> to tune batch sizes</li> <li>Thumbnail Generation: Analyze phase timing to optimize FFmpeg vs resize vs encoding</li> <li>Memory Usage: Track <code>thumbnail_memory_usage_bytes</code> to tune concurrent generation limits</li> <li>Cache Efficiency: Monitor cache hit rates to adjust cache size and eviction policies</li> <li>Transcoder Cache: Track <code>transcoder_cache_size_bytes</code> to determine when cache cleanup is needed</li> </ol>"},{"location":"admin/metrics/#see-also","title":"See Also","text":"<ul> <li>Memory and GC Tuning - Optimize garbage collection and memory usage</li> <li>Server Configuration - Performance configuration options</li> <li>Thumbnail Management - Thumbnail generation and caching</li> <li>Environment Variables - Configuration reference</li> </ul>"},{"location":"admin/overview/","title":"Administration Overview","text":"<p>This section covers server administration, configuration, and monitoring for Media Viewer.</p>"},{"location":"admin/overview/#configuration","title":"Configuration","text":"<ul> <li>Server Configuration - Directory structure, Docker deployment, and performance tuning</li> <li>Environment Variables - Complete environment variable reference</li> <li>Security - Authentication, session management, and security best practices</li> </ul>"},{"location":"admin/overview/#monitoring-operations","title":"Monitoring &amp; Operations","text":"<ul> <li>Metrics &amp; Monitoring - Prometheus metrics for performance monitoring and alerting</li> <li>Memory &amp; GC Tuning - Optimize garbage collection and memory usage</li> <li>Thumbnail Management - Thumbnail generation, caching, and maintenance</li> </ul>"},{"location":"admin/overview/#advanced-features","title":"Advanced Features","text":"<ul> <li>WebAuthn Setup - Passwordless authentication with passkeys</li> </ul>"},{"location":"admin/overview/#common-tasks","title":"Common Tasks","text":""},{"location":"admin/overview/#deployment","title":"Deployment","text":"<ol> <li>Configure environment variables for your paths and settings</li> <li>Set up volume mounts for media, cache, and database directories</li> <li>Configure security settings including strong passwords</li> <li>Review server configuration for performance tuning</li> </ol>"},{"location":"admin/overview/#monitoring","title":"Monitoring","text":"<ol> <li>Enable Prometheus metrics endpoint at <code>/metrics</code></li> <li>Configure Prometheus to scrape your Media Viewer instance</li> <li>Import the provided Grafana dashboard from <code>hack/grafana/dashboard.json</code></li> <li>Set up alerts for indexer failures, high latency, and memory pressure</li> </ol>"},{"location":"admin/overview/#maintenance","title":"Maintenance","text":"<ul> <li>Clear Thumbnail Cache: Use the clear cache button to regenerate all thumbnails</li> <li>Database Vacuum: Runs automatically during indexing to reclaim space</li> <li>Session Cleanup: Expired sessions are automatically removed</li> <li>Cache Management: Monitor cache size via metrics</li> </ul>"},{"location":"admin/overview/#performance-tuning","title":"Performance Tuning","text":"<p>Use Prometheus metrics to identify bottlenecks:</p> <ul> <li>Filesystem Latency: Critical for NFS deployments - monitor <code>filesystem_operation_duration</code></li> <li>Indexing Performance: Track <code>indexer_files_per_second</code> and batch processing times</li> <li>Thumbnail Generation: Analyze phase timing (decode/resize/encode) to optimize</li> <li>Memory &amp; GC: Tune <code>MEMORY_RATIO</code> or <code>GOGC</code> for optimal performance - see Memory &amp; GC Tuning</li> <li>Database Performance: Watch transaction durations and query latencies</li> </ul> <p>See Metrics &amp; Monitoring for detailed guidance.</p>"},{"location":"admin/overview/#troubleshooting","title":"Troubleshooting","text":"<p>For common issues and solutions, see the Troubleshooting Guide.</p> <p>Key troubleshooting resources:</p> <ul> <li>Check application logs for errors</li> <li>Review metrics for performance anomalies</li> <li>Validate file permissions on mounted volumes</li> <li>Verify FFmpeg is available for video/image processing</li> </ul>"},{"location":"admin/security/","title":"Security","text":"<p>This guide covers security considerations for deploying Media Viewer.</p>"},{"location":"admin/security/#authentication","title":"Authentication","text":""},{"location":"admin/security/#password-protection","title":"Password Protection","text":"<p>Media Viewer uses a single user account with password authentication.</p> <p>Best practices:</p> <ul> <li>Use a strong, unique password (12+ characters)</li> <li>Include mixed case, numbers, and symbols</li> <li>Do not reuse passwords from other services</li> <li>Change the password periodically</li> </ul>"},{"location":"admin/security/#webauthnpasskey-authentication","title":"WebAuthn/Passkey Authentication","text":"<p>When WebAuthn is enabled, users can authenticate with:</p> <ul> <li>Biometric authentication (Face ID, Touch ID, Windows Hello)</li> <li>Security keys (YubiKey, Titan, etc.)</li> </ul> <p>Security benefits:</p> <ul> <li>Phishing-resistant (keys are cryptographically bound to your domain)</li> <li>No password to steal or guess</li> <li>User verification required (biometric or PIN)</li> <li>Private keys never leave the user's device</li> </ul> <p>Requirements:</p> <ul> <li>HTTPS (except <code>http://localhost</code> for development)</li> <li>Properly configured RP ID matching your domain</li> <li>Modern browser with WebAuthn support</li> </ul>"},{"location":"admin/security/#session-management","title":"Session Management","text":"<p>Sessions expire after the configured duration (default: 24 hours) with sliding expiration.</p> <ul> <li>Active usage extends session lifetime via keepalive</li> <li>Closing the browser does not immediately end the session</li> <li>Sessions are stored server-side with SHA-256 hashed tokens</li> <li>Sessions are invalidated on password change</li> </ul>"},{"location":"admin/security/#changing-password","title":"Changing Password","text":"<p>Users can change the password from the Settings modal:</p> <ol> <li>Open Settings (\u2699\ufe0f icon)</li> <li>Navigate to Security tab</li> <li>Enter current password</li> <li>Enter and confirm new password</li> <li>Click Update Password</li> </ol> <p>Note: Changing the password invalidates all existing sessions on all devices.</p>"},{"location":"admin/security/#network-security","title":"Network Security","text":""},{"location":"admin/security/#https","title":"HTTPS","text":"<p>Always use HTTPS in production to protect:</p> <ul> <li>Password transmission during login</li> <li>Session cookies</li> <li>Media content in transit</li> <li>WebAuthn ceremonies</li> </ul> <p>Using a reverse proxy:</p> <pre><code>server {\n    listen 443 ssl http2;\n    server_name media.example.com;\n\n    ssl_certificate /path/to/cert.pem;\n    ssl_certificate_key /path/to/key.pem;\n\n    # Modern SSL configuration\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers on;\n\n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        # Increase timeouts for video streaming\n        proxy_read_timeout 300s;\n        proxy_send_timeout 300s;\n    }\n}\n</code></pre>"},{"location":"admin/security/#firewall","title":"Firewall","text":"<p>Restrict access to trusted networks:</p> <ul> <li>Do not expose directly to the internet without HTTPS</li> <li>Consider VPN access for remote viewing</li> <li>Use firewall rules to limit source IPs if possible</li> </ul>"},{"location":"admin/security/#rate-limiting","title":"Rate Limiting","text":"<p>Consider adding rate limiting at the reverse proxy level:</p> <pre><code># Limit login attempts\nlimit_req_zone $binary_remote_addr zone=login:10m rate=5r/m;\n\nlocation /api/auth/login {\n    limit_req zone=login burst=3 nodelay;\n    proxy_pass http://localhost:8080;\n}\n</code></pre>"},{"location":"admin/security/#file-system-security","title":"File System Security","text":""},{"location":"admin/security/#read-only-media-mount","title":"Read-Only Media Mount","text":"<p>Mount your media directory as read-only:</p> <pre><code>-v /path/to/media:/media:ro\n</code></pre> <p>This prevents the application from modifying your original files.</p>"},{"location":"admin/security/#cache-directory-permissions","title":"Cache Directory Permissions","text":"<p>The cache directory requires write access but should be restricted:</p> <pre><code># Create dedicated directory\nmkdir -p /var/lib/media-viewer/cache\nchown 1000:1000 /var/lib/media-viewer/cache\nchmod 700 /var/lib/media-viewer/cache\n</code></pre>"},{"location":"admin/security/#database-directory-permissions","title":"Database Directory Permissions","text":"<p>The database directory requires write access and contains sensitive data:</p> <pre><code># Create dedicated directory\nmkdir -p /var/lib/media-viewer/database\nchown 1000:1000 /var/lib/media-viewer/database\nchmod 700 /var/lib/media-viewer/database\n</code></pre>"},{"location":"admin/security/#container-security","title":"Container Security","text":""},{"location":"admin/security/#non-root-user","title":"Non-Root User","text":"<p>The container runs as a non-root user by default (UID 1000).</p>"},{"location":"admin/security/#resource-limits","title":"Resource Limits","text":"<p>Set resource limits to prevent resource exhaustion:</p> <pre><code>services:\n    media-viewer:\n        # ...\n        deploy:\n            resources:\n                limits:\n                    memory: 512M\n                    cpus: '1.0'\n                reservations:\n                    memory: 256M\n                    cpus: '0.5'\n</code></pre>"},{"location":"admin/security/#network-isolation","title":"Network Isolation","text":"<p>Use Docker networks to isolate the container:</p> <pre><code>services:\n    media-viewer:\n        # ...\n        networks:\n            - media-internal\n\nnetworks:\n    media-internal:\n        internal: true # No external access\n</code></pre> <p>Or allow external access only through a reverse proxy:</p> <pre><code>networks:\n    media-internal:\n        internal: false\n    reverse-proxy:\n        external: true\n\nservices:\n    media-viewer:\n        networks:\n            - media-internal\n\n    nginx:\n        networks:\n            - media-internal\n            - reverse-proxy\n</code></pre>"},{"location":"admin/security/#security-scanning","title":"Security Scanning","text":"<p>Scan the container image for vulnerabilities:</p> <pre><code># Using Trivy\ndocker run --rm -v /var/run/docker.sock:/var/run/docker.sock \\\n  aquasec/trivy image ghcr.io/djryanj/media-viewer:latest\n\n# Using Docker Scout\ndocker scout cves ghcr.io/djryanj/media-viewer:latest\n</code></pre>"},{"location":"admin/security/#data-protection","title":"Data Protection","text":""},{"location":"admin/security/#backup","title":"Backup","text":"<p>Regularly backup the database directory:</p> <ul> <li>Database contains tags, favorites, user data, and sessions</li> <li>Thumbnails can be regenerated if lost</li> <li>Transcoded videos can be regenerated if lost</li> </ul> <pre><code># Automated backup script\n#!/bin/bash\nBACKUP_DIR=/backups/media-viewer\nDATE=$(date +%Y%m%d-%H%M%S)\n\ndocker run --rm \\\n  -v media-database:/source:ro \\\n  -v $BACKUP_DIR:/backup \\\n  alpine tar czf /backup/database-$DATE.tar.gz -C /source .\n\n# Keep only last 30 days\nfind $BACKUP_DIR -name \"database-*.tar.gz\" -mtime +30 -delete\n</code></pre>"},{"location":"admin/security/#encryption-at-rest","title":"Encryption at Rest","text":"<p>For sensitive media, consider:</p> <ul> <li>Encrypted file systems for media storage (LUKS, VeraCrypt)</li> <li>Encrypted volumes for the database directory</li> <li>Hardware-level encryption (self-encrypting drives)</li> </ul>"},{"location":"admin/security/#security-checklist","title":"Security Checklist","text":"<ul> <li> Strong, unique password configured</li> <li> HTTPS enabled via reverse proxy</li> <li> Media mounted read-only</li> <li> Cache and database directories have restricted permissions</li> <li> Firewall limits access to trusted networks</li> <li> Regular backups configured</li> <li> Resource limits set</li> <li> Network isolation configured (optional)</li> <li> WebAuthn/passkeys enabled (optional but recommended)</li> <li> Security scanning performed on container images</li> <li> Logs monitored for suspicious activity</li> </ul>"},{"location":"admin/security/#incident-response","title":"Incident Response","text":"<p>If you suspect unauthorized access:</p> <ol> <li>Immediately change the password via Settings or <code>resetpw</code> tool</li> <li>Check sessions in the database: <code>SELECT * FROM sessions;</code></li> <li>Invalidate all sessions: <code>DELETE FROM sessions;</code></li> <li>Review logs for suspicious activity</li> <li>Check for unexpected changes to favorites or tags</li> <li>Review WebAuthn credentials if enabled (Settings \u2192 Passkeys)</li> <li>Consider rotating encryption keys if using encrypted storage</li> </ol>"},{"location":"admin/security/#reporting-security-issues","title":"Reporting Security Issues","text":"<p>If you discover a security vulnerability, please report it privately to the maintainers via GitHub Security Advisories rather than creating a public issue.</p>"},{"location":"admin/server-config/","title":"Server Configuration","text":"<p>This guide covers server-side configuration and deployment considerations for Media Viewer.</p>"},{"location":"admin/server-config/#directory-structure","title":"Directory Structure","text":"<p>Media Viewer uses three primary directories:</p>"},{"location":"admin/server-config/#media-directory","title":"Media Directory","text":"<p>The read-only directory containing your media files.</p> <ul> <li>Default path: <code>/media</code></li> <li>Configure with: <code>MEDIA_DIR</code> environment variable</li> <li>Mount as read-only for security: <code>-v /path/to/media:/media:ro</code></li> </ul> <p>Supported file types:</p> Type Extensions Images <code>.jpg</code>, <code>.jpeg</code>, <code>.png</code>, <code>.gif</code>, <code>.webp</code>, <code>.bmp</code>, <code>.svg</code>, <code>.ico</code>, <code>.tiff</code>, <code>.heic</code>, <code>.heif</code>, <code>.avif</code>, <code>.jxl</code>, <code>.raw</code>, <code>.cr2</code>, <code>.nef</code>, <code>.arw</code>, <code>.dng</code> Videos <code>.mp4</code>, <code>.mkv</code>, <code>.avi</code>, <code>.mov</code>, <code>.wmv</code>, <code>.flv</code>, <code>.webm</code>, <code>.m4v</code>, <code>.mpeg</code>, <code>.mpg</code>, <code>.3gp</code>, <code>.ts</code> Playlists <code>.wpl</code> (Windows Media Player playlists)"},{"location":"admin/server-config/#cache-directory","title":"Cache Directory","text":"<p>Stores thumbnails and transcoded videos.</p> <ul> <li>Default path: <code>/cache</code></li> <li>Configure with: <code>CACHE_DIR</code> environment variable</li> <li>Must be writable</li> <li>Should be persisted between container restarts</li> </ul> <p>Contents:</p> <ul> <li><code>thumbnails/</code> - Generated thumbnail cache</li> <li><code>transcodes/</code> - Transcoded video files</li> </ul>"},{"location":"admin/server-config/#database-directory","title":"Database Directory","text":"<p>Stores the SQLite database.</p> <ul> <li>Default path: <code>/database</code></li> <li>Configure with: <code>DATABASE_DIR</code> environment variable</li> <li>Must be writable</li> <li>Should be persisted between container restarts</li> </ul> <p>Contents:</p> <ul> <li><code>media.db</code> - SQLite database containing index, tags, favorites, user data, and sessions</li> </ul>"},{"location":"admin/server-config/#database","title":"Database","text":"<p>Media Viewer uses SQLite for data storage. The database is automatically created on first run.</p>"},{"location":"admin/server-config/#database-contents","title":"Database Contents","text":"<ul> <li>File index (paths, sizes, modification dates)</li> <li>Tags and tag assignments</li> <li>Favorites</li> <li>User account and sessions</li> <li>WebAuthn credentials (if enabled)</li> </ul>"},{"location":"admin/server-config/#database-location","title":"Database Location","text":"<p>The database file is stored at <code>{DATABASE_DIR}/media.db</code>.</p>"},{"location":"admin/server-config/#backup","title":"Backup","text":"<p>To backup your data:</p> <pre><code># Stop the container first for consistency\ndocker stop media-viewer\n\n# Copy the database\ndocker cp media-viewer:/database/media.db ./backup/media.db\n\n# Or if using volumes\ndocker run --rm -v media-database:/data -v $(pwd)/backup:/backup alpine cp /data/media.db /backup/\n\n# Restart\ndocker start media-viewer\n</code></pre>"},{"location":"admin/server-config/#indexing","title":"Indexing","text":"<p>Media Viewer automatically indexes your media library on startup and periodically thereafter.</p>"},{"location":"admin/server-config/#initial-index","title":"Initial Index","text":"<p>On first run, the application scans your entire media directory. This may take several minutes for large libraries.</p>"},{"location":"admin/server-config/#change-detection","title":"Change Detection","text":"<p>The indexer uses polling-based change detection (default: every 30 seconds) to find new, modified, or deleted files.</p>"},{"location":"admin/server-config/#full-reindex","title":"Full Reindex","text":"<p>Full reindexing happens automatically at the configured interval (default: every 30 minutes).</p>"},{"location":"admin/server-config/#manual-reindex","title":"Manual Reindex","text":"<p>To force a reindex:</p> <ol> <li>Open Settings \u2192 Cache tab</li> <li>Click Reindex Now</li> </ol> <p>Or use the API:</p> <pre><code>curl -X POST http://localhost:8080/api/reindex \\\n  -H \"Cookie: session=YOUR_SESSION_TOKEN\"\n</code></pre>"},{"location":"admin/server-config/#resource-requirements","title":"Resource Requirements","text":""},{"location":"admin/server-config/#memory","title":"Memory","text":"<ul> <li>Base: ~100MB</li> <li>Add ~1MB per 10,000 indexed files</li> <li>Thumbnail generation temporarily increases memory usage</li> <li>FFmpeg processes for video transcoding require additional memory</li> </ul>"},{"location":"admin/server-config/#storage","title":"Storage","text":"<ul> <li>Database: ~1KB per indexed file</li> <li>Thumbnails: ~10-50KB per image/video</li> <li>Transcoded videos: Varies based on source file size and quality</li> </ul>"},{"location":"admin/server-config/#cpu","title":"CPU","text":"<ul> <li>Thumbnail generation is CPU-intensive</li> <li>Video transcoding is very CPU-intensive</li> <li>Parallel workers scale based on available CPU cores</li> </ul>"},{"location":"admin/server-config/#logging","title":"Logging","text":"<p>Media Viewer logs to stdout, which Docker captures automatically.</p>"},{"location":"admin/server-config/#viewing-logs","title":"Viewing Logs","text":"<pre><code>docker logs media-viewer\ndocker logs -f media-viewer  # Follow mode\ndocker logs --tail 100 media-viewer  # Last 100 lines\n</code></pre>"},{"location":"admin/server-config/#log-levels","title":"Log Levels","text":"<p>Configure with <code>LOG_LEVEL</code> environment variable:</p> Level Description <code>debug</code> Detailed debugging information <code>info</code> Normal operational messages (default) <code>warn</code> Warning messages <code>error</code> Error messages only"},{"location":"admin/server-config/#log-filtering","title":"Log Filtering","text":"<p>Configure what gets logged:</p> <ul> <li><code>LOG_STATIC_FILES</code> - Log static file requests (default: <code>false</code>)</li> <li><code>LOG_HEALTH_CHECKS</code> - Log health check requests (default: <code>true</code>)</li> </ul>"},{"location":"admin/server-config/#health-checks","title":"Health Checks","text":"<p>The application provides multiple health endpoints for monitoring:</p> <pre><code>GET /health\n</code></pre> <p>Returns <code>200 OK</code> when the application is healthy.</p>"},{"location":"admin/server-config/#docker-health-check","title":"Docker Health Check","text":"<pre><code>healthcheck:\n    test: ['CMD', 'curl', '-f', 'http://localhost:8080/health']\n    interval: 30s\n    timeout: 10s\n    retries: 3\n</code></pre>"},{"location":"admin/server-config/#monitoring","title":"Monitoring","text":"<p>Media Viewer exposes comprehensive Prometheus metrics for performance monitoring and alerting.</p>"},{"location":"admin/server-config/#metrics-endpoint","title":"Metrics Endpoint","text":"<p>Prometheus metrics are available at:</p> <pre><code>GET /metrics\n</code></pre> <p>See the Metrics &amp; Monitoring guide for:</p> <ul> <li>Complete metrics reference</li> <li>Prometheus and Grafana configuration</li> <li>Example queries and dashboards</li> <li>Alerting rules</li> <li>Performance tuning guidance</li> </ul> <p>Key metrics include:</p> <ul> <li>Indexing Performance: Run duration, throughput, batch processing times</li> <li>Thumbnail Generation: Cache hit rates, memory usage, phase timing</li> <li>Filesystem I/O: Critical for NFS deployments - operation latencies</li> <li>Database Performance: Transaction durations, query latencies</li> <li>Memory Usage: Heap allocation, GC activity, memory pressure</li> </ul>"},{"location":"admin/thumbnails/","title":"Thumbnail Management","text":"<p>Media Viewer generates thumbnails for images and videos to provide fast gallery browsing.</p>"},{"location":"admin/thumbnails/#how-thumbnails-work","title":"How Thumbnails Work","text":""},{"location":"admin/thumbnails/#generation","title":"Generation","text":"<p>Thumbnails are generated:</p> <ul> <li>On-demand when an item is first viewed</li> <li>Incrementally in the background after media indexing</li> <li>Periodically via full scan (configurable with <code>THUMBNAIL_INTERVAL</code>)</li> </ul>"},{"location":"admin/thumbnails/#storage","title":"Storage","text":"<p>Thumbnails are stored in the cache directory:</p> <pre><code>{DATA_PATH}/thumbnails/\n</code></pre> <p>The thumbnail cache can grow significantly for large libraries. Plan storage accordingly.</p>"},{"location":"admin/thumbnails/#caching","title":"Caching","text":"<ul> <li>Thumbnails are cached indefinitely until manually cleared</li> <li>Browser caching further improves performance</li> <li>The PWA caches thumbnails for offline access</li> </ul>"},{"location":"admin/thumbnails/#cache-management","title":"Cache Management","text":""},{"location":"admin/thumbnails/#viewing-cache-status","title":"Viewing Cache Status","text":"<p>The stats bar at the bottom of the gallery shows library statistics, including when the library was last indexed.</p>"},{"location":"admin/thumbnails/#clearing-the-cache","title":"Clearing the Cache","text":"<p>To clear and rebuild all thumbnails:</p> <ol> <li>Click the clear cache button (trash icon) in the header</li> <li>Confirm the action</li> <li>The page reloads and thumbnails regenerate in the background</li> </ol> <p>This is useful when:</p> <ul> <li>Thumbnails appear corrupted</li> <li>You want to reclaim disk space and regenerate</li> <li>Source files have been modified</li> </ul>"},{"location":"admin/thumbnails/#manual-cache-clearing","title":"Manual Cache Clearing","text":"<p>To manually clear the thumbnail cache:</p> <pre><code># Stop the container\ndocker stop media-viewer\n\n# Remove thumbnail directory\nrm -rf /path/to/data/thumbnails\n\n# Restart\ndocker start media-viewer\n</code></pre> <p>Thumbnails regenerate on-demand as items are viewed.</p>"},{"location":"admin/thumbnails/#thumbnail-quality","title":"Thumbnail Quality","text":""},{"location":"admin/thumbnails/#images","title":"Images","text":"<p>Image thumbnails preserve aspect ratio and are optimized for gallery display.</p>"},{"location":"admin/thumbnails/#videos","title":"Videos","text":"<p>Video thumbnails are extracted from an early frame of the video. The exact frame may vary based on video encoding.</p>"},{"location":"admin/thumbnails/#folders","title":"Folders","text":"<p>Folder thumbnails show a preview of contents when available, or a folder icon otherwise.</p>"},{"location":"admin/thumbnails/#performance-considerations","title":"Performance Considerations","text":""},{"location":"admin/thumbnails/#initial-load","title":"Initial Load","text":"<p>First-time viewing of items requires thumbnail generation, which may cause brief delays. Subsequent views are instant.</p>"},{"location":"admin/thumbnails/#background-generation","title":"Background Generation","text":"<p>After clearing the cache, thumbnails regenerate in the background. You may notice:</p> <ul> <li>Brief loading indicators on items</li> <li>Gradual appearance of thumbnails</li> <li>Temporary increase in CPU usage</li> </ul>"},{"location":"admin/thumbnails/#storage-space","title":"Storage Space","text":"<p>Estimate thumbnail storage:</p> <ul> <li>~10-50KB per image</li> <li>~20-100KB per video</li> <li>Plan for 1-5% of your media library size</li> </ul>"},{"location":"admin/thumbnails/#network-usage","title":"Network Usage","text":"<p>Thumbnails are transferred to browsers on demand. For remote access over slow connections:</p> <ul> <li>Initial gallery load transfers visible thumbnails</li> <li>Scrolling loads additional thumbnails</li> <li>PWA installation caches thumbnails locally</li> </ul>"},{"location":"admin/thumbnails/#troubleshooting","title":"Troubleshooting","text":""},{"location":"admin/thumbnails/#thumbnail-generation-failures","title":"Thumbnail Generation Failures","text":"<p>When thumbnails fail to generate, detailed error logs are written to help diagnose issues:</p> <p>Log Format:</p> <pre><code>ERROR Thumbnail generation failed for /path/to/file.jpg (type: image): &lt;error details&gt;\n</code></pre> <p>Common Failure Scenarios:</p> <ul> <li>Image decode failures: Logs show which decode method failed (constrained load, imaging.Open, or FFmpeg fallback) with specific error details</li> <li>FFmpeg errors: Logs include FFmpeg stderr output for video/image processing failures</li> <li>Encoding errors: Logs specify whether PNG or JPEG encoding failed</li> <li>Folder thumbnail components: Individual file failures within folder thumbnails are logged as warnings</li> </ul> <p>Checking Logs:</p> <pre><code># View recent thumbnail errors\ndocker logs media-viewer 2&gt;&amp;1 | grep \"Thumbnail.*failed\"\n\n# Follow thumbnail generation in real-time\ndocker logs -f media-viewer 2&gt;&amp;1 | grep -i thumbnail\n</code></pre> <p>Resolution Steps:</p> <ol> <li>Check log output for specific file paths and error messages</li> <li>Verify file permissions and integrity</li> <li>For FFmpeg failures, check that FFmpeg is available and supports the file format</li> <li>For large images, consider memory constraints and <code>MAX_IMAGE_DIMENSION</code> settings</li> <li>Invalid or corrupted files may need repair or exclusion from the library</li> </ol>"},{"location":"admin/thumbnails/#monitoring","title":"Monitoring","text":"<p>Use Prometheus metrics to monitor thumbnail generation performance:</p>"},{"location":"admin/thumbnails/#key-metrics","title":"Key Metrics","text":"<ul> <li>Cache Hit Rate: <code>thumbnail_cache_hits_total</code> / (<code>thumbnail_cache_hits_total</code> + <code>thumbnail_cache_misses_total</code>)</li> <li>Generation Duration: <code>thumbnail_generation_duration_seconds</code> - P50/P95/P99 latencies by type</li> <li>Memory Usage: <code>thumbnail_memory_usage_bytes</code> - Memory allocated per thumbnail</li> <li>Phase Timing: <code>thumbnail_generation_duration_detailed_seconds</code> - Breakdown by decode/resize/encode/cache</li> <li>Cache Size: <code>thumbnail_cache_size_bytes</code> and <code>thumbnail_cache_count</code></li> <li>Error Rate: <code>thumbnail_generations_total{status=\"error*\"}</code> - Track different error types</li> </ul>"},{"location":"admin/thumbnails/#performance-tuning","title":"Performance Tuning","text":"<p>Monitor these metrics to optimize:</p> <ol> <li>Cache efficiency: Low hit rate may indicate cache issues or high user activity</li> <li>Generation bottlenecks: Compare phase timings to identify decode vs resize vs encode issues</li> <li>Memory pressure: High memory usage per thumbnail may require tuning</li> <li>FFmpeg performance: <code>thumbnail_ffmpeg_duration_seconds</code> tracks video/image decode time</li> </ol> <p>See the Metrics &amp; Monitoring guide for detailed queries and alerting examples.</p>"},{"location":"admin/webauthn/","title":"WebAuthn (Passkey) Authentication","text":"<p>Media Viewer supports passwordless authentication using passkeys (WebAuthn/FIDO2), allowing users to sign in with biometrics or security keys instead of passwords.</p>"},{"location":"admin/webauthn/#overview","title":"Overview","text":"<p>Passkeys provide a more secure and convenient authentication method compared to traditional passwords:</p> <ul> <li>No passwords to remember - Use your device's biometrics or security key</li> <li>Phishing-resistant - Passkeys are cryptographically bound to your domain</li> <li>Multi-device support - Register passkeys on multiple devices</li> <li>Privacy-focused - No personal data leaves your device during authentication</li> </ul>"},{"location":"admin/webauthn/#supported-authentication-methods","title":"Supported Authentication Methods","text":""},{"location":"admin/webauthn/#platform-authenticators-built-in","title":"Platform Authenticators (Built-in)","text":"<ul> <li>Windows Hello - Face recognition, fingerprint, or PIN on Windows devices</li> <li>Touch ID / Face ID - Biometric authentication on Apple devices</li> <li>Android Biometrics - Fingerprint, face unlock, or pattern on Android devices</li> </ul>"},{"location":"admin/webauthn/#security-keys-external","title":"Security Keys (External)","text":"<ul> <li>YubiKey - USB, NFC, or Lightning security keys</li> <li>Google Titan - USB and Bluetooth security keys</li> <li>Any FIDO2-compliant key - Supports the WebAuthn standard</li> </ul>"},{"location":"admin/webauthn/#browser-compatibility","title":"Browser Compatibility","text":"Browser Version Platform Auth Security Keys Conditional UI Notes Chrome 108+ \u2705 \u2705 \u2705 Full support including autofill Edge 108+ \u2705 \u2705 \u2705 Full support including autofill Safari 16+ \u2705 \u2705 \u2705 Requires macOS Ventura or iOS 16+ Firefox 119+ \u2705 \u2705 \u274c No autofill support, uses modal prompt Chrome Android 108+ \u2705 \u2705 \u2705 Supports biometrics and USB-C keys Safari iOS 16+ \u2705 \u2705 \u2705 Face ID, Touch ID, external keys via NFC Samsung Internet 23+ \u2705 \u2705 \u2705 Full support on Samsung devices"},{"location":"admin/webauthn/#feature-descriptions","title":"Feature Descriptions","text":"<ul> <li>Platform Auth: Built-in biometric authentication (Touch ID, Face ID, Windows Hello)</li> <li>Security Keys: External FIDO2 security keys (YubiKey, Titan, etc.)</li> <li>Conditional UI: Passkeys appear in password field autofill dropdown</li> </ul>"},{"location":"admin/webauthn/#configuration","title":"Configuration","text":""},{"location":"admin/webauthn/#environment-variables","title":"Environment Variables","text":"<p>WebAuthn requires specific configuration to work properly:</p> <pre><code>environment:\n    - WEBAUTHN_ENABLED=true # Enable passkey authentication\n    - WEBAUTHN_RP_ID=example.com # Your domain name\n    - WEBAUTHN_RP_NAME=Media Viewer # Display name in prompts\n    - WEBAUTHN_ORIGINS=https://example.com # Allowed origins (comma-separated)\n</code></pre>"},{"location":"admin/webauthn/#relying-party-id-rp-id","title":"Relying Party ID (RP ID)","text":"<p>The <code>WEBAUTHN_RP_ID</code> must match your domain:</p> <pre><code># \u2705 Correct configurations\nWEBAUTHN_RP_ID=example.com\nWEBAUTHN_ORIGINS=https://example.com\n\nWEBAUTHN_RP_ID=example.com\nWEBAUTHN_ORIGINS=https://media.example.com\n\n# \u274c Incorrect configurations\nWEBAUTHN_RP_ID=media.example.com\nWEBAUTHN_ORIGINS=https://example.com              # RP ID not a suffix of origin\n\nWEBAUTHN_RP_ID=localhost\nWEBAUTHN_ORIGINS=https://example.com              # Mismatch\n\nWEBAUTHN_RP_ID=192.168.1.50                       # IP addresses not allowed\n</code></pre> <p>Rules:</p> <ol> <li>RP ID must be a valid domain (not an IP address)</li> <li>RP ID must be a suffix of the origin domain</li> <li>RP ID should match the effective domain (usually top-level domain)</li> </ol>"},{"location":"admin/webauthn/#multiple-origins","title":"Multiple Origins","text":"<p>To support multiple subdomains or origins:</p> <pre><code>WEBAUTHN_RP_ID=example.com\nWEBAUTHN_ORIGINS=https://example.com,https://media.example.com,https://photos.example.com\n</code></pre>"},{"location":"admin/webauthn/#docker-compose-example","title":"Docker Compose Example","text":"<pre><code>version: '3.8'\n\nservices:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest\n        ports:\n            - '443:8080'\n        environment:\n            - WEBAUTHN_ENABLED=true\n            - WEBAUTHN_RP_ID=media.example.com\n            - WEBAUTHN_RP_NAME=My Media Library\n            - WEBAUTHN_ORIGINS=https://media.example.com\n        volumes:\n            - /path/to/media:/media:ro\n            - media-database:/database\n        restart: unless-stopped\n\nvolumes:\n    media-database:\n</code></pre>"},{"location":"admin/webauthn/#kubernetes-example","title":"Kubernetes Example","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n    name: media-viewer\nspec:\n    template:\n        spec:\n            containers:\n                - name: media-viewer\n                  image: ghcr.io/djryanj/media-viewer:latest\n                  env:\n                      - name: WEBAUTHN_ENABLED\n                        value: 'true'\n                      - name: WEBAUTHN_RP_ID\n                        value: media.example.com\n                      - name: WEBAUTHN_RP_NAME\n                        value: Media Viewer\n                      - name: WEBAUTHN_ORIGINS\n                        value: https://media.example.com\n</code></pre>"},{"location":"admin/webauthn/#secure-context-requirement","title":"Secure Context Requirement","text":"<p>WebAuthn requires HTTPS (or <code>http://localhost</code> for development):</p> Context WebAuthn Support Use Case <code>https://example.com</code> \u2705 Production <code>http://localhost:8080</code> \u2705 Local development <code>http://192.168.1.50:8080</code> \u274c Won't work <code>http://example.com</code> \u274c Must use HTTPS <code>https://abc123.ngrok-free.app</code> \u2705 Development tunnel"},{"location":"admin/webauthn/#why-https-is-required","title":"Why HTTPS is Required","text":"<p>WebAuthn is a powerful authentication API that generates cryptographic keys. Browsers restrict it to secure contexts to prevent:</p> <ul> <li>Man-in-the-middle attacks - HTTPS ensures credentials can't be intercepted</li> <li>Credential theft - Prevents malicious sites from stealing authentication data</li> <li>Domain spoofing - Ensures users authenticate to the correct site</li> </ul>"},{"location":"admin/webauthn/#development-exceptions","title":"Development Exceptions","text":"<p>Browsers allow <code>http://localhost</code> for development convenience, but this exception does not extend to:</p> <ul> <li>IP addresses (<code>http://127.0.0.1</code> or <code>http://192.168.x.x</code>)</li> <li>Custom local domains without certificates</li> <li>Any non-localhost hostname over HTTP</li> </ul>"},{"location":"api/authentication/","title":"Authentication API","text":"<p>Password-based authentication endpoints for session management.</p>"},{"location":"api/authentication/#overview","title":"Overview","text":"<p>Media Viewer uses session-based authentication with HTTP-only cookies. After successful login, the server sets a session cookie that must be included in subsequent requests.</p>"},{"location":"api/authentication/#session-cookie","title":"Session Cookie","text":"<ul> <li>Name: <code>session</code></li> <li>HttpOnly: <code>true</code> (not accessible via JavaScript)</li> <li>SameSite: <code>Strict</code></li> <li>Duration: Configurable via <code>SESSION_DURATION</code> (default: 24h)</li> <li>Type: Sliding expiration (extends on activity)</li> </ul>"},{"location":"api/authentication/#endpoints","title":"Endpoints","text":""},{"location":"api/authentication/#check-authentication-status","title":"Check Authentication Status","text":"<p>Check if the user is authenticated and whether initial setup is required. This single endpoint provides both authentication state and setup requirements.</p> <pre><code>GET /api/auth/check\n</code></pre>"},{"location":"api/authentication/#response","title":"Response","text":"<p>Success (200):</p> <p>When authenticated:</p> <pre><code>{\n    \"authenticated\": true,\n    \"setupRequired\": false,\n    \"expiresIn\": 86400\n}\n</code></pre> <p>When not authenticated (no setup required):</p> <pre><code>{\n    \"authenticated\": false,\n    \"setupRequired\": false\n}\n</code></pre> <p>When not authenticated (setup required):</p> <pre><code>{\n    \"authenticated\": false,\n    \"setupRequired\": true\n}\n</code></pre> <ul> <li><code>authenticated</code>: <code>true</code> if the user has a valid session</li> <li><code>setupRequired</code>: <code>true</code> if initial password setup is needed, <code>false</code> otherwise</li> <li><code>expiresIn</code>: Seconds until session expires (only present when authenticated)</li> </ul>"},{"location":"api/authentication/#login","title":"Login","text":"<p>Authenticate and create a session.</p> <pre><code>POST /api/auth/login\n</code></pre>"},{"location":"api/authentication/#request","title":"Request","text":"<pre><code>{\n    \"password\": \"your-password\"\n}\n</code></pre>"},{"location":"api/authentication/#response_1","title":"Response","text":"<p>Success (200):</p> <pre><code>{\n    \"success\": true\n}\n</code></pre> <p>A session cookie is set in the response headers.</p> <p>Failure (401):</p> <pre><code>{\n    \"success\": false,\n    \"error\": \"Invalid password\"\n}\n</code></pre>"},{"location":"api/authentication/#logout","title":"Logout","text":"<p>End the current session.</p> <pre><code>POST /api/auth/logout\n</code></pre>"},{"location":"api/authentication/#response_2","title":"Response","text":"<p>Success (200):</p> <pre><code>{\n    \"success\": true\n}\n</code></pre> <p>The session cookie is cleared.</p>"},{"location":"api/authentication/#check-session","title":"Check Session","text":"<p>Verify if the current session is valid.</p> <pre><code>GET /api/auth/check\n</code></pre>"},{"location":"api/authentication/#response_3","title":"Response","text":"<p>Authenticated (200):</p> <pre><code>{\n    \"success\": true\n}\n</code></pre> <p>Not Authenticated (401):</p> <pre><code>{\n    \"success\": false\n}\n</code></pre>"},{"location":"api/authentication/#change-password","title":"Change Password","text":"<p>Update the application password.</p> <pre><code>PUT /api/auth/password\n</code></pre>"},{"location":"api/authentication/#request_1","title":"Request","text":"<pre><code>{\n    \"currentPassword\": \"current-password\",\n    \"newPassword\": \"new-password\"\n}\n</code></pre>"},{"location":"api/authentication/#response_4","title":"Response","text":"<p>Success (200):</p> <pre><code>{\n    \"success\": true\n}\n</code></pre> <p>Invalid Current Password (401):</p> <pre><code>{\n    \"success\": false,\n    \"error\": \"Current password is incorrect\"\n}\n</code></pre> <p>Validation Error (400):</p> <pre><code>{\n    \"success\": false,\n    \"error\": \"New password must be at least 6 characters\"\n}\n</code></pre>"},{"location":"api/authentication/#session-keepalive","title":"Session Keepalive","text":"<p>The application automatically sends keepalive requests to maintain active sessions. This is handled internally and does not require manual API calls.</p>"},{"location":"api/favorites/","title":"Favorites API","text":"<p>Endpoints for managing favorite items.</p>"},{"location":"api/favorites/#list-favorites","title":"List Favorites","text":"<p>Get all favorited items.</p> <pre><code>GET /api/favorites\n</code></pre>"},{"location":"api/favorites/#response","title":"Response","text":"<pre><code>[\n    {\n        \"path\": \"photos/vacation/beach.jpg\",\n        \"name\": \"beach.jpg\",\n        \"type\": \"image\",\n        \"addedAt\": \"2024-07-15T10:30:00Z\"\n    },\n    {\n        \"path\": \"videos/highlights\",\n        \"name\": \"highlights\",\n        \"type\": \"folder\",\n        \"addedAt\": \"2024-07-14T08:00:00Z\"\n    }\n]\n</code></pre>"},{"location":"api/favorites/#add-favorite","title":"Add Favorite","text":"<p>Add an item to favorites.</p> <pre><code>POST /api/favorites\n</code></pre>"},{"location":"api/favorites/#request","title":"Request","text":"<pre><code>{\n    \"path\": \"photos/vacation/beach.jpg\",\n    \"name\": \"beach.jpg\",\n    \"type\": \"image\"\n}\n</code></pre>"},{"location":"api/favorites/#response_1","title":"Response","text":"<p>Success (200):</p> <pre><code>{\n    \"success\": true\n}\n</code></pre> <p>Already Exists (200):</p> <pre><code>{\n    \"success\": true,\n    \"message\": \"Already a favorite\"\n}\n</code></pre>"},{"location":"api/favorites/#remove-favorite","title":"Remove Favorite","text":"<p>Remove an item from favorites.</p> <pre><code>DELETE /api/favorites\n</code></pre>"},{"location":"api/favorites/#request_1","title":"Request","text":"<pre><code>{\n    \"path\": \"photos/vacation/beach.jpg\"\n}\n</code></pre>"},{"location":"api/favorites/#response_2","title":"Response","text":"<p>Success (200):</p> <pre><code>{\n    \"success\": true\n}\n</code></pre>"},{"location":"api/favorites/#bulk-add-favorites","title":"Bulk Add Favorites","text":"<p>Add multiple items to favorites at once.</p> <pre><code>POST /api/favorites/bulk\n</code></pre>"},{"location":"api/favorites/#request_2","title":"Request","text":"<pre><code>{\n    \"items\": [\n        {\n            \"path\": \"photos/vacation/beach.jpg\",\n            \"name\": \"beach.jpg\",\n            \"type\": \"image\"\n        },\n        {\n            \"path\": \"photos/vacation/sunset.jpg\",\n            \"name\": \"sunset.jpg\",\n            \"type\": \"image\"\n        }\n    ]\n}\n</code></pre>"},{"location":"api/favorites/#response_3","title":"Response","text":"<pre><code>{\n    \"success\": 2,\n    \"failed\": 0\n}\n</code></pre>"},{"location":"api/files/","title":"Files &amp; Media API","text":"<p>Endpoints for browsing, retrieving, and streaming media files.</p>"},{"location":"api/files/#api-reference","title":"API Reference","text":"<p>See the OpenAPI Specification for interactive documentation of all file-related endpoints:</p> <ul> <li><code>GET /api/files</code> - List files and folders</li> <li><code>GET /api/file/{path}</code> - Get a file</li> <li><code>GET /api/thumbnail/{path}</code> - Get thumbnail</li> <li><code>GET /api/stream/{path}</code> - Stream video</li> <li><code>GET /api/stream-info/{path}</code> - Get stream info</li> <li><code>GET /api/playlists</code> - List playlists</li> <li><code>GET /api/playlist/{name}</code> - Get playlist contents</li> </ul> <p>Refer to the OpenAPI documentation for detailed request/response schemas and examples.</p>"},{"location":"api/files/#list-directory","title":"List Directory","text":"<p>Get contents of a directory with pagination and filtering.</p> <pre><code>GET /api/files\n</code></pre>"},{"location":"api/files/#parameters","title":"Parameters","text":"Parameter Type Default Description path string \"\" Directory path (empty for root) sort string \"name\" Sort field: name, date, size, type order string \"asc\" Sort order: asc, desc type string \"\" Filter by type: image, video, playlist page number 1 Page number pageSize number 100 Items per page"},{"location":"api/files/#response","title":"Response","text":"<pre><code>{\n    \"path\": \"photos/vacation\",\n    \"breadcrumb\": [\n        { \"name\": \"Home\", \"path\": \"\" },\n        { \"name\": \"photos\", \"path\": \"photos\" },\n        { \"name\": \"vacation\", \"path\": \"photos/vacation\" }\n    ],\n    \"items\": [\n        {\n            \"name\": \"beach.jpg\",\n            \"path\": \"photos/vacation/beach.jpg\",\n            \"type\": \"image\",\n            \"size\": 2458624,\n            \"modified\": \"2024-07-15T10:30:00Z\",\n            \"tags\": [\"beach\", \"sunset\"],\n            \"isFavorite\": true\n        }\n    ],\n    \"page\": 1,\n    \"pageSize\": 100,\n    \"totalItems\": 42,\n    \"totalPages\": 1\n}\n</code></pre>"},{"location":"api/files/#list-media-files","title":"List Media Files","text":"<p>Get all media files in a directory for lightbox navigation.</p> <pre><code>GET /api/media\n</code></pre>"},{"location":"api/files/#parameters_1","title":"Parameters","text":"Parameter Type Default Description path string \"\" Directory path sort string \"name\" Sort field order string \"asc\" Sort order"},{"location":"api/files/#response_1","title":"Response","text":"<pre><code>[\n    {\n        \"name\": \"beach.jpg\",\n        \"path\": \"photos/vacation/beach.jpg\",\n        \"type\": \"image\",\n        \"tags\": [\"beach\", \"sunset\"]\n    },\n    {\n        \"name\": \"video.mp4\",\n        \"path\": \"photos/vacation/video.mp4\",\n        \"type\": \"video\",\n        \"tags\": []\n    }\n]\n</code></pre>"},{"location":"api/files/#get-thumbnail","title":"Get Thumbnail","text":"<p>Get a thumbnail image for a file.</p> <pre><code>GET /api/thumbnail/{path}\n</code></pre>"},{"location":"api/files/#parameters_2","title":"Parameters","text":"Parameter Type Description path string URL-encoded file path"},{"location":"api/files/#response_2","title":"Response","text":"<p>Returns the thumbnail image with appropriate content type.</p> <p>Not Found (404): If the file doesn't exist or thumbnail generation fails.</p>"},{"location":"api/files/#get-original-file","title":"Get Original File","text":"<p>Get the original file for viewing.</p> <pre><code>GET /api/file/{path}\n</code></pre>"},{"location":"api/files/#parameters_3","title":"Parameters","text":"Parameter Type Description path string URL-encoded file path"},{"location":"api/files/#response_3","title":"Response","text":"<p>Returns the file with appropriate content type and support for range requests (video seeking).</p>"},{"location":"api/files/#search","title":"Search","text":"<p>Search for files by name or tag.</p> <pre><code>GET /api/search\n</code></pre>"},{"location":"api/files/#parameters_4","title":"Parameters","text":"Parameter Type Description q string Search query type string Filter by type (optional) page number Page number pageSize number Items per page"},{"location":"api/files/#query-syntax","title":"Query Syntax","text":"<ul> <li><code>sunset</code> - Search filenames containing \"sunset\"</li> <li><code>tag:vacation</code> - Search for files with \"vacation\" tag</li> </ul>"},{"location":"api/files/#response_4","title":"Response","text":"<p>Same format as List Directory response.</p>"},{"location":"api/openapi/","title":"OpenAPI Specification","text":"<p>Interactive API documentation powered by Swagger UI.</p> <p>Authentication Required</p> <p>Most endpoints require authentication. You'll need to authenticate first via the <code>/api/auth/login</code> endpoint before testing other endpoints.</p>"},{"location":"api/openapi/#interactive-api-explorer","title":"Interactive API Explorer","text":""},{"location":"api/openapi/#download-specification","title":"Download Specification","text":"<p>Download the OpenAPI specification file:</p> <ul> <li>swagger.json - OpenAPI 3.0 JSON format</li> </ul>"},{"location":"api/openapi/#using-the-specification","title":"Using the Specification","text":"<p>You can use this specification with various tools:</p>"},{"location":"api/openapi/#import-into-postman","title":"Import into Postman","text":"<ol> <li>Open Postman</li> <li>Click Import</li> <li>Select Link tab</li> <li>Paste: <code>https://djryanj.github.io/media-viewer/swagger.json</code></li> </ol>"},{"location":"api/openapi/#generate-client-sdks","title":"Generate Client SDKs","text":"<p>Use OpenAPI Generator to generate client libraries:</p> <pre><code># JavaScript/TypeScript\nopenapi-generator-cli generate -i swagger.json -g typescript-axios -o ./client\n\n# Python\nopenapi-generator-cli generate -i swagger.json -g python -o ./client\n\n# Go\nopenapi-generator-cli generate -i swagger.json -g go -o ./client\n</code></pre>"},{"location":"api/openapi/#test-with-curl","title":"Test with cURL","text":"<p>Each endpoint in the Swagger UI can be tested directly, or you can copy the cURL commands.</p> <p>Example login request:</p> <pre><code>curl -X POST http://localhost:8080/api/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"password\":\"your-password\"}' \\\n  -c cookies.txt\n\n# Use the session cookie for subsequent requests\ncurl http://localhost:8080/api/files \\\n  -b cookies.txt\n</code></pre>"},{"location":"api/overview/","title":"API Overview","text":"<p>Media Viewer exposes a RESTful API for programmatic access to all features. The API is used internally by the web frontend and can also be used for custom integrations.</p>"},{"location":"api/overview/#base-url","title":"Base URL","text":"<p>All API endpoints are prefixed with <code>/api/</code> (except authentication, health, and version endpoints).</p>"},{"location":"api/overview/#authentication","title":"Authentication","text":"<p>Most endpoints require authentication via session cookie. Obtain a session by logging in through the <code>/api/auth/login</code> endpoint.</p>"},{"location":"api/overview/#session-cookie","title":"Session Cookie","text":"<p>After successful login, a session cookie is set automatically. Include this cookie in subsequent requests.</p>"},{"location":"api/overview/#unauthenticated-requests","title":"Unauthenticated Requests","text":"<p>Unauthenticated requests to protected endpoints return:</p> <pre><code>HTTP/1.1 401 Unauthorized\n</code></pre>"},{"location":"api/overview/#response-format","title":"Response Format","text":"<p>All responses are JSON unless otherwise noted.</p>"},{"location":"api/overview/#success-response","title":"Success Response","text":"<pre><code>{\n    \"success\": true,\n    \"data\": {}\n}\n</code></pre>"},{"location":"api/overview/#error-response","title":"Error Response","text":"<pre><code>{\n    \"success\": false,\n    \"error\": \"Error message\"\n}\n</code></pre>"},{"location":"api/overview/#endpoints-summary","title":"Endpoints Summary","text":""},{"location":"api/overview/#authentication_1","title":"Authentication","text":"Method Endpoint Description POST <code>/api/auth/login</code> Log in POST <code>/api/auth/logout</code> Log out GET <code>/api/auth/check</code> Check session status PUT <code>/api/auth/password</code> Change password"},{"location":"api/overview/#files","title":"Files","text":"Method Endpoint Description GET <code>/api/files</code> List directory contents GET <code>/api/media</code> List media files for lightbox GET <code>/api/thumbnail/{path}</code> Get thumbnail GET <code>/api/file/{path}</code> Get original file"},{"location":"api/overview/#tags","title":"Tags","text":"Method Endpoint Description GET <code>/api/tags</code> List all tags GET <code>/api/tags/file</code> Get tags for a file POST <code>/api/tags/file</code> Add tag to file DELETE <code>/api/tags/file</code> Remove tag from file POST <code>/api/tags/bulk</code> Add tag to multiple files DELETE <code>/api/tags/bulk</code> Remove tag from multiple files"},{"location":"api/overview/#favorites","title":"Favorites","text":"Method Endpoint Description GET <code>/api/favorites</code> List favorites POST <code>/api/favorites</code> Add favorite DELETE <code>/api/favorites</code> Remove favorite POST <code>/api/favorites/bulk</code> Add multiple favorites"},{"location":"api/overview/#search","title":"Search","text":"Method Endpoint Description GET <code>/api/search</code> Search media"},{"location":"api/overview/#system","title":"System","text":"Method Endpoint Description GET <code>/api/stats</code> Get library statistics GET <code>/health</code> Health check GET <code>/version</code> Version information POST <code>/api/thumbnails/rebuild</code> Clear and rebuild thumbnails"},{"location":"api/search/","title":"Search API","text":"<p>Full-text search and suggestions endpoints.</p>"},{"location":"api/search/#api-reference","title":"API Reference","text":"<p>See the OpenAPI Specification for interactive documentation:</p> <ul> <li><code>GET /api/search</code> - Search files</li> <li><code>GET /api/search/suggestions</code> - Get search suggestions</li> </ul> <p>Refer to the OpenAPI documentation for detailed request/response schemas and examples.</p>"},{"location":"api/system/","title":"System API","text":"<p>System health, statistics, and administrative endpoints.</p>"},{"location":"api/system/#api-reference","title":"API Reference","text":"<p>See the OpenAPI Specification for interactive documentation:</p> <p>Health &amp; Info:</p> <ul> <li><code>GET /health</code> - Basic health check</li> <li><code>GET /healthz</code> - Health check alias</li> <li><code>GET /livez</code> - Liveness probe</li> <li><code>GET /readyz</code> - Readiness probe</li> <li><code>GET /version</code> - Version information</li> <li><code>GET /metrics</code> - Prometheus metrics (port 9090 internal, 9091 on host)</li> </ul> <p>Statistics:</p> <ul> <li><code>GET /api/stats</code> - Library statistics</li> </ul> <p>Cache Management:</p> <ul> <li><code>POST /api/thumbnails/invalidate</code> - Clear all thumbnails</li> <li><code>POST /api/thumbnails/rebuild</code> - Rebuild all thumbnails</li> <li><code>GET /api/thumbnails/status</code> - Thumbnail generation status</li> <li><code>DELETE /api/thumbnail/{path}</code> - Invalidate single thumbnail</li> <li><code>POST /api/transcode/clear</code> - Clear transcode cache</li> </ul> <p>Indexing:</p> <ul> <li><code>POST /api/reindex</code> - Trigger media reindex</li> </ul> <p>Refer to the OpenAPI documentation for detailed request/response schemas and examples.</p>"},{"location":"api/tags-favorites/","title":"Tags &amp; Favorites API","text":"<p>Endpoints for managing tags and favorite files.</p>"},{"location":"api/tags-favorites/#api-reference","title":"API Reference","text":"<p>See the OpenAPI Specification for interactive documentation:</p> <p>Tags:</p> <ul> <li><code>GET /api/tags</code> - List all tags</li> <li><code>GET /api/tags/file</code> - Get file tags</li> <li><code>POST /api/tags/file</code> - Add tag to file</li> <li><code>DELETE /api/tags/file</code> - Remove tag from file</li> <li><code>POST /api/tags/file/set</code> - Set all tags for file</li> <li><code>POST /api/tags/batch</code> - Get tags for multiple files</li> <li><code>POST /api/tags/bulk</code> - Add tag to multiple files</li> <li><code>DELETE /api/tags/bulk</code> - Remove tag from multiple files</li> <li><code>GET /api/tags/{tag}</code> - Get files with tag</li> <li><code>DELETE /api/tags/{tag}</code> - Delete tag globally</li> <li><code>PUT /api/tags/{tag}</code> - Rename tag globally</li> </ul> <p>Favorites:</p> <ul> <li><code>GET /api/favorites</code> - List favorites</li> <li><code>POST /api/favorites</code> - Add favorite</li> <li><code>DELETE /api/favorites</code> - Remove favorite</li> <li><code>POST /api/favorites/bulk</code> - Add multiple favorites</li> <li><code>DELETE /api/favorites/bulk</code> - Remove multiple favorites</li> <li><code>GET /api/favorites/check</code> - Check if favorited</li> </ul> <p>Refer to the OpenAPI documentation for detailed request/response schemas and examples.</p>"},{"location":"api/tags/","title":"Tags API","text":"<p>Endpoints for managing tags on media files.</p>"},{"location":"api/tags/#list-all-tags","title":"List All Tags","text":"<p>Get all tags in the library with usage counts.</p> <pre><code>GET /api/tags\n</code></pre>"},{"location":"api/tags/#response","title":"Response","text":"<pre><code>[\n    {\n        \"name\": \"vacation\",\n        \"itemCount\": 42\n    },\n    {\n        \"name\": \"family\",\n        \"itemCount\": 128\n    }\n]\n</code></pre>"},{"location":"api/tags/#get-file-tags","title":"Get File Tags","text":"<p>Get tags assigned to a specific file.</p> <pre><code>GET /api/tags/file?path={filePath}\n</code></pre>"},{"location":"api/tags/#parameters","title":"Parameters","text":"Parameter Type Description path string URL-encoded file path"},{"location":"api/tags/#response_1","title":"Response","text":"<pre><code>[\"vacation\", \"beach\", \"2024\"]\n</code></pre>"},{"location":"api/tags/#add-tag-to-file","title":"Add Tag to File","text":"<p>Add a tag to a single file.</p> <pre><code>POST /api/tags/file\n</code></pre>"},{"location":"api/tags/#request","title":"Request","text":"<pre><code>{\n    \"path\": \"photos/vacation/beach.jpg\",\n    \"tag\": \"vacation\"\n}\n</code></pre>"},{"location":"api/tags/#response_2","title":"Response","text":"<p>Success (200):</p> <pre><code>{\n    \"success\": true\n}\n</code></pre>"},{"location":"api/tags/#remove-tag-from-file","title":"Remove Tag from File","text":"<p>Remove a tag from a single file.</p> <pre><code>DELETE /api/tags/file\n</code></pre>"},{"location":"api/tags/#request_1","title":"Request","text":"<pre><code>{\n    \"path\": \"photos/vacation/beach.jpg\",\n    \"tag\": \"vacation\"\n}\n</code></pre>"},{"location":"api/tags/#response_3","title":"Response","text":"<p>Success (200):</p> <pre><code>{\n    \"success\": true\n}\n</code></pre>"},{"location":"api/tags/#bulk-add-tag","title":"Bulk Add Tag","text":"<p>Add a tag to multiple files at once.</p> <pre><code>POST /api/tags/bulk\n</code></pre>"},{"location":"api/tags/#request_2","title":"Request","text":"<pre><code>{\n    \"paths\": [\n        \"photos/vacation/beach.jpg\",\n        \"photos/vacation/sunset.jpg\",\n        \"photos/vacation/hotel.jpg\"\n    ],\n    \"tag\": \"vacation\"\n}\n</code></pre>"},{"location":"api/tags/#response_4","title":"Response","text":"<pre><code>{\n    \"success\": 3,\n    \"failed\": 0\n}\n</code></pre>"},{"location":"api/tags/#bulk-remove-tag","title":"Bulk Remove Tag","text":"<p>Remove a tag from multiple files at once.</p> <pre><code>DELETE /api/tags/bulk\n</code></pre>"},{"location":"api/tags/#request_3","title":"Request","text":"<pre><code>{\n    \"paths\": [\"photos/vacation/beach.jpg\", \"photos/vacation/sunset.jpg\"],\n    \"tag\": \"vacation\"\n}\n</code></pre>"},{"location":"api/tags/#response_5","title":"Response","text":"<pre><code>{\n    \"success\": 2,\n    \"failed\": 0\n}\n</code></pre>"},{"location":"api/tags/#tag-management-endpoints","title":"Tag Management Endpoints","text":""},{"location":"api/tags/#get-all-tags-with-counts","title":"Get All Tags with Counts","text":"<p>Get all tags with usage statistics.</p> <pre><code>GET /api/tags/stats\n</code></pre>"},{"location":"api/tags/#response_6","title":"Response","text":"<pre><code>[\n    {\n        \"name\": \"vacation\",\n        \"color\": \"#3b82f6\",\n        \"count\": 42\n    },\n    {\n        \"name\": \"family\",\n        \"color\": \"\",\n        \"count\": 28\n    },\n    {\n        \"name\": \"unused\",\n        \"color\": \"#10b981\",\n        \"count\": 0\n    }\n]\n</code></pre> <p>Tags are sorted by count (descending), then name (alphabetically).</p>"},{"location":"api/tags/#get-unused-tags","title":"Get Unused Tags","text":"<p>Get all tags that have no file associations.</p> <pre><code>GET /api/tags/unused\n</code></pre>"},{"location":"api/tags/#response_7","title":"Response","text":"<pre><code>[\"unused\", \"orphan\", \"temp\"]\n</code></pre>"},{"location":"api/tags/#rename-tag-everywhere","title":"Rename Tag Everywhere","text":"<p>Rename a tag and update all file associations.</p> <pre><code>POST /api/tags/{tag}/rename\n</code></pre>"},{"location":"api/tags/#parameters_1","title":"Parameters","text":"Parameter Type Location Description tag string path Current tag name (URL-encoded)"},{"location":"api/tags/#request_4","title":"Request","text":"<pre><code>{\n    \"newName\": \"vacation\"\n}\n</code></pre>"},{"location":"api/tags/#response_8","title":"Response","text":"<pre><code>{\n    \"status\": \"ok\",\n    \"affectedFiles\": 42,\n    \"oldName\": \"vacaton\",\n    \"newName\": \"vacation\"\n}\n</code></pre> <p>Special Cases:</p> <ul> <li>If the new name already exists, tags are merged automatically</li> <li>Case-only changes are supported (e.g., \"animal\" \u2192 \"Animal\")</li> <li>Same name returns 0 affected files (no-op)</li> </ul>"},{"location":"api/tags/#delete-tag-everywhere","title":"Delete Tag Everywhere","text":"<p>Delete a tag from all file associations.</p> <pre><code>DELETE /api/tags/{tag}/delete\n</code></pre>"},{"location":"api/tags/#parameters_2","title":"Parameters","text":"Parameter Type Location Description tag string path Tag name (URL-encoded)"},{"location":"api/tags/#response_9","title":"Response","text":"<pre><code>{\n    \"status\": \"ok\",\n    \"affectedFiles\": 42,\n    \"tagName\": \"vacation\"\n}\n</code></pre> <p>The tag and all its file associations are removed in a single transaction.</p>"},{"location":"api/webauthn/","title":"WebAuthn API","text":"<p>Passkey (WebAuthn/FIDO2) authentication endpoints.</p> <p>For detailed information about WebAuthn configuration and usage, see:</p> <ul> <li>User Guide: WebAuthn/Passkeys</li> <li>Administration: WebAuthn Setup</li> <li>Comprehensive Guide: WebAuthn Documentation</li> </ul>"},{"location":"api/webauthn/#api-reference","title":"API Reference","text":"<p>See the OpenAPI Specification for interactive documentation of all WebAuthn endpoints:</p> <ul> <li><code>GET /api/auth/webauthn/available</code> - Check passkey availability</li> <li><code>POST /api/auth/webauthn/register/begin</code> - Start registration</li> <li><code>POST /api/auth/webauthn/register/finish</code> - Complete registration</li> <li><code>POST /api/auth/webauthn/login/begin</code> - Start authentication</li> <li><code>POST /api/auth/webauthn/login/finish</code> - Complete authentication</li> <li><code>GET /api/auth/webauthn/passkeys</code> - List passkeys</li> <li><code>DELETE /api/auth/webauthn/passkeys</code> - Delete passkey</li> </ul> <p>Refer to the OpenAPI documentation for detailed request/response schemas and examples.</p>"},{"location":"development/architecture/","title":"Architecture","text":"<p>This document describes the technical architecture of Media Viewer.</p>"},{"location":"development/architecture/#overview","title":"Overview","text":"<p>Media Viewer is a client-server application with:</p> <ul> <li>Frontend: Single-page application (SPA) using vanilla JavaScript, HTML, and CSS</li> <li>Backend: Go HTTP server with Gorilla Mux router</li> <li>Database: SQLite with FTS5 for full-text search</li> <li>Storage: File system for media files, thumbnails, and transcoded videos</li> <li>Media Processing: FFmpeg for video transcoding and thumbnail generation</li> </ul>"},{"location":"development/architecture/#technology-stack","title":"Technology Stack","text":""},{"location":"development/architecture/#backend","title":"Backend","text":"<ul> <li>Language: Go 1.21+</li> <li>HTTP Router: Gorilla Mux</li> <li>Database: SQLite with CGO (FTS5 extension)</li> <li>Authentication: WebAuthn (go-webauthn/webauthn) + bcrypt password hashing</li> <li>Media Processing: FFmpeg (via exec)</li> <li>Metrics: Prometheus client library</li> </ul>"},{"location":"development/architecture/#frontend","title":"Frontend","text":"<ul> <li>JavaScript: Vanilla ES6+ (no frameworks)</li> <li>CSS: Custom CSS with CSS Grid and Flexbox</li> <li>Icons: Lucide Icons (SVG)</li> <li>PWA: Service Worker, Web App Manifest</li> <li>APIs: WebAuthn, Wake Lock, Intersection Observer</li> </ul>"},{"location":"development/architecture/#backend-architecture","title":"Backend Architecture","text":""},{"location":"development/architecture/#project-structure","title":"Project Structure","text":"<pre><code>media-viewer/\n\u251c\u2500\u2500 cmd/\n\u2502   \u2514\u2500\u2500 resetpw/          # Password reset utility\n\u251c\u2500\u2500 internal/\n\u2502   \u251c\u2500\u2500 database/         # SQLite operations\n\u2502   \u251c\u2500\u2500 filesystem/       # Resilient filesystem operations\n\u2502   \u251c\u2500\u2500 handlers/         # HTTP request handlers\n\u2502   \u251c\u2500\u2500 indexer/          # Media library indexer\n\u2502   \u251c\u2500\u2500 logging/          # Structured logging\n\u2502   \u251c\u2500\u2500 media/            # Thumbnail generation\n\u2502   \u251c\u2500\u2500 memory/           # Memory monitoring\n\u2502   \u251c\u2500\u2500 metrics/          # Prometheus metrics\n\u2502   \u251c\u2500\u2500 middleware/       # HTTP middleware\n\u2502   \u251c\u2500\u2500 mediatypes/       # File type detection\n\u2502   \u251c\u2500\u2500 startup/          # Application initialization\n\u2502   \u251c\u2500\u2500 streaming/        # Video streaming utilities\n\u2502   \u251c\u2500\u2500 transcoder/       # Video transcoding\n\u2502   \u2514\u2500\u2500 workers/          # Worker pool utilities\n\u251c\u2500\u2500 static/               # Frontend assets\n\u2502   \u251c\u2500\u2500 css/\n\u2502   \u251c\u2500\u2500 js/\n\u2502   \u251c\u2500\u2500 icons/\n\u2502   \u2514\u2500\u2500 *.html\n\u2514\u2500\u2500 main.go              # Application entry point\n</code></pre>"},{"location":"development/architecture/#core-components","title":"Core Components","text":""},{"location":"development/architecture/#http-server","title":"HTTP Server","text":"<ul> <li>Router: Gorilla Mux for flexible routing</li> <li>Middleware: Logging, compression, metrics, authentication</li> <li>Timeouts: Configurable read/write timeouts</li> <li>Graceful Shutdown: Cleanup on SIGINT/SIGTERM</li> </ul>"},{"location":"development/architecture/#database-layer-internaldatabase","title":"Database Layer (<code>internal/database</code>)","text":"<ul> <li>Connection: Single SQLite connection with mutex-based locking</li> <li>Migrations: Automatic schema initialization</li> <li>Indexes: Optimized for file path and tag queries</li> <li>FTS5: Full-text search on file names</li> <li>Transactions: Proper transaction handling for data integrity</li> </ul>"},{"location":"development/architecture/#filesystem-layer-internalfilesystem","title":"Filesystem Layer (<code>internal/filesystem</code>)","text":"<p>Provides resilient filesystem operations with automatic retry logic for NFS stability:</p> <ul> <li>Retry Logic: Automatic retry with exponential backoff for ESTALE errors</li> <li>StatWithRetry: Wraps <code>os.Stat</code> with up to 3 retry attempts</li> <li>OpenWithRetry: Wraps <code>os.Open</code> with up to 3 retry attempts</li> <li>Exponential Backoff: 50ms \u2192 100ms \u2192 200ms between retries</li> <li>Minimal Overhead: ~100ns additional latency on successful operations</li> <li>Smart Detection: Only retries NFS stale file handle errors (ESTALE errno 116)</li> <li>Logging: Successful retries logged for monitoring and debugging</li> </ul> <p>This layer prevents crashes and improves stability when serving media from NFS mounts, where stale file handles can occur due to network issues or server-side changes.</p>"},{"location":"development/architecture/#indexer-internalindexer","title":"Indexer (<code>internal/indexer</code>)","text":"<ul> <li>Parallel Walker: Multi-threaded directory scanning</li> <li>Change Detection: Polling-based file system monitoring</li> <li>Incremental Updates: Only processes new/modified/deleted files</li> <li>Notifications: Triggers thumbnail generation after index completion</li> </ul>"},{"location":"development/architecture/#thumbnail-generator-internalmedia","title":"Thumbnail Generator (<code>internal/media</code>)","text":"<ul> <li>On-Demand: Generates thumbnails when requested</li> <li>Background Worker: Batch generation for new files</li> <li>FFmpeg Integration: Extracts video frames</li> <li>Image Processing: Resizes and optimizes images</li> <li>Per-File Locking: Prevents duplicate generation</li> </ul>"},{"location":"development/architecture/#transcoder-internaltranscoder","title":"Transcoder (<code>internal/transcoder</code>)","text":"<ul> <li>Streaming: Chunks video on-the-fly</li> <li>Caching: Stores transcoded files for reuse</li> <li>Format Detection: Determines if transcoding is needed</li> <li>FFmpeg Pipeline: H.264 encoding for browser compatibility</li> </ul>"},{"location":"development/architecture/#webauthn-handler-internalhandlerswebauthngo","title":"WebAuthn Handler (<code>internal/handlers/webauthn.go</code>)","text":"<ul> <li>Registration: Passkey enrollment with challenge-response</li> <li>Authentication: Passwordless login with signature verification</li> <li>Session Management: Temporary challenge storage (5-minute TTL)</li> <li>Credential Storage: Encrypted credential storage in database</li> </ul>"},{"location":"development/architecture/#api-design","title":"API Design","text":"<p>RESTful API with JSON responses:</p> <ul> <li><code>GET</code> - Resource retrieval</li> <li><code>POST</code> - Resource creation, actions</li> <li><code>PUT</code> - Resource updates</li> <li><code>DELETE</code> - Resource deletion</li> </ul> <p>Authentication via HTTP-only session cookies (SHA-256 hashed tokens).</p>"},{"location":"development/architecture/#concurrency-model","title":"Concurrency Model","text":""},{"location":"development/architecture/#goroutines","title":"Goroutines","text":"<ul> <li>HTTP Server: One goroutine per request</li> <li>Indexer: Background goroutine with ticker</li> <li>Thumbnail Generator: Worker pool with configurable size</li> <li>Session Cleanup: Periodic cleanup goroutine</li> <li>Metrics Collector: Background stats collection</li> </ul>"},{"location":"development/architecture/#worker-pools","title":"Worker Pools","text":"<p>Sized based on available CPU cores (respects container limits):</p> <ul> <li>CPU-bound tasks: <code>runtime.GOMAXPROCS(0)</code> workers</li> <li>I/O-bound tasks: <code>2 * GOMAXPROCS(0)</code> workers</li> <li>Mixed workload: <code>1.5 * GOMAXPROCS(0)</code> workers</li> </ul>"},{"location":"development/architecture/#synchronization","title":"Synchronization","text":"<ul> <li>Database: Read-write mutex (<code>sync.RWMutex</code>)</li> <li>Thumbnail Generation: Per-file locks (map of mutexes)</li> <li>Context Propagation: Cancellation and timeouts</li> </ul>"},{"location":"development/architecture/#memory-management","title":"Memory Management","text":"<ul> <li>GOMEMLIMIT: Configurable via environment or Kubernetes Downward API</li> <li>Memory Ratio: Reserves memory for FFmpeg and OS buffers</li> <li>GC Tuning: Aggressive collection when approaching limit</li> <li>Monitoring: Prometheus metrics for heap, sys, and GC stats</li> </ul>"},{"location":"development/architecture/#frontend-architecture","title":"Frontend Architecture","text":""},{"location":"development/architecture/#module-structure","title":"Module Structure","text":"<p>The frontend is organized into independent modules:</p> Module File Purpose MediaApp <code>app.js</code> Main application controller Gallery <code>gallery.js</code> Gallery rendering and interactions Lightbox <code>lightbox.js</code> Full-screen media viewer Search <code>search.js</code> Search functionality Tags <code>tags.js</code> Tag management Favorites <code>favorites.js</code> Favorites management ItemSelection <code>selection.js</code> Multi-select mode TagClipboard <code>tag-clipboard.js</code> Tag copy/paste Player <code>playlist.js</code> Playlist player HistoryManager <code>history.js</code> Browser history management InfiniteScroll <code>infinite-scroll.js</code> Gallery pagination InfiniteScrollSearch <code>infinite-scroll-search.js</code> Search pagination WebAuthnManager <code>webauthn.js</code> Passkey authentication SettingsManager <code>settings.js</code> Settings modal and management SessionManager <code>session.js</code> Session keepalive WakeLockManager <code>wake-lock.js</code> Screen wake lock TagTooltip <code>tag-tooltip.js</code> Tag overflow tooltip PreferencesManager <code>preferences.js</code> User preferences storage"},{"location":"development/architecture/#state-management","title":"State Management","text":"<p>Application state is managed in <code>MediaApp.state</code>:</p> <pre><code>{\n  currentPath: '',      // Current directory path\n  listing: null,        // Current directory listing\n  mediaFiles: [],       // Files for lightbox navigation\n  currentSort: { field: 'name', order: 'asc' },\n  currentFilter: 'all',\n  currentPage: 1,\n  hasMore: false,\n  isSearchMode: false,\n  searchQuery: ''\n}\n</code></pre>"},{"location":"development/architecture/#event-flow","title":"Event Flow","text":"<ol> <li>User interaction triggers event handler</li> <li>Handler updates state and/or calls API</li> <li>API response updates state via <code>setState()</code></li> <li>UI components re-render based on new state</li> </ol>"},{"location":"development/architecture/#history-management","title":"History Management","text":"<p>Browser history is managed for:</p> <ul> <li>Directory navigation (pushState)</li> <li>Lightbox overlay (replaceState)</li> <li>Search results (pushState)</li> </ul> <p>The <code>HistoryManager</code> module handles back/forward navigation and state restoration.</p>"},{"location":"development/architecture/#webauthn-integration","title":"WebAuthn Integration","text":"<ul> <li>Registration: Custom naming modal before browser prompt</li> <li>Authentication: Conditional UI (autofill) + manual button + auto-prompt</li> <li>Credential Management: List, add, delete passkeys</li> <li>Fallback: Always maintains password auth option</li> </ul>"},{"location":"development/architecture/#database-schema","title":"Database Schema","text":""},{"location":"development/architecture/#core-tables","title":"Core Tables","text":""},{"location":"development/architecture/#files","title":"<code>files</code>","text":"<p>Indexed media files:</p> <pre><code>CREATE TABLE files (\n    path TEXT PRIMARY KEY,\n    name TEXT NOT NULL,\n    type TEXT NOT NULL,\n    size INTEGER NOT NULL,\n    modified_at INTEGER NOT NULL\n);\n</code></pre>"},{"location":"development/architecture/#tags","title":"<code>tags</code>","text":"<p>Tag definitions:</p> <pre><code>CREATE TABLE tags (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    name TEXT UNIQUE NOT NULL\n);\n</code></pre>"},{"location":"development/architecture/#file_tags","title":"<code>file_tags</code>","text":"<p>File-tag associations:</p> <pre><code>CREATE TABLE file_tags (\n    file_path TEXT NOT NULL,\n    tag_id INTEGER NOT NULL,\n    FOREIGN KEY (file_path) REFERENCES files(path) ON DELETE CASCADE,\n    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE,\n    PRIMARY KEY (file_path, tag_id)\n);\n</code></pre>"},{"location":"development/architecture/#favorites","title":"<code>favorites</code>","text":"<p>Favorited items:</p> <pre><code>CREATE TABLE favorites (\n    path TEXT PRIMARY KEY,\n    name TEXT NOT NULL,\n    type TEXT NOT NULL,\n    added_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now'))\n);\n</code></pre>"},{"location":"development/architecture/#users","title":"<code>users</code>","text":"<p>Single user account:</p> <pre><code>CREATE TABLE users (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    password_hash TEXT NOT NULL,\n    created_at INTEGER NOT NULL,\n    updated_at INTEGER NOT NULL\n);\n</code></pre>"},{"location":"development/architecture/#sessions","title":"<code>sessions</code>","text":"<p>Active user sessions:</p> <pre><code>CREATE TABLE sessions (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    user_id INTEGER NOT NULL,\n    token_hash TEXT NOT NULL UNIQUE,\n    expires_at INTEGER NOT NULL,\n    created_at INTEGER NOT NULL,\n    last_activity INTEGER NOT NULL,\n    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);\n</code></pre>"},{"location":"development/architecture/#webauthn-tables","title":"WebAuthn Tables","text":""},{"location":"development/architecture/#webauthn_credentials","title":"<code>webauthn_credentials</code>","text":"<p>Registered passkeys:</p> <pre><code>CREATE TABLE webauthn_credentials (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    user_id INTEGER NOT NULL,\n    credential_id BLOB NOT NULL UNIQUE,\n    public_key BLOB NOT NULL,\n    attestation_type TEXT NOT NULL,\n    aaguid BLOB,\n    sign_count INTEGER NOT NULL DEFAULT 0,\n    name TEXT NOT NULL DEFAULT 'Passkey',\n    transports TEXT,\n    created_at INTEGER NOT NULL,\n    last_used_at INTEGER NOT NULL,\n    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n);\n</code></pre>"},{"location":"development/architecture/#webauthn_sessions","title":"<code>webauthn_sessions</code>","text":"<p>WebAuthn challenge data:</p> <pre><code>CREATE TABLE webauthn_sessions (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    session_id TEXT NOT NULL UNIQUE,\n    session_data BLOB NOT NULL,\n    expires_at INTEGER NOT NULL,\n    created_at INTEGER NOT NULL\n);\n</code></pre>"},{"location":"development/architecture/#full-text-search","title":"Full-Text Search","text":"<p>FTS5 virtual table for file search:</p> <pre><code>CREATE VIRTUAL TABLE files_fts USING fts5(\n    path,\n    name,\n    content=files,\n    content_rowid=rowid\n);\n</code></pre>"},{"location":"development/architecture/#performance-considerations","title":"Performance Considerations","text":""},{"location":"development/architecture/#backend_1","title":"Backend","text":"<ul> <li>Parallel Indexing: Multi-threaded directory walker (2-4x faster)</li> <li>Parallel Thumbnails: Worker pool for thumbnail generation</li> <li>Per-File Locks: Prevents duplicate thumbnail generation</li> <li>SQLite Indexes: Optimized queries on path, tags, favorites</li> <li>Streaming: Chunked video delivery with timeout protection</li> <li>Context Cancellation: Stops work when clients disconnect</li> </ul>"},{"location":"development/architecture/#frontend_1","title":"Frontend","text":"<ul> <li>Infinite Scroll: Reduces initial load time</li> <li>Intersection Observer: Efficient scroll detection</li> <li>Lazy Loading: Thumbnails loaded as needed</li> <li>Batched Updates: Single DOM paint for selection changes</li> <li>Service Worker: Caches static assets</li> <li>Debouncing: Search input and scroll events</li> </ul>"},{"location":"development/architecture/#caching-strategy","title":"Caching Strategy","text":"Resource Cache Location Duration Strategy Static assets Service Worker 7 days Cache first Thumbnails Disk + Browser 1 year Cache with revalid Transcoded video Disk Varies On-demand API responses None N/A Always fresh"},{"location":"development/architecture/#security-model","title":"Security Model","text":""},{"location":"development/architecture/#authentication","title":"Authentication","text":"<ul> <li>Password: bcrypt hashing (cost 10)</li> <li>Sessions: SHA-256 hashed tokens, HTTP-only cookies</li> <li>WebAuthn: FIDO2 with user verification required</li> <li>Expiration: Sliding window (default 24h)</li> </ul>"},{"location":"development/architecture/#authorization","title":"Authorization","text":"<p>Single-user model:</p> <ul> <li>All authenticated users have full access</li> <li>No role-based access control</li> <li>Path traversal prevention in file handlers</li> </ul>"},{"location":"development/architecture/#data-protection","title":"Data Protection","text":"<ul> <li>Passwords: Never logged or transmitted in plain text</li> <li>Sessions: Secure, HTTP-only, SameSite=Strict cookies</li> <li>WebAuthn: Private keys never leave user's device</li> <li>HTTPS: Required for WebAuthn in production</li> </ul>"},{"location":"development/architecture/#monitoring-observability","title":"Monitoring &amp; Observability","text":""},{"location":"development/architecture/#prometheus-metrics","title":"Prometheus Metrics","text":"<p>Exposed on separate port (default 9090):</p> <ul> <li>HTTP: Request count, duration, status codes</li> <li>Database: Query count, duration, errors</li> <li>Memory: Heap, sys, GC stats</li> <li>Thumbnails: Generation count, duration, cache hits</li> <li>Indexer: Files indexed, scan duration</li> </ul>"},{"location":"development/architecture/#logging","title":"Logging","text":"<p>Structured logging with levels:</p> <ul> <li><code>debug</code> - Detailed operation logs</li> <li><code>info</code> - Normal operational messages</li> <li><code>warn</code> - Concerning but non-critical events</li> <li><code>error</code> - Error conditions requiring attention</li> </ul>"},{"location":"development/architecture/#health-checks","title":"Health Checks","text":"<p>Multiple endpoints:</p> <ul> <li><code>/health</code> - Basic health check</li> <li><code>/livez</code> - Liveness probe (is process running?)</li> <li><code>/readyz</code> - Readiness probe (can it serve traffic?)</li> </ul>"},{"location":"development/architecture/#deployment-architecture","title":"Deployment Architecture","text":""},{"location":"development/architecture/#container","title":"Container","text":"<ul> <li>Base Image: Alpine Linux (small size)</li> <li>Runtime: Go binary + FFmpeg</li> <li>Volumes: Media (read-only), cache, database</li> <li>Ports: 8080 (HTTP), 9090 (metrics)</li> </ul>"},{"location":"development/architecture/#resource-limits","title":"Resource Limits","text":"<p>Recommended for typical deployment:</p> <ul> <li>CPU: 1-2 cores</li> <li>Memory: 512MB-2GB (depends on library size)</li> <li>Storage: Depends on thumbnail cache size</li> </ul>"},{"location":"development/architecture/#scalability","title":"Scalability","text":"<p>Current limitations (single-user design):</p> <ul> <li>Single SQLite database (not distributed)</li> <li>Single server instance (no horizontal scaling)</li> <li>Suitable for personal/family use (not multi-tenant)</li> </ul> <p>Future considerations:</p> <ul> <li>PostgreSQL support for multi-user scenarios</li> <li>Distributed caching for multiple instances</li> <li>Read replicas for database queries</li> </ul>"},{"location":"development/architecture/#nfs-resilience-performance","title":"NFS Resilience &amp; Performance","text":"<p>Media Viewer is designed to work reliably with NFS-mounted media directories, which can experience transient failures not seen with local filesystems.</p>"},{"location":"development/architecture/#common-nfs-issues","title":"Common NFS Issues","text":"Stale File Handle (ESTALE) NFS returns this error when a file handle becomes invalid due to: <ul> <li>File deletion or modification on the server</li> <li>NFS server restart or failover</li> <li>Network interruptions</li> <li>Cache coherency issues</li> </ul> High Metadata Latency NFS metadata operations (stat, readdir) are slower than local filesystems due to network round trips. Connection Instability Network issues can cause temporary connection loss or timeouts."},{"location":"development/architecture/#automatic-retry-mechanism","title":"Automatic Retry Mechanism","text":"<p>The <code>internal/filesystem</code> package provides resilient wrappers for filesystem operations:</p> <pre><code>// Stat with automatic retry for ESTALE errors\ninfo, err := filesystem.StatWithRetry(path, filesystem.DefaultRetryConfig())\n\n// Open with automatic retry for ESTALE errors\nfile, err := filesystem.OpenWithRetry(path, filesystem.DefaultRetryConfig())\n</code></pre> <p>Retry Configuration:</p> <ul> <li>MaxRetries: 3 attempts (default)</li> <li>InitialBackoff: 50ms</li> <li>MaxBackoff: 500ms (exponential backoff: 50ms \u2192 100ms \u2192 200ms)</li> <li>Error Detection: Only ESTALE (errno 116) triggers retries</li> </ul> <p>Performance Impact:</p> <ul> <li>Successful operations: ~100-150ns overhead</li> <li>Failed operations: Add backoff delay (default: 50ms + 100ms + 200ms = 350ms)</li> <li>Transparent to callers: Drop-in replacement for <code>os.Stat</code> and <code>os.Open</code></li> </ul>"},{"location":"development/architecture/#worker-tuning-for-nfs","title":"Worker Tuning for NFS","text":"<p>The <code>INDEX_WORKERS</code> environment variable controls indexer parallelism:</p> <p>Default Behavior:</p> <pre><code># Defaults to 3 workers (NFS-safe)\n# No environment variable needed\n</code></pre> <p>For Tuning:</p> <pre><code># Conservative (for problematic NFS)\nINDEX_WORKERS=1\n\n# Aggressive (for fast NFS or local storage)\nINDEX_WORKERS=16\n</code></pre> <p>Why It Matters:</p> <ul> <li>Too many workers \u2192 NFS server overwhelmed \u2192 ESTALE errors</li> <li>Too few workers \u2192 Slow indexing performance</li> <li>Default (3 workers) balances stability and performance</li> </ul>"},{"location":"development/architecture/#integration-points","title":"Integration Points","text":"<p>The retry mechanism is integrated throughout the application:</p> Component Usage Purpose <code>handlers/media.go</code> File serving, streaming Prevent 404 errors on transient failures <code>media/thumbnail.go</code> Thumbnail generation Prevent generation failures on ESTALE <code>handlers/files.go</code> Directory listing Prevent empty listings on transient failures <code>indexer/parallel.go</code> Directory scanning Resilient indexing with configurable workers"},{"location":"development/architecture/#monitoring-nfs-health","title":"Monitoring NFS Health","text":"<p>Retry-Specific Metrics:</p> <ul> <li><code>media_viewer_filesystem_retry_attempts_total{operation=\"stat|open\"}</code> - Count of retry attempts</li> <li><code>media_viewer_filesystem_retry_success_total{operation=\"stat|open\"}</code> - Successful recoveries from ESTALE</li> <li><code>media_viewer_filesystem_retry_failures_total{operation=\"stat|open\"}</code> - Failed retries after exhausting attempts</li> <li><code>media_viewer_filesystem_estale_errors_total{operation=\"stat|open\"}</code> - Total ESTALE errors encountered</li> <li><code>media_viewer_filesystem_retry_duration_seconds{operation=\"stat|open\"}</code> - Duration including retry delays</li> </ul> <p>General Filesystem Metrics:</p> <ul> <li><code>media_viewer_filesystem_operation_duration_seconds{directory,operation}</code> - Operation latency by directory</li> <li><code>media_viewer_filesystem_operation_errors_total{directory,operation}</code> - Operation error counts</li> <li><code>media_viewer_indexer_files_per_second</code> - Indexing throughput</li> </ul> <p>Log Messages:</p> <ul> <li>INFO: <code>\"NFS Stat succeeded on retry N for &lt;path&gt;\"</code> - Recoverable error</li> <li>ERROR: <code>\"NFS Stat failed after N retries for &lt;path&gt;\"</code> - Persistent issue requiring investigation</li> </ul> <p>Example Alerts:</p> <pre><code># Alert when retry failure rate is high\n- alert: HighNFSRetryFailureRate\n  expr: rate(media_viewer_filesystem_retry_failures_total[5m]) &gt; 0.1\n  annotations:\n      summary: 'High rate of NFS retry failures'\n\n# Alert when ESTALE errors are frequent\n- alert: FrequentNFSStaleErrors\n  expr: rate(media_viewer_filesystem_estale_errors_total[5m]) &gt; 1\n  annotations:\n      summary: 'Frequent ESTALE errors indicating NFS issues'\n</code></pre>"},{"location":"development/architecture/#best-practices","title":"Best Practices","text":"<ol> <li>Mount Options: Use <code>hard,intr,async</code> for better performance and reliability</li> <li>Worker Tuning: Start with default (3), adjust based on metrics</li> <li>Monitor Logs: Watch for retry patterns indicating NFS issues</li> <li>NFS Server: Ensure adequate resources (CPU, memory, network) on NFS server</li> <li>Network: Use dedicated network for NFS traffic if possible</li> </ol> <p>See also: INDEX_WORKERS Environment Variable and NFS Troubleshooting</p>"},{"location":"development/architecture/#see-also","title":"See Also","text":"<ul> <li>Monitoring Stack - Development monitoring with Prometheus and Grafana</li> <li>Testing Guide - Backend testing practices</li> <li>Memory &amp; GC Tuning - Performance optimization</li> <li>Metrics Reference - Complete metrics documentation</li> </ul>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Thank you for your interest in contributing to Media Viewer!</p> <p>For complete contributing guidelines, please see the CONTRIBUTING.md file in the root of the repository.</p>"},{"location":"development/contributing/#quick-links","title":"Quick Links","text":"<ul> <li>Report a Bug - Found an issue? Let us know</li> <li>Request a Feature - Have an idea? We'd love to hear it</li> <li>Discussions - Ask questions or share ideas</li> </ul>"},{"location":"development/contributing/#overview","title":"Overview","text":"<p>The main contributing guide covers:</p> <ul> <li>Setting up your development environment</li> <li>Code style guidelines</li> <li>Testing requirements</li> <li>Pull request process</li> <li>Commit message conventions</li> <li>Issue reporting templates</li> </ul>"},{"location":"development/contributing/#documentation","title":"Documentation","text":"<p>If you're specifically interested in contributing to documentation:</p> <ol> <li>Documentation is written in Markdown</li> <li>Source files are in the <code>docs/</code> directory</li> <li>Built with MkDocs Material theme</li> <li>Follow the MkDocs documentation for formatting</li> </ol> <p>To preview documentation changes locally:</p> <pre><code>make docs-serve\n</code></pre> <p>Then open <code>http://localhost:8000</code> in your browser.</p>"},{"location":"development/contributing/#getting-help","title":"Getting Help","text":"<p>If you have questions about contributing:</p> <ul> <li>Check the Architecture documentation for technical details</li> <li>Open a Discussion</li> <li>Comment on an existing issue</li> </ul> <p>We appreciate your contributions!</p>"},{"location":"development/monitoring/","title":"Development Monitoring Stack","text":"<p>This guide covers the monitoring stack for local development and performance testing using Docker Compose, Prometheus, and Grafana.</p>"},{"location":"development/monitoring/#overview","title":"Overview","text":"<p>The <code>hack/</code> directory contains a complete monitoring stack that includes:</p> <ul> <li>Media Viewer - Main application with metrics enabled</li> <li>Prometheus - Metrics collection and storage</li> <li>Grafana - Visualization and dashboards</li> </ul> <p>This stack is pre-configured with:</p> <ul> <li>Automatic dashboard provisioning</li> <li>Optimized GC settings for testing</li> <li>Cross-platform support (Linux, macOS, Windows)</li> <li>Network accessibility for testing from multiple devices</li> </ul>"},{"location":"development/monitoring/#quick-start","title":"Quick Start","text":""},{"location":"development/monitoring/#1-configure-media-directory","title":"1. Configure Media Directory","text":"<p>Edit <code>hack/docker-compose.yml</code> to set your media directory path:</p> <pre><code>volumes:\n    # Windows\n    - C:\\Users\\YourName\\Videos\\media-viewer:/media\n\n    # Linux\n    - /home/yourname/media-viewer:/media\n\n    # macOS\n    - /Users/yourname/media-viewer:/media\n</code></pre>"},{"location":"development/monitoring/#2-start-the-stack","title":"2. Start the Stack","text":"<p>Linux/macOS:</p> <pre><code>cd hack\n./start-monitoring.sh\n</code></pre> <p>Windows PowerShell:</p> <pre><code>cd hack\n.\\start-monitoring.ps1\n</code></pre> <p>Or manually:</p> <pre><code>cd hack\ndocker-compose up -d\n</code></pre>"},{"location":"development/monitoring/#3-access-services","title":"3. Access Services","text":"<p>Once running, access the services at:</p> <ul> <li>Media Viewer: http://localhost:8081</li> <li>Prometheus: http://localhost:9091</li> <li>Grafana: http://localhost:3001 (admin/admin)</li> </ul> <p>Note: These use different host ports than the standard setup to avoid conflicts. The main application is on port 8081 (instead of 8080), Prometheus on 9091 (instead of 9090), and Grafana on 3001 (instead of 3000).</p> <p>Network Access: If you cannot access via <code>localhost</code>, use your machine's IP address. Find it with:</p> <pre><code># Windows\nipconfig\n\n# Linux/macOS\nip addr show  # or ifconfig\n</code></pre> <p>Then access: <code>http://192.168.1.100:8081</code> (use your actual IP)</p> <p>For detailed network troubleshooting, see <code>hack/NETWORK-ACCESS.md</code>.</p>"},{"location":"development/monitoring/#helper-scripts","title":"Helper Scripts","text":""},{"location":"development/monitoring/#start-monitoring-stack","title":"Start Monitoring Stack","text":"<p>Automatically starts Docker Compose and checks service health:</p> <p>Linux/macOS:</p> <pre><code>cd hack\n./start-monitoring.sh\n</code></pre> <p>Windows PowerShell:</p> <pre><code>cd hack\n.\\start-monitoring.ps1\n</code></pre>"},{"location":"development/monitoring/#generate-load","title":"Generate Load","text":"<p>Generate realistic load for performance testing (runs for 5 minutes by default):</p> <p>Linux/macOS:</p> <pre><code># Default - hits localhost:8081\n./generate-load.sh\n\n# Custom URL\nBASE_URL=http://192.168.1.100:8081 ./generate-load.sh\n\n# Custom duration (10 minutes)\nDURATION=600 ./generate-load.sh\n</code></pre> <p>Windows PowerShell:</p> <pre><code># Default\n.\\generate-load.ps1\n\n# Custom URL\n.\\generate-load.ps1 -BaseUrl \"http://192.168.1.100:8081\"\n\n# Custom duration (10 minutes)\n.\\generate-load.ps1 -Duration 600\n</code></pre> <p>What it does:</p> <ul> <li>Hits public health check endpoints (<code>/readyz</code>, <code>/healthz</code>)</li> <li>Generates memory allocation load</li> <li>No authentication required</li> <li>Safe for continuous testing</li> </ul>"},{"location":"development/monitoring/#performance-testing-workflow","title":"Performance Testing Workflow","text":""},{"location":"development/monitoring/#1-establish-baseline","title":"1. Establish Baseline","text":"<p>Start with the default configuration:</p> <pre><code>cd hack\ndocker-compose up -d\n# Wait 5-10 minutes for metrics to stabilize\n</code></pre> <p>Record baseline metrics in Grafana:</p> <ul> <li>GC CPU Fraction: **_%**</li> <li>GC Frequency: **_** GCs/min</li> <li>P95 Thumbnail Time: **_** ms</li> <li>Memory Usage: **_%**</li> </ul>"},{"location":"development/monitoring/#2-run-load-tests","title":"2. Run Load Tests","text":"<p>Generate load to stress test the application:</p> <pre><code># Linux/macOS\n./generate-load.sh\n\n# Windows\n.\\generate-load.ps1\n</code></pre>"},{"location":"development/monitoring/#3-test-configuration-changes","title":"3. Test Configuration Changes","text":"<p>Edit <code>docker-compose.yml</code> to test different settings:</p> <pre><code>environment:\n    # Test MEMORY_RATIO\n    - MEMORY_RATIO=0.70\n\n    # Or test GOGC\n    - GOGC=150\n</code></pre> <p>Restart and monitor:</p> <pre><code>docker-compose restart media-viewer\n# Wait 5-10 minutes for steady state\n</code></pre>"},{"location":"development/monitoring/#4-compare-results","title":"4. Compare Results","text":"<p>Use Grafana's time range selector to overlay different periods and compare:</p> <ul> <li>GC CPU overhead changes</li> <li>GC frequency changes</li> <li>Memory usage patterns</li> <li>Throughput improvements</li> </ul>"},{"location":"development/monitoring/#key-metrics-to-monitor","title":"Key Metrics to Monitor","text":""},{"location":"development/monitoring/#gc-performance","title":"GC Performance","text":"Metric Target Interpretation <code>media_viewer_go_gc_cpu_fraction</code> &lt; 3% Percentage of CPU time spent in GC GC Frequency &lt; 10 GCs/min How often garbage collection runs GC Pause Duration &lt; 5ms (individual) Stop-the-world pause time GC Pause Budget &lt; 10ms/sec (total) Total pause time per second"},{"location":"development/monitoring/#memory-metrics","title":"Memory Metrics","text":"Metric Target Interpretation <code>media_viewer_memory_usage_ratio</code> &lt; 85% Memory usage vs configured limit Allocation Rate varies MB/sec being allocated Heap Size varies Current Go heap size"},{"location":"development/monitoring/#application-performance","title":"Application Performance","text":"Metric Target Interpretation P95 Thumbnail Time &lt; 500ms 95th percentile generation time P95 API Latency &lt; 100ms 95th percentile request latency Cache Hit Rate &gt; 80% Thumbnail cache efficiency Indexing Throughput varies Files processed per second"},{"location":"development/monitoring/#prometheus-queries","title":"Prometheus Queries","text":"<p>Access Prometheus at http://localhost:9091/graph and run these queries:</p>"},{"location":"development/monitoring/#gc-performance_1","title":"GC Performance","text":"<pre><code># GC CPU overhead (percentage)\nmedia_viewer_go_gc_cpu_fraction * 100\n\n# GC frequency (GCs per minute)\nrate(media_viewer_go_gc_runs_total[5m]) * 60\n\n# GC pause budget (ms per second)\nrate(media_viewer_go_gc_pause_total_seconds[5m]) * 1000\n\n# Memory pressure (% of GOMEMLIMIT)\nmedia_viewer_go_memalloc_bytes / media_viewer_go_memlimit_bytes * 100\n</code></pre>"},{"location":"development/monitoring/#application-performance_1","title":"Application Performance","text":"<pre><code># P95 thumbnail generation time\nhistogram_quantile(0.95,\n  rate(media_viewer_thumbnail_generation_duration_seconds_bucket{type=\"image\"}[5m]))\n\n# P95 API latency\nhistogram_quantile(0.95,\n  rate(media_viewer_http_request_duration_seconds_bucket[5m]))\n\n# Request rate\nrate(media_viewer_http_requests_total[5m])\n\n# Cache hit rate\nrate(media_viewer_thumbnail_cache_hits_total[5m])\n  /\n(rate(media_viewer_thumbnail_cache_hits_total[5m])\n  + rate(media_viewer_thumbnail_cache_misses_total[5m]))\n</code></pre>"},{"location":"development/monitoring/#grafana-dashboard","title":"Grafana Dashboard","text":"<p>The stack includes a pre-built dashboard with panels for:</p> <ul> <li>HTTP Performance: Request rates, latencies, error rates</li> <li>Garbage Collection: CPU overhead, frequency, pause times</li> <li>Memory Usage: Heap size, allocation rate, pressure</li> <li>Indexing: Throughput, batch performance, errors</li> <li>Thumbnails: Generation time, cache efficiency, phase timing</li> <li>Database: Query performance, transaction rates</li> </ul> <p>The dashboard is automatically loaded on startup.</p>"},{"location":"development/monitoring/#manual-import","title":"Manual Import","text":"<p>If the dashboard doesn't load automatically:</p> <ol> <li>Go to Dashboards \u2192 Import in Grafana</li> <li>Upload <code>hack/grafana/dashboard.json</code></li> </ol>"},{"location":"development/monitoring/#configuration-testing","title":"Configuration Testing","text":""},{"location":"development/monitoring/#default-configuration","title":"Default Configuration","text":"<p>The stack starts with optimized production settings:</p> <pre><code>environment:\n    - MEMORY_LIMIT=2147483648 # 2 GiB\n    - MEMORY_RATIO=0.75 # Recommended for production\n</code></pre> <p>Expected results:</p> <ul> <li>GC CPU overhead: ~0.16%</li> <li>GC frequency: 0.2/s idle, 6/s under load</li> <li>Adaptive behavior based on workload</li> </ul>"},{"location":"development/monitoring/#testing-gogc","title":"Testing GOGC","text":"<p>Test fixed GC targeting instead of memory ratio:</p> <pre><code>environment:\n    - GOGC=150\n    # Comment out MEMORY_RATIO when using GOGC\n</code></pre> <p>Expected results:</p> <ul> <li>GC CPU overhead: ~0.15%</li> <li>GC frequency: ~4.5/s (constant)</li> <li>Predictable behavior regardless of load</li> </ul>"},{"location":"development/monitoring/#testing-different-memory_ratio-values","title":"Testing Different MEMORY_RATIO Values","text":"<pre><code>environment:\n    # More memory for Go heap (more caching)\n    - MEMORY_RATIO=0.80\n\n    # Less memory for Go heap (more for FFmpeg/CGO)\n    - MEMORY_RATIO=0.70\n</code></pre>"},{"location":"development/monitoring/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/monitoring/#cannot-access-services","title":"Cannot Access Services","text":"<p>Symptom: Cannot connect to http://localhost:8081</p> <p>Solutions:</p> <ol> <li> <p>Check containers are running:</p> <pre><code>docker-compose ps\n</code></pre> <p>All should show \"Up\" status.</p> </li> <li> <p>Check port conflicts:</p> <pre><code># Windows\nnetstat -ano | findstr \"8081\"\n\n# Linux/macOS\nlsof -i :8081\n</code></pre> </li> <li> <p>Use host IP instead of localhost:</p> <pre><code># Find your IP\nipconfig  # Windows\nip addr   # Linux\n\n# Access via IP\nhttp://192.168.1.100:8081\n</code></pre> </li> <li> <p>Check firewall (Windows):</p> <p>Ports may need to be allowed through Windows Firewall if accessing from another machine.</p> </li> </ol> <p>See <code>hack/NETWORK-ACCESS.md</code> for detailed troubleshooting.</p>"},{"location":"development/monitoring/#no-metrics-showing-in-grafana","title":"No Metrics Showing in Grafana","text":"<p>Check Prometheus scraping:</p> <pre><code># Check targets\ncurl http://localhost:9091/api/v1/targets\n\n# Check metrics endpoint\ncurl http://localhost:8081/metrics | grep media_viewer_go_gc\n</code></pre> <p>Check Prometheus target status:</p> <p>Visit http://localhost:9091/targets - should show <code>media-viewer (1/1 up)</code></p>"},{"location":"development/monitoring/#container-wont-start","title":"Container Won't Start","text":"<p>Check logs:</p> <pre><code>docker-compose logs media-viewer\n</code></pre> <p>Rebuild if needed:</p> <pre><code>docker-compose build --no-cache media-viewer\ndocker-compose up -d\n</code></pre>"},{"location":"development/monitoring/#media-directory-mount-error","title":"Media Directory Mount Error","text":"<p>Windows:</p> <ol> <li>Ensure directory exists: <code>Test-Path \"D:\\path\\to\\media\"</code></li> <li>Check Docker Desktop \u2192 Settings \u2192 Resources \u2192 File Sharing</li> <li>Ensure drive is shared and restart Docker Desktop</li> </ol> <p>Linux/macOS:</p> <ol> <li>Check permissions: <code>ls -la /path/to/media</code></li> <li>Ensure directory exists: <code>mkdir -p /path/to/media</code></li> </ol>"},{"location":"development/monitoring/#benchmark-results","title":"Benchmark Results","text":"<p>Based on real-world testing with 3,106 thumbnail generation:</p>"},{"location":"development/monitoring/#before-optimization-manual-gc","title":"Before Optimization (Manual GC)","text":"Metric Value GC CPU Overhead 1.88% GC Frequency (idle) 31/sec GC Frequency (load) 31/sec Memory Usage 502 MB"},{"location":"development/monitoring/#after-optimization-memory_ratio075","title":"After Optimization (MEMORY_RATIO=0.75)","text":"Metric Value Improvement GC CPU Overhead 0.16% \u2193 91% GC Frequency (idle) 0.2/sec \u2193 99% GC Frequency (load) 6/sec \u2193 80% Memory Usage 534 MB +6%"},{"location":"development/monitoring/#configuration-comparison","title":"Configuration Comparison","text":"Configuration GC CPU % Idle GC/s Load GC/s Behavior Original (Manual GC) 1.88% 31 31 Fixed GOGC=150 0.15% 4.5 4.5 Fixed MEMORY_RATIO=0.75 0.16% 0.2 6 Adaptive \u2705"},{"location":"development/monitoring/#data-persistence","title":"Data Persistence","text":"<p>All data is persisted in Docker volumes:</p> <pre><code># List volumes\ndocker volume ls | grep hack\n\n# Backup Grafana dashboards\ndocker cp hack-grafana-1:/var/lib/grafana/dashboards ./backup/\n\n# Clean up everything (WARNING: deletes all data)\ndocker-compose down -v\n</code></pre>"},{"location":"development/monitoring/#production-notes","title":"Production Notes","text":"<p>The monitoring stack in <code>hack/</code> is designed for development and testing. For production deployment:</p> <ol> <li> <p>Secure Grafana:</p> <pre><code>environment:\n    - GF_SECURITY_ADMIN_PASSWORD=&lt;strong-password&gt;\n</code></pre> </li> <li> <p>Increase Prometheus retention:</p> <pre><code>command:\n    - '--storage.tsdb.retention.time=30d'\n</code></pre> </li> <li> <p>Add resource limits: <pre><code>deploy:\n    resources:\n        limits:\n            memory: 1G\n            cpus: '0.5'\n</code></pre></p> </li> </ol> <p>See the Metrics &amp; Monitoring documentation for production deployment guidance.</p>"},{"location":"development/monitoring/#see-also","title":"See Also","text":"<ul> <li>Profiling Guide - CPU, memory, and database profiling techniques</li> <li>Memory &amp; GC Tuning - Detailed tuning guide with benchmarks</li> <li>Metrics Reference - Complete metrics documentation</li> <li>Architecture Overview - System architecture and design</li> <li>Testing Guide - Backend testing practices</li> </ul>"},{"location":"development/monitoring/#additional-resources","title":"Additional Resources","text":"<p>The <code>hack/</code> directory contains additional documentation:</p> <ul> <li>ARCHITECTURE.md - Port mappings and network architecture</li> <li>NETWORK-ACCESS.md - Network troubleshooting guide</li> <li>GC-MONITORING.md - Historical GC tuning guide (see Memory Tuning for current docs)</li> </ul>"},{"location":"development/sample-media/","title":"Sample Media for Development","text":"<p>The <code>sample-media</code> directory provides test content for development and testing of the media viewer application.</p>"},{"location":"development/sample-media/#overview","title":"Overview","text":"<p>Sample media files are used to:</p> <ul> <li>Test Features: Validate gallery browsing, thumbnails, search, tags, and favorites</li> <li>Performance Testing: Measure indexing and rendering performance with realistic datasets</li> <li>UI Development: Develop and refine the user interface with actual content</li> <li>Integration Testing: Test video transcoding, thumbnail generation, and file handling</li> </ul>"},{"location":"development/sample-media/#directory-structure","title":"Directory Structure","text":"<pre><code>sample-media/\n\u251c\u2500\u2500 *.jpg, *.png          # Sample images\n\u251c\u2500\u2500 *.mp4, *.mov, *.webm  # Sample videos\n\u251c\u2500\u2500 folder/               # Nested directory examples\n\u2514\u2500\u2500 New folder/           # Test various folder naming patterns\n</code></pre> <p>The application automatically indexes all media files recursively within the <code>sample-media</code> directory.</p>"},{"location":"development/sample-media/#downloading-sample-media","title":"Downloading Sample Media","text":"<p>A convenience script is provided to download free, open-source, royalty-free sample media:</p> <pre><code>make download-sample-media\n</code></pre> <p>Or run directly:</p> <pre><code>./hack/download-sample-media.sh\n</code></pre>"},{"location":"development/sample-media/#what-gets-downloaded","title":"What Gets Downloaded","text":"<p>By default, the script downloads:</p> <ul> <li>250 images from Unsplash Source and Picsum (random, diverse content)</li> <li>16+ videos from Google's sample video collection and other free sources</li> </ul> <p>All content is:</p> <ul> <li>\u2705 Free to use - No licensing restrictions</li> <li>\u2705 Royalty-free - No attribution required</li> <li>\u2705 Open source - From public domain or creative commons sources</li> </ul>"},{"location":"development/sample-media/#customizing-downloads","title":"Customizing Downloads","text":"<p>You can customize the number of files downloaded:</p> <pre><code># Download more images\nNUM_IMAGES=500 ./hack/download-sample-media.sh\n\n# Download fewer videos\nNUM_VIDEOS=10 ./hack/download-sample-media.sh\n\n# Combine options\nNUM_IMAGES=300 NUM_VIDEOS=25 ./hack/download-sample-media.sh\n</code></pre>"},{"location":"development/sample-media/#using-pexels-api-optional","title":"Using Pexels API (Optional)","text":"<p>For additional video content, you can use the Pexels API (free tier available):</p> <ol> <li>Sign up at pexels.com/api</li> <li>Get your API key</li> <li>Run with the API key:</li> </ol> <pre><code>PEXELS_API_KEY='your-api-key' ./hack/download-sample-media.sh\n</code></pre> <p>This enables downloading additional high-quality stock videos beyond the default sources.</p>"},{"location":"development/sample-media/#script-behavior","title":"Script Behavior","text":"<p>The download script:</p> <ul> <li>Preserves existing files: Already downloaded files are skipped (no re-downloading)</li> <li>Creates directory: Automatically creates <code>sample-media/</code> if it doesn't exist</li> <li>Random content: Uses randomization to get diverse images on each run</li> <li>Progress indicators: Shows download progress with \u2705/\u274c status for each file</li> <li>Rate limiting: Includes delays between requests to be respectful to free APIs</li> </ul>"},{"location":"development/sample-media/#sample-media-sources","title":"Sample Media Sources","text":""},{"location":"development/sample-media/#images","title":"Images","text":"<ul> <li>Picsum Photos - Lorem Ipsum for photos, free placeholder images</li> <li>Unsplash Source - Random photos from Unsplash's API</li> </ul>"},{"location":"development/sample-media/#videos","title":"Videos","text":"<ul> <li>Google Sample Videos - High-quality creative commons videos<ul> <li>Big Buck Bunny</li> <li>Sintel</li> <li>Tears of Steel</li> <li>ElephantsDream</li> <li>Various short test clips</li> </ul> </li> <li>Pexels Videos - Stock video library (requires API key)</li> </ul>"},{"location":"development/sample-media/#manual-downloads","title":"Manual Downloads","text":"<p>If you prefer to add your own media:</p> <ol> <li>Place image/video files directly in <code>sample-media/</code></li> <li>Create subdirectories for organizational testing</li> <li>Supported formats:<ul> <li>Images: <code>.jpg</code>, <code>.jpeg</code>, <code>.png</code>, <code>.gif</code>, <code>.webp</code>, <code>.bmp</code></li> <li>Videos: <code>.mp4</code>, <code>.mov</code>, <code>.avi</code>, <code>.mkv</code>, <code>.webm</code>, <code>.m4v</code></li> </ul> </li> </ol> <p>The indexer will automatically discover new files on the next scan cycle.</p>"},{"location":"development/sample-media/#testing-different-scenarios","title":"Testing Different Scenarios","text":""},{"location":"development/sample-media/#large-collections","title":"Large Collections","text":"<p>Test performance with large media libraries:</p> <pre><code># Download a large collection\nNUM_IMAGES=1000 NUM_VIDEOS=50 ./hack/download-sample-media.sh\n</code></pre>"},{"location":"development/sample-media/#nested-directories","title":"Nested Directories","text":"<p>Create nested folder structures to test recursive indexing:</p> <pre><code>cd sample-media\nmkdir -p nature/landscapes nature/animals cities/urban cities/architecture\n# Move files into subdirectories for organization testing\n</code></pre>"},{"location":"development/sample-media/#special-characters","title":"Special Characters","text":"<p>Test handling of various filename patterns:</p> <ul> <li>Spaces: <code>My Vacation Photo.jpg</code></li> <li>Unicode: <code>\u65e5\u672c\u306e\u5199\u771f.jpg</code>, <code>Caf\u00e9\u2615.jpg</code></li> <li>Special chars: <code>photo-2024_01.jpg</code>, <code>video (1080p).mp4</code></li> </ul>"},{"location":"development/sample-media/#cleaning-up","title":"Cleaning Up","text":"<p>To start fresh:</p> <pre><code># Remove all downloaded sample media\nrm -rf sample-media/*\n\n# Keep specific files/folders\nrm sample-media/unsplash_*.jpg\nrm sample-media/picsum_*.jpg\nrm sample-media/sample_video_*.mp4\n</code></pre>"},{"location":"development/sample-media/#cicd-integration","title":"CI/CD Integration","text":"<p>The sample media directory is typically excluded from version control (via <code>.gitignore</code>) since media files are large and can be regenerated.</p> <p>For CI/CD pipelines that need sample data:</p> <pre><code>- name: Download sample media\n  run: |\n      NUM_IMAGES=50 NUM_VIDEOS=5 ./hack/download-sample-media.sh\n</code></pre> <p>This provides a small test dataset for automated testing without bloating the repository.</p>"},{"location":"development/sample-media/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/sample-media/#download-failures","title":"Download Failures","text":"<p>If downloads fail:</p> <ol> <li>Check internet connection: Ensure you can reach external APIs</li> <li>Check rate limits: Wait a few minutes and retry</li> <li>Manual retry: Delete failed files and re-run (script skips existing files)</li> <li>Try fewer files: Reduce <code>NUM_IMAGES</code> or <code>NUM_VIDEOS</code></li> </ol>"},{"location":"development/sample-media/#disk-space","title":"Disk Space","text":"<p>The default download (~250 images + 16 videos) requires approximately:</p> <ul> <li>Images: ~50-150 MB (varies by resolution)</li> <li>Videos: ~100-500 MB (depends on video quality/length)</li> <li>Total: ~200-650 MB</li> </ul> <p>Ensure adequate disk space before downloading large collections.</p>"},{"location":"development/sample-media/#indexing-performance","title":"Indexing Performance","text":"<p>If indexing is slow with large collections:</p> <ol> <li>Adjust <code>INDEX_INTERVAL</code> environment variable</li> <li>Check system resources (CPU, disk I/O)</li> <li>Consider reducing collection size for development</li> <li>Use SSD storage for better performance</li> </ol>"},{"location":"development/sample-media/#best-practices","title":"Best Practices","text":"<ul> <li>Start small: Begin with the default 250 images for development</li> <li>Test incrementally: Add more content as needed for specific testing</li> <li>Clean periodically: Remove unused sample files to save disk space</li> <li>Document custom datasets: If using specialized test media, document the purpose</li> <li>Respect APIs: Don't abuse free APIs with excessive requests</li> </ul>"},{"location":"development/sample-media/#related-documentation","title":"Related Documentation","text":"<ul> <li>Architecture Overview - How indexing and caching work</li> <li>Testing Guide - Using sample media in tests</li> <li>Contributing Guide - Development workflow best practices</li> </ul>"},{"location":"development/testing/","title":"Testing Guide","text":"<p>This guide covers testing practices, tools, and procedures for the Media Viewer project.</p>"},{"location":"development/testing/#overview","title":"Overview","text":"<p>The project has two test suites:</p> <ul> <li>Backend Tests - Go tests for the backend server</li> <li>Frontend Tests - JavaScript tests for the web frontend (unit, integration, and E2E)</li> </ul>"},{"location":"development/testing/#frontend-testing","title":"Frontend Testing","text":"<p>The frontend has three types of tests:</p> <ul> <li>Unit Tests - Test isolated code without external dependencies (no backend required)</li> <li>Integration Tests - Test frontend integration with backend APIs (backend required)</li> <li>E2E Tests - Browser-based tests with Playwright (backend required)</li> </ul>"},{"location":"development/testing/#quick-start-frontend","title":"Quick Start (Frontend)","text":"<pre><code># Unit tests only (no backend required)\nmake frontend-test-unit\n\n# Integration tests (requires backend)\nmake dev  # Terminal 1: Start backend\nmake frontend-test-integration  # Terminal 2\n\n# E2E tests (requires backend)\nmake frontend-test-e2e\n\n# All frontend tests\nmake frontend-test\n</code></pre>"},{"location":"development/testing/#running-frontend-tests","title":"Running Frontend Tests","text":""},{"location":"development/testing/#unit-tests-no-backend-required","title":"Unit Tests (No Backend Required)","text":"<p>Unit tests run in isolation without any external dependencies:</p> <pre><code># Run all unit tests\nmake frontend-test-unit\ncd static &amp;&amp; npm run test:unit:only\n\n# Watch mode (reruns on file changes)\nmake frontend-test-unit-watch\ncd static &amp;&amp; npm run test:unit:watch\n\n# Interactive UI\nmake frontend-test-unit-ui\ncd static &amp;&amp; npm run test:unit:ui\n\n# With coverage\nmake frontend-test-unit-coverage\ncd static &amp;&amp; npm run test:unit:coverage\n</code></pre> <p>Unit test coverage includes 15 test files with 533+ test cases covering:</p> <ul> <li>Core Features: History management, preferences, session tracking, selection mode, settings utilities</li> <li>Media Components: Lightbox navigation, video player controls, playlist navigation</li> <li>UI Utilities: Clock display, tag clipboard/tooltips, wake lock management</li> <li>Pagination: Infinite scroll for gallery and search results</li> </ul> <p>See Frontend Test Structure for complete file listing.</p>"},{"location":"development/testing/#integration-tests-backend-required","title":"Integration Tests (Backend Required)","text":"<p>Integration tests verify frontend integration with the real backend APIs.</p> <p>Prerequisites:</p> <ol> <li>Start the backend server first:</li> </ol> <pre><code>make dev\n</code></pre> <ol> <li>Run integration tests:</li> </ol> <pre><code># Run all integration tests\nmake frontend-test-integration\ncd static &amp;&amp; npm run test:integration\n\n# Run a specific test file\ncd static &amp;&amp; npx vitest run tests/integration/session.test.js\n</code></pre> <p>Integration test coverage includes 5 test files with 80+ test cases covering:</p> <ul> <li>Authentication: Login, logout, session expiration handling</li> <li>Core APIs: Stats, health checks, version info</li> <li>Gallery: File listing, pagination, sorting, filtering</li> <li>Favorites: Add/remove/query favorite items with idempotency</li> <li>Search &amp; Tags: Full-text search, tag management, tag filtering</li> </ul> <p>See Frontend Test Structure for complete file listing.</p>"},{"location":"development/testing/#e2e-tests-backend-required","title":"E2E Tests (Backend Required)","text":"<p>End-to-end browser tests using Playwright.</p> <p>Prerequisites:</p> <ol> <li>Start the backend server:</li> </ol> <pre><code>make dev\n</code></pre> <ol> <li>Run E2E tests:</li> </ol> <pre><code># Run all E2E tests\nmake frontend-test-e2e\ncd static &amp;&amp; npm run test:e2e\n\n# Run with browser visible\ncd static &amp;&amp; npm run test:e2e:headed\n\n# Interactive mode\ncd static &amp;&amp; npm run test:e2e:ui\n\n# Debug mode\ncd static &amp;&amp; npm run test:e2e:debug\n\n# View test report\ncd static &amp;&amp; npm run test:e2e:report\n</code></pre>"},{"location":"development/testing/#all-frontend-tests","title":"All Frontend Tests","text":"<p>Run the complete frontend test suite (unit + integration + E2E):</p> <pre><code>make frontend-test\ncd static &amp;&amp; npm test\n</code></pre> <p>This requires the backend to be running for integration and E2E tests.</p>"},{"location":"development/testing/#frontend-test-configuration","title":"Frontend Test Configuration","text":""},{"location":"development/testing/#environment-variables","title":"Environment Variables","text":"<p>Override default settings:</p> <pre><code># Use a different backend URL\nTEST_BASE_URL=http://localhost:3000 npm run test:integration\n\n# For E2E tests\nBASE_URL=http://localhost:3000 npm run test:e2e\n</code></pre>"},{"location":"development/testing/#test-configuration-file","title":"Test Configuration File","text":"<p>Core configuration in <code>static/tests/test.config.js</code>:</p> <ul> <li><code>BASE_URL</code> - Backend server URL (default: http://localhost:8080)</li> <li><code>TEST_USER</code> - Test credentials</li> <li><code>TIMEOUTS</code> - Various timeout settings</li> <li>API endpoint paths</li> </ul>"},{"location":"development/testing/#api-helpers","title":"API Helpers","text":"<p>Helper functions for integration tests in <code>static/tests/helpers/api-helpers.js</code>:</p> <ul> <li><code>ensureAuthenticated()</code> - Ensure logged in before tests</li> <li><code>login(password)</code> - Authenticate user</li> <li><code>logout()</code> - End session</li> <li><code>checkAuth()</code> - Check authentication status</li> <li><code>listFiles(path)</code> - Get file listing</li> <li><code>getAllTags()</code> - Get all tags</li> <li><code>addTagToFile()</code>, <code>removeTagFromFile()</code> - Tag management</li> <li><code>getFavorites()</code>, <code>addFavorite()</code>, <code>removeFavorite()</code> - Favorites</li> <li><code>search(query)</code> - Search functionality</li> </ul>"},{"location":"development/testing/#frontend-cicd","title":"Frontend CI/CD","text":"<p>Frontend tests run automatically in GitHub Actions:</p> <ol> <li>Unit tests - Run first without backend (fast, ~60s)</li> <li>Integration tests - Run after starting backend (~45s)</li> <li>E2E tests - Run with backend and browser automation (~2min)</li> <li>Coverage upload - Coverage reports uploaded as artifacts</li> </ol> <p>Test Statistics (February 2026):</p> <ul> <li>Total test files: 20 (15 unit + 5 integration)</li> <li>Total test cases: 613+ tests</li> <li>Coverage: ~80% of frontend modules</li> <li>CI execution time: ~4 minutes total</li> </ul> <p>See <code>.github/workflows/ci.yml</code> for workflow details.</p>"},{"location":"development/testing/#frontend-test-structure","title":"Frontend Test Structure","text":"<pre><code>static/tests/\n\u251c\u2500\u2500 unit/              # Unit tests (no backend)\n\u2502   \u251c\u2500\u2500 clock.test.js                    # Clock display and time formatting\n\u2502   \u251c\u2500\u2500 history.test.js                  # Navigation history management\n\u2502   \u251c\u2500\u2500 infinite-scroll.test.js          # Gallery pagination logic\n\u2502   \u251c\u2500\u2500 infinite-scroll-search.test.js   # Search result pagination\n\u2502   \u251c\u2500\u2500 lightbox.test.js                 # Lightbox navigation and zoom\n\u2502   \u251c\u2500\u2500 playlist.test.js                 # Playlist navigation and state\n\u2502   \u251c\u2500\u2500 preferences.test.js              # localStorage operations\n\u2502   \u251c\u2500\u2500 selection.test.js                # Item selection state\n\u2502   \u251c\u2500\u2500 session.test.js                  # Session manager (mocked)\n\u2502   \u251c\u2500\u2500 settings.test.js                 # Settings manager utilities\n\u2502   \u251c\u2500\u2500 tag-clipboard.test.js            # Tag clipboard operations\n\u2502   \u251c\u2500\u2500 tag-tooltip.test.js              # Tag tooltip utilities\n\u2502   \u251c\u2500\u2500 video-controls.test.js           # Video control utilities\n\u2502   \u251c\u2500\u2500 video-player.test.js             # VideoPlayer class\n\u2502   \u2514\u2500\u2500 wake-lock.test.js                # Wake Lock API management\n\u251c\u2500\u2500 integration/       # Integration tests (backend required)\n\u2502   \u251c\u2500\u2500 app.test.js                      # Core application APIs\n\u2502   \u251c\u2500\u2500 favorites.test.js                # Favorites API operations\n\u2502   \u251c\u2500\u2500 gallery.test.js                  # File listing and favorites\n\u2502   \u251c\u2500\u2500 search-tags.test.js              # Search and tag management\n\u2502   \u2514\u2500\u2500 session.test.js                  # Authentication API\n\u251c\u2500\u2500 e2e/               # End-to-end browser tests (Playwright)\n\u2502   \u2514\u2500\u2500 [playwright test files]\n\u251c\u2500\u2500 helpers/\n\u2502   \u251c\u2500\u2500 api-helpers.js    # Real API call helpers\n\u2502   \u251c\u2500\u2500 setup.js          # Test environment setup\n\u2502   \u2514\u2500\u2500 test-utils.js     # Mock utilities\n\u251c\u2500\u2500 test.config.js        # Central configuration\n\u2514\u2500\u2500 README.md             # Detailed frontend test docs\n</code></pre>"},{"location":"development/testing/#troubleshooting-frontend-tests","title":"Troubleshooting Frontend Tests","text":""},{"location":"development/testing/#backend-connection-issues","title":"Backend Connection Issues","text":"<pre><code># Verify backend is running\ncurl http://localhost:8080/health\n\n# Check backend logs for errors\nmake dev\n</code></pre>"},{"location":"development/testing/#test-timeouts","title":"Test Timeouts","text":"<p>If tests timeout, increase the timeout in vitest.config.js or the specific test:</p> <pre><code>it('slow test', async () =&gt; {\n    // test code\n}, 20000); // 20 second timeout\n</code></pre>"},{"location":"development/testing/#e2e-test-failures","title":"E2E Test Failures","text":"<pre><code># Run with visible browser to see what's happening\ncd static &amp;&amp; npm run test:e2e:headed\n\n# Generate test code interactively\ncd static &amp;&amp; npm run test:e2e:codegen\n</code></pre>"},{"location":"development/testing/#clear-test-state","title":"Clear Test State","text":"<pre><code># Reset authentication by restarting backend\n# Cookies are reset between test files automatically\n</code></pre>"},{"location":"development/testing/#backend-testing","title":"Backend Testing","text":"<p>This section covers testing for the backend Go code.</p>"},{"location":"development/testing/#quick-start-backend","title":"Quick Start (Backend)","text":"<pre><code># Run all tests\nmake test\n\n# Run tests with coverage report\nmake test-coverage\n\n# Run tests for a specific package\nmake test-package PKG=handlers\n</code></pre>"},{"location":"development/testing/#running-backend-tests","title":"Running Backend Tests","text":""},{"location":"development/testing/#all-tests","title":"All Tests","text":"<pre><code>make test\n</code></pre> <p>This runs the complete test suite across all packages.</p>"},{"location":"development/testing/#short-mode","title":"Short Mode","text":"<p>Skip long-running tests with short mode:</p> <pre><code>make test-short\n</code></pre>"},{"location":"development/testing/#package-specific-tests","title":"Package-Specific Tests","text":"<p>Test individual packages using short package names or full paths:</p> <pre><code># Test a specific package (short name)\nmake test-package PKG=indexer\n\n# Test with a filter for specific test names\nmake test-package PKG=indexer TESTARGS=\"-run=TestNew\"\n\n# Test another package\nmake test-package PKG=handlers TESTARGS=\"-run=TestHealth\"\n\n# Full paths also work\nmake test-package PKG=./internal/indexer\n\n# Set a custom timeout\nmake test-package PKG=indexer TESTTIMEOUT=5m\n\n# Run specific tests with verbose output\nmake test-package PKG=database TESTARGS=\"-run=TestUser -v\"\n</code></pre> <p>Available packages: <code>database</code>, <code>handlers</code>, <code>indexer</code>, <code>logging</code>, <code>media</code>, <code>mediatypes</code>, <code>memory</code>, <code>metrics</code>, <code>middleware</code>, <code>playlist</code>, <code>startup</code>, <code>streaming</code>, <code>transcoder</code>, <code>workers</code></p>"},{"location":"development/testing/#coverage-reports","title":"Coverage Reports","text":""},{"location":"development/testing/#html-report","title":"HTML Report","text":"<p>Generate an interactive HTML coverage report:</p> <pre><code># Coverage for all packages\nmake test-coverage\n\n# Coverage for a specific package (short name)\nmake test-coverage PKG=indexer\n\n# Coverage with test filtering\nmake test-coverage PKG=handlers TESTARGS=\"-run=TestHealth\"\n\n# Full paths also work\nmake test-coverage PKG=./internal/indexer\n</code></pre> <p>The report is saved as <code>coverage.html</code> and the total coverage percentage is displayed.</p>"},{"location":"development/testing/#text-summary","title":"Text Summary","text":"<p>View coverage as a text summary:</p> <pre><code>make test-coverage-report\n</code></pre>"},{"location":"development/testing/#race-detection","title":"Race Detection","text":"<p>Run tests with the race detector to identify data races:</p> <pre><code>make test-race\n</code></pre>"},{"location":"development/testing/#benchmarks","title":"Benchmarks","text":"<p>Run performance benchmarks:</p> <pre><code>make test-bench\n</code></pre>"},{"location":"development/testing/#cleanup","title":"Cleanup","text":"<p>Remove test artifacts and coverage reports:</p> <pre><code>make test-clean\n</code></pre>"},{"location":"development/testing/#test-organization","title":"Test Organization","text":"<p>Tests follow Go conventions with <code>_test.go</code> files colocated with source code.</p>"},{"location":"development/testing/#current-coverage-by-package","title":"Current Coverage by Package","text":""},{"location":"development/testing/#command-line-tools","title":"Command Line Tools","text":"<ul> <li><code>cmd/media-viewer</code> - Main application entry point<ul> <li>Server configuration and routing</li> <li>Graceful shutdown handling</li> </ul> </li> </ul>"},{"location":"development/testing/#core-packages","title":"Core Packages","text":"<ul> <li><code>internal/mediatypes</code> - File type detection<ul> <li>MIME type mapping</li> <li>File extension classification</li> </ul> </li> <li><code>internal/memory</code> - Memory management<ul> <li>Configuration validation</li> <li>Resource limits</li> </ul> </li> <li><code>internal/startup</code> - Application bootstrap<ul> <li>Configuration loading</li> <li>Environment variable parsing</li> </ul> </li> <li><code>internal/logging</code> - Structured logging<ul> <li>Log levels and formatting</li> </ul> </li> <li><code>internal/workers</code> - Worker pools<ul> <li>CPU/IO task optimization</li> <li>Dynamic worker scaling</li> </ul> </li> </ul>"},{"location":"development/testing/#http-layer","title":"HTTP Layer","text":"<ul> <li><code>internal/middleware</code> (200 lines, 8 tests) - HTTP middleware<ul> <li>Logging middleware</li> <li>Compression (gzip, brotli)</li> <li>Response writer wrappers</li> </ul> </li> <li><code>internal/handlers</code> (2,320+ lines, 96+ tests) - HTTP handlers<ul> <li>Health checks and version endpoints</li> <li>Media file serving with security validation</li> <li>Playlist handlers</li> <li>Search and query handlers</li> <li>Tag management (single, batch, bulk operations)</li> <li>Transcode cache management</li> <li>WebAuthn/passkey authentication flows</li> </ul> </li> </ul>"},{"location":"development/testing/#data-layer","title":"Data Layer","text":"<ul> <li> <p><code>internal/database</code> (73 tests + 2 benchmarks) - Database operations</p> <ul> <li>Core Operations (31 tests)<ul> <li>Transaction management</li> <li>CRUD operations</li> <li>Directory listing with pagination/filtering/sorting</li> <li>Full-text search with FTS5</li> <li>Thumbnail tracking and statistics</li> <li>Concurrent access testing</li> </ul> </li> <li>Favorites Module (8 tests)<ul> <li>Add/remove favorites</li> <li>Query and count operations</li> </ul> </li> <li>Tags Module (13 tests)<ul> <li>Tag creation and management</li> <li>File tagging operations</li> <li>Tag queries and pagination</li> </ul> </li> <li>Metadata Module (8 tests)<ul> <li>Get/set metadata</li> <li>Special characters and large values</li> </ul> </li> <li>WebAuthn Module (13 tests)<ul> <li>Credential management</li> <li>Session handling</li> <li>User interface</li> </ul> </li> <li>Coverage: ~40%</li> </ul> </li> <li> <p><code>internal/media</code> (12 tests + 1 benchmark) - Media processing</p> <ul> <li>Type detection and helpers</li> <li>Image loading and processing</li> <li>Thumbnail generation pipeline</li> <li>Worker pool batch processing</li> <li>Coverage: ~60-65%</li> </ul> </li> </ul>"},{"location":"development/testing/#background-services","title":"Background Services","text":"<ul> <li> <p><code>internal/indexer</code> (31 tests + 5 benchmarks) - Media indexing</p> <ul> <li>Configuration validation</li> <li>Parallel directory walking</li> <li>Progress tracking and statistics</li> <li>Incremental indexing</li> <li>Error handling</li> </ul> </li> <li> <p><code>internal/metrics</code> - Prometheus metrics</p> <ul> <li>HTTP request metrics</li> <li>Database operation metrics</li> <li>Indexer and thumbnail metrics</li> </ul> </li> </ul>"},{"location":"development/testing/#media-processing","title":"Media Processing","text":"<ul> <li> <p><code>internal/streaming</code> - Stream handling</p> <ul> <li>Timeout-protected writers</li> <li>Backpressure management</li> </ul> </li> <li> <p><code>internal/transcoder</code> - Video transcoding</p> <ul> <li>Configuration validation</li> <li>Codec detection</li> <li>Cache management</li> </ul> </li> </ul>"},{"location":"development/testing/#features","title":"Features","text":"<ul> <li><code>internal/playlist</code> - Playlist support<ul> <li>Windows Playlist (WPL) parsing</li> <li>Path resolution</li> </ul> </li> </ul> <p>Total: 190+ tests across all packages</p>"},{"location":"development/testing/#writing-tests","title":"Writing Tests","text":""},{"location":"development/testing/#test-structure","title":"Test Structure","text":"<p>Use table-driven tests for multiple scenarios:</p> <pre><code>func TestFeature(t *testing.T) {\n    t.Parallel() // Enable parallel execution\n\n    tests := []struct {\n        name     string\n        input    string\n        expected string\n        wantErr  bool\n    }{\n        {\n            name:     \"valid input\",\n            input:    \"test\",\n            expected: \"test\",\n            wantErr:  false,\n        },\n        {\n            name:     \"empty input\",\n            input:    \"\",\n            expected: \"\",\n            wantErr:  true,\n        },\n        // More test cases...\n    }\n\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            t.Parallel() // Enable parallel subtests\n\n            got, err := Feature(tt.input)\n            if (err != nil) != tt.wantErr {\n                t.Errorf(\"Feature() error = %v, wantErr %v\", err, tt.wantErr)\n                return\n            }\n            if got != tt.expected {\n                t.Errorf(\"Feature() = %v, want %v\", got, tt.expected)\n            }\n        })\n    }\n}\n</code></pre>"},{"location":"development/testing/#best-practices","title":"Best Practices","text":"<ol> <li> <p>Clear Test Names</p> <ul> <li>Use descriptive names with <code>Test</code> prefix</li> <li>Name subtests to describe the scenario being tested</li> </ul> </li> <li> <p>Table-Driven Tests</p> <ul> <li>Group related test cases</li> <li>Reduce code duplication</li> <li>Make adding new cases easy</li> </ul> </li> <li> <p>Test Coverage</p> <ul> <li>Test happy paths (success cases)</li> <li>Test edge cases (boundaries, limits)</li> <li>Test error conditions</li> <li>Test concurrent access where applicable</li> </ul> </li> <li> <p>Test Independence</p> <ul> <li>Each test should be independent</li> <li>Use <code>t.Parallel()</code> for concurrent execution</li> <li>Clean up resources with <code>t.Cleanup()</code></li> </ul> </li> <li> <p>Use Test Helpers</p> <ul> <li>Extract common setup into helper functions</li> <li>Create mock implementations for dependencies</li> <li>Use interfaces to enable testing</li> </ul> </li> <li> <p>Document Intent</p> <ul> <li>Add comments for complex test logic</li> <li>Explain why a test exists, not just what it does</li> </ul> </li> </ol>"},{"location":"development/testing/#http-handler-testing","title":"HTTP Handler Testing","text":"<p>Example of testing HTTP handlers with mocks:</p> <pre><code>func TestHandler(t *testing.T) {\n    t.Parallel()\n\n    // Create mock dependencies\n    mockDB := &amp;mockDatabase{\n        getUserFunc: func(id int64) (*User, error) {\n            return &amp;User{ID: id, Name: \"test\"}, nil\n        },\n    }\n\n    h := &amp;Handlers{db: mockDB}\n\n    // Create test request\n    req := httptest.NewRequest(http.MethodGet, \"/api/user/1\", nil)\n    w := httptest.NewRecorder()\n\n    // Call handler\n    h.GetUser(w, req)\n\n    // Assert response\n    if w.Code != http.StatusOK {\n        t.Errorf(\"status = %d, want %d\", w.Code, http.StatusOK)\n    }\n\n    // Parse and validate JSON response\n    var resp map[string]interface{}\n    if err := json.NewDecoder(w.Body).Decode(&amp;resp); err != nil {\n        t.Fatalf(\"failed to decode response: %v\", err)\n    }\n\n    if resp[\"name\"] != \"test\" {\n        t.Errorf(\"name = %v, want %v\", resp[\"name\"], \"test\")\n    }\n}\n</code></pre>"},{"location":"development/testing/#integration-testing","title":"Integration Testing","text":"<p>Integration tests interact with real components (database, filesystem):</p> <pre><code>func TestDatabaseIntegration(t *testing.T) {\n    // Skip in short mode\n    if testing.Short() {\n        t.Skip(\"skipping integration test in short mode\")\n    }\n\n    // Create temporary database\n    db, cleanup := setupTestDB(t)\n    defer cleanup()\n\n    // Run test operations\n    err := db.UpsertFile(context.Background(), &amp;File{\n        Path: \"/test.jpg\",\n        Type: \"image\",\n    })\n    if err != nil {\n        t.Fatalf(\"UpsertFile() error = %v\", err)\n    }\n\n    // Verify results\n    file, err := db.GetFileByPath(context.Background(), \"/test.jpg\")\n    if err != nil {\n        t.Fatalf(\"GetFileByPath() error = %v\", err)\n    }\n    if file.Type != \"image\" {\n        t.Errorf(\"Type = %v, want %v\", file.Type, \"image\")\n    }\n}\n</code></pre>"},{"location":"development/testing/#frontend-testing-patterns","title":"Frontend Testing Patterns","text":""},{"location":"development/testing/#unit-test-pattern-jsdom-with-eval","title":"Unit Test Pattern (JSDOM with eval)","text":"<p>Frontend unit tests use JSDOM for DOM simulation and load modules via <code>eval()</code>:</p> <pre><code>import { describe, test, expect, beforeEach, vi } from 'vitest';\nimport fs from 'fs';\nimport { JSDOM } from 'jsdom';\n\ndescribe('Module Name', () =&gt; {\n    let dom, ModuleName;\n\n    beforeEach(() =&gt; {\n        // Create DOM environment\n        dom = new JSDOM(`&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;`, {\n            url: 'http://localhost',\n            pretendToBeVisual: true,\n        });\n\n        globalThis.document = dom.window.document;\n        globalThis.window = dom.window;\n\n        // Mock dependencies\n        globalThis.lucide = { createIcons: vi.fn() };\n        globalThis.MediaApp = { showLoading: vi.fn() };\n\n        // Load module\n        const code = fs.readFileSync('./static/js/module.js', 'utf-8');\n        eval(code);\n        ModuleName = globalThis.ModuleName;\n    });\n\n    test('tests pure logic', () =&gt; {\n        const result = ModuleName.formatName('/path/file.txt');\n        expect(result).toBe('file');\n    });\n});\n</code></pre>"},{"location":"development/testing/#key-testing-principles","title":"Key Testing Principles","text":"<ol> <li> <p>Test Pure Functions First</p> <ul> <li>Utility functions (formatTime, escapeHtml, getDisplayName)</li> <li>State calculations (navigation indices, URL parsing)</li> <li>Data transformations (tag rendering, name extraction)</li> </ul> </li> <li> <p>Mock External Dependencies</p> <ul> <li><code>lucide.createIcons()</code> - Icon library</li> <li><code>MediaApp</code>, <code>Gallery</code>, <code>Search</code> - Global modules</li> <li><code>fetch</code> and API calls - Use <code>vi.fn()</code> mocks</li> <li>localStorage - Implement mock object</li> </ul> </li> <li> <p>Avoid Heavy DOM Manipulation</p> <ul> <li>Focus on testable logic over rendering</li> <li>Test state changes rather than visual output</li> <li>Use simple assertions on DOM properties when needed</li> </ul> </li> <li> <p>Clean Up State</p> <ul> <li>Reset module state in <code>beforeEach</code></li> <li>Clear timers in <code>afterEach</code></li> <li>Use <code>vi.clearAllMocks()</code> for Vitest spies</li> </ul> </li> <li> <p>Test Edge Cases</p> <ul> <li>Null/undefined inputs</li> <li>Empty strings and arrays</li> <li>Boundary conditions (wraparound indices)</li> <li>Error handling paths</li> </ul> </li> </ol>"},{"location":"development/testing/#integration-test-pattern","title":"Integration Test Pattern","text":"<p>Integration tests call real backend APIs with proper authentication:</p> <pre><code>import { describe, test, expect, beforeAll } from 'vitest';\nimport { ensureAuthenticated, listFiles } from '../helpers/api-helpers.js';\n\ndescribe('API Integration', () =&gt; {\n    beforeAll(async () =&gt; {\n        await ensureAuthenticated();\n    });\n\n    test('fetches data from backend', async () =&gt; {\n        const files = await listFiles('/');\n        expect(files).toBeInstanceOf(Array);\n    });\n});\n</code></pre>"},{"location":"development/testing/#benchmarking","title":"Benchmarking","text":"<p>Write benchmarks for performance-critical code:</p> <pre><code>func BenchmarkOperation(b *testing.B) {\n    // Setup\n    data := prepareTestData()\n\n    // Reset timer after setup\n    b.ResetTimer()\n\n    // Run operation b.N times\n    for i := 0; i &lt; b.N; i++ {\n        Operation(data)\n    }\n}\n</code></pre>"},{"location":"development/testing/#continuous-integration","title":"Continuous Integration","text":"<p>Tests run automatically via GitHub Actions on every push to <code>main</code> and on all pull requests.</p>"},{"location":"development/testing/#ci-workflow","title":"CI Workflow","text":"<p>The CI pipeline (<code>.github/workflows/ci.yml</code>) includes:</p>"},{"location":"development/testing/#1-change-detection","title":"1. Change Detection","text":"<ul> <li>Detects which files changed (Go code, Docker files)</li> <li>Identifies affected Go packages for optimized testing</li> <li>Skips unnecessary jobs when possible</li> </ul>"},{"location":"development/testing/#2-linting-lint","title":"2. Linting (<code>lint</code>)","text":"<ul> <li>Runs <code>golangci-lint</code> with comprehensive checks</li> <li>Installs libvips for dependency requirements</li> <li>Must pass before PR can be merged</li> <li>Required on all PRs</li> </ul>"},{"location":"development/testing/#3-unit-tests-test-unit","title":"3. Unit Tests (<code>test-unit</code>)","text":"<ul> <li>Runs fast unit tests with <code>make test-unit</code></li> <li>Excludes integration tests (uses <code>-short</code> flag)</li> <li>Generates coverage reports</li> <li>Uploads test results as artifacts</li> <li>Required on all PRs</li> </ul>"},{"location":"development/testing/#4-integration-tests-test-integration","title":"4. Integration Tests (<code>test-integration</code>)","text":"<ul> <li>Runs slower integration tests with real dependencies</li> <li>Installs libvips and ffmpeg</li> <li>Runs automatically on <code>main</code> branch</li> <li>On PRs: only runs when labeled with <code>test:integration</code></li> <li>Optional on PRs (add label to run)</li> </ul>"},{"location":"development/testing/#5-race-detector-test-race","title":"5. Race Detector (<code>test-race</code>)","text":"<ul> <li>Runs tests with <code>-race</code> flag to detect data races</li> <li>Runs automatically on <code>main</code> branch</li> <li>On PRs: only runs when labeled with <code>test:race</code></li> <li>Optional on PRs (add label to run)</li> </ul>"},{"location":"development/testing/#6-docker-build-build-docker","title":"6. Docker Build (<code>build-docker</code>)","text":"<ul> <li>Builds Docker image to verify it compiles</li> <li>Only runs if tests pass</li> <li>Uses BuildKit caching for speed</li> </ul>"},{"location":"development/testing/#pull-request-labels","title":"Pull Request Labels","text":"<p>Control which tests run on your PR:</p> <ul> <li><code>test:integration</code> - Run integration tests (normally skipped on PRs)</li> <li><code>test:race</code> - Run race detector (normally skipped on PRs)</li> </ul>"},{"location":"development/testing/#ci-requirements","title":"CI Requirements","text":"<p>For a PR to be mergeable:</p> <ol> <li>\u2705 Linting must pass</li> <li>\u2705 Unit tests must pass</li> <li>\u2705 Docker build must succeed</li> <li>\u26a0\ufe0f Integration tests optional (unless labeled)</li> <li>\u26a0\ufe0f Race detector optional (unless labeled)</li> </ol> <p>On the <code>main</code> branch, all tests including integration and race detection run automatically.</p>"},{"location":"development/testing/#viewing-ci-results","title":"Viewing CI Results","text":"<ol> <li>On Pull Requests: Check the \"Checks\" tab</li> <li>Test Artifacts: Download from the workflow run<ul> <li><code>unit-test-results</code> - Coverage and JSON output</li> <li><code>integration-test-results</code> - Integration coverage</li> </ul> </li> <li>Coverage Reports: View coverage percentages in workflow logs</li> </ol>"},{"location":"development/testing/#local-testing-before-push","title":"Local Testing Before Push","text":"<p>Run the same checks locally:</p> <pre><code># Run linting\nmake lint\n\n# Run unit tests (what CI runs by default)\nmake test-unit\n\n# Run integration tests (if you added the label)\nmake test-integration\n\n# Run race detector (if you added the label)\nmake test-race\n\n# Run everything\nmake test-all\n</code></pre>"},{"location":"development/testing/#build-tags","title":"Build Tags","text":"<p>Tests use the same build tags as the main application:</p> <ul> <li><code>fts5</code> - SQLite FTS5 full-text search support</li> </ul>"},{"location":"development/testing/#coverage-goals","title":"Coverage Goals","text":"<ul> <li>Backend: ~40-65% (varies by package), target &gt;80%</li> <li>Frontend: ~80% of modules covered (as of February 2026)</li> </ul>"},{"location":"development/testing/#recent-improvements","title":"Recent Improvements","text":"<p>February 2026:</p> <ul> <li>Added comprehensive integration tests for database package, increasing backend coverage from ~5% to ~40%</li> <li>Added 14 frontend unit test files covering core features, media components, and UI utilities</li> <li>Total frontend test count increased to 547+ tests across 19 test files</li> <li>Frontend coverage improved from ~25% to ~80% of modules</li> </ul>"},{"location":"development/testing/#common-issues","title":"Common Issues","text":""},{"location":"development/testing/#race-conditions","title":"Race Conditions","text":"<p>If <code>make test-race</code> reports data races:</p> <ol> <li>Identify the shared resource</li> <li>Add proper synchronization (mutex, channel)</li> <li>Verify with <code>make test-race</code> again</li> </ol>"},{"location":"development/testing/#flaky-tests","title":"Flaky Tests","text":"<p>If tests fail intermittently:</p> <ol> <li>Check for timing dependencies</li> <li>Look for shared global state</li> <li>Verify cleanup in <code>t.Cleanup()</code></li> <li>Use <code>t.Parallel()</code> carefully with shared resources</li> </ol>"},{"location":"development/testing/#slow-tests","title":"Slow Tests","text":"<p>If tests take too long:</p> <ol> <li>Use <code>testing.Short()</code> to skip in short mode</li> <li>Reduce test data size</li> <li>Use parallel execution with <code>t.Parallel()</code></li> <li>Consider if integration test should be unit test</li> </ol>"},{"location":"development/testing/#package-specific-testing","title":"Package-Specific Testing","text":""},{"location":"development/testing/#transcoder-package","title":"Transcoder Package","text":"<p>The transcoder package requires special handling due to external dependencies (ffmpeg/ffprobe).</p>"},{"location":"development/testing/#test-organization_1","title":"Test Organization","text":"<p>Unit Tests (<code>transcoder_test.go</code>):</p> <ul> <li>Test parsing logic and configuration</li> <li>Use mock ffmpeg/ffprobe bash scripts</li> <li>No external dependencies required</li> <li>Complete in &lt; 100ms per test</li> <li>Use <code>t.Parallel()</code> for concurrency</li> </ul> <p>Integration Tests (<code>transcoder_coverage_test.go</code>):</p> <ul> <li>Test real ffmpeg/ffprobe interaction</li> <li>Require ffmpeg installed on system</li> <li>Use <code>checkFFmpegAvailable(t)</code> helper (skips if not available or in short mode)</li> <li>Use test video file from <code>/testdata/test.mp4</code></li> <li>Include <code>Integration</code> suffix in function name</li> </ul>"},{"location":"development/testing/#running-transcoder-tests","title":"Running Transcoder Tests","text":"<pre><code># Unit tests only (no ffmpeg required)\ngo test -short ./internal/transcoder\n\n# All tests (requires ffmpeg)\ngo test ./internal/transcoder\n\n# Specific test\nmake test-package PKG=transcoder TESTARGS=\"-run=TestGetVideoInfoIntegration_RealVideo\"\n\n# With coverage\nmake test-coverage PKG=transcoder\n\n# Benchmarks\ngo test -short -bench=. ./internal/transcoder  # Unit only\ngo test -bench=. ./internal/transcoder          # All benchmarks\n</code></pre>"},{"location":"development/testing/#test-data-files","title":"Test Data Files","text":"<p>Test Video (<code>/testdata/test.mp4</code>):</p> <ul> <li>Generated by <code>/testdata/generate.sh</code></li> <li>Properties: 1 second duration, 320\u00d7240 resolution, ~3KB, h264 codec</li> <li>Purpose: Minimal real video for testing ffmpeg/ffprobe integration</li> <li>See <code>/testdata/README.md</code> for details</li> </ul> <p>Mock Implementations: Unit tests create temporary bash scripts that simulate ffmpeg/ffprobe behavior:</p> <ul> <li>Return predefined JSON output for testing parsing logic</li> <li>Temporary scripts created in <code>t.TempDir()</code> and auto-cleaned</li> <li>PATH temporarily modified to use mocks</li> </ul>"},{"location":"development/testing/#writing-transcoder-tests","title":"Writing Transcoder Tests","text":"<p>Unit Test Pattern (mock ffprobe):</p> <pre><code>func TestGetVideoInfo_ParsesFFProbeOutput(t *testing.T) {\n    t.Parallel()\n\n    tmpDir := t.TempDir()\n    mockFFProbe := filepath.Join(tmpDir, \"ffprobe\")\n\n    ffprobeScript := `#!/bin/bash\ncat &lt;&lt; 'EOF'\n{\"streams\":[{\"codec_name\":\"h264\",\"width\":1920,\"height\":1080}],\"format\":{\"duration\":\"125.5\"}}\nEOF\n`\n\n    if err := os.WriteFile(mockFFProbe, []byte(ffprobeScript), 0755); err != nil {\n        t.Fatalf(\"Failed to create mock ffprobe: %v\", err)\n    }\n\n    oldPath := os.Getenv(\"PATH\")\n    defer func() { _ = os.Setenv(\"PATH\", oldPath) }()\n    _ = os.Setenv(\"PATH\", tmpDir+\":\"+oldPath)\n\n    // Test code here...\n}\n</code></pre> <p>Integration Test Pattern (real ffmpeg):</p> <pre><code>func TestStreamVideoIntegration_WithResize(t *testing.T) {\n    checkFFmpegAvailable(t)  // Skips if ffmpeg not available or in short mode\n    testVideo := getTestVideoPath(t)\n\n    tmpDir := t.TempDir()\n    trans := New(tmpDir, true)\n    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)\n    defer cancel()\n\n    var buf bytes.Buffer\n    err := trans.StreamVideo(ctx, testVideo, &amp;buf, 320)\n    if err != nil {\n        t.Fatalf(\"StreamVideo() error: %v\", err)\n    }\n\n    if buf.Len() == 0 {\n        t.Error(\"Expected video data\")\n    }\n}\n</code></pre> <p>Guidelines for New Transcoder Tests:</p> <p>Unit Tests:</p> <ul> <li>Use table-driven test structure</li> <li>Create mock ffprobe/ffmpeg scripts in <code>t.TempDir()</code></li> <li>No <code>Integration</code> suffix in function name</li> <li>Should complete in &lt; 100ms</li> <li>Use <code>t.Parallel()</code> for concurrent execution</li> <li>Add to <code>transcoder_test.go</code> or <code>transcoder_coverage_test.go</code></li> </ul> <p>Integration Tests:</p> <ul> <li>Add <code>Integration</code> suffix to function name</li> <li>Call <code>checkFFmpegAvailable(t)</code> at the start</li> <li>Use <code>getTestVideoPath(t)</code> to get test video file path</li> <li>Use <code>context.WithTimeout()</code> with reasonable timeout (e.g., 30 seconds)</li> <li>Handle cleanup with <code>defer</code> or <code>t.Cleanup()</code></li> <li>Add to <code>transcoder_coverage_test.go</code></li> </ul>"},{"location":"development/testing/#transcoder-ci-integration","title":"Transcoder CI Integration","text":"<p>Pull Requests:</p> <ul> <li>\u2705 Unit tests run automatically (<code>test-unit</code> job)</li> <li>\u26a0\ufe0f Integration tests only run with <code>test:integration</code> label</li> <li>FFmpeg is not installed by default</li> </ul> <p>Main Branch:</p> <ul> <li>\u2705 Unit tests run automatically</li> <li>\u2705 Integration tests run automatically</li> <li>FFmpeg is installed in the <code>test-integration</code> job</li> </ul> <p>To run integration tests on your PR, add the <code>test:integration</code> label.</p>"},{"location":"development/testing/#troubleshooting-transcoder-tests","title":"Troubleshooting Transcoder Tests","text":"<p>FFmpeg Not Found:</p> <pre><code># Ubuntu/Debian\nsudo apt-get update\nsudo apt-get install -y ffmpeg\n\n# macOS\nbrew install ffmpeg\n\n# Verify installation\nwhich ffmpeg ffprobe\nffmpeg -version\n</code></pre> <p>Test Video Not Found:</p> <pre><code># Verify test files exist\nls -lh testdata/\n\n# Regenerate if missing\ncd testdata\n./generate.sh\n</code></pre> <p>Tests Timing Out:</p> <ul> <li>Integration tests use 30-second context timeouts</li> <li>If tests timeout on slower systems, increase timeout in the test</li> <li>Check if ffmpeg is actually hanging: <code>ffmpeg -version</code></li> </ul> <p>Mock Script Failures:</p> <ul> <li>Permission denied: Ensure mock scripts have execute permissions (0755)</li> <li>Command not found: Verify PATH modification is working</li> <li>Bash not available: Ensure <code>/bin/bash</code> exists on your system</li> </ul>"},{"location":"development/testing/#performance-expectations","title":"Performance Expectations","text":"<p>Unit Tests:</p> <ul> <li>Constructor/getter tests: &lt; 1ms per test</li> <li>Mock ffprobe parsing: &lt; 50ms per test</li> <li>File operations: &lt; 10ms per test</li> <li>Full unit test suite: &lt; 1 second</li> </ul> <p>Integration Tests:</p> <ul> <li><code>GetVideoInfo</code>: 100-500ms per test</li> <li><code>StreamVideo</code> (direct): 200-1000ms per test</li> <li><code>StreamVideo</code> (transcode): 1-5 seconds per test</li> <li>Full integration suite: 10-30 seconds</li> </ul> <p>Times vary based on system performance and video complexity.</p>"},{"location":"development/testing/#coverage-status","title":"Coverage Status","text":"<ul> <li>Current coverage: ~90%</li> <li>Target: &gt;80% (project-wide goal)</li> <li>Test count: 46 tests (37 unit + 9 integration) + 5 benchmarks</li> </ul>"},{"location":"development/testing/#see-also","title":"See Also","text":"<ul> <li>Profiling Guide - CPU, memory, and database profiling</li> <li>Monitoring Stack - Performance testing and metrics monitoring</li> <li>Architecture - System architecture overview</li> <li>Memory &amp; GC Tuning - Performance optimization guide</li> <li>Frontend Testing README - Detailed frontend test documentation</li> </ul>"},{"location":"development/testing/#resources","title":"Resources","text":""},{"location":"development/testing/#backend-testing-go","title":"Backend Testing (Go)","text":"<ul> <li>Go Testing Package</li> <li>Go Blog: Table Driven Tests</li> <li>Effective Go: Testing</li> </ul>"},{"location":"development/testing/#frontend-testing-javascript","title":"Frontend Testing (JavaScript)","text":"<ul> <li>Vitest Documentation - Unit and integration test framework</li> <li>Playwright Documentation - E2E browser testing</li> <li>Testing Library - DOM testing utilities</li> <li>Happy DOM - Fast DOM implementation for Node.js</li> </ul>"},{"location":"features/pwa/","title":"Progressive Web App","text":"<p>Media Viewer can be installed as a Progressive Web App (PWA) on supported devices, providing a native app-like experience.</p>"},{"location":"features/pwa/#benefits","title":"Benefits","text":"<p>Installing Media Viewer as a PWA provides:</p> <ul> <li>Full-screen experience: No browser chrome or address bar</li> <li>Home screen icon: Launch directly from your device</li> <li>Faster loading: Cached resources load quickly</li> <li>Offline thumbnails: Previously viewed thumbnails remain available</li> </ul>"},{"location":"features/pwa/#installation","title":"Installation","text":""},{"location":"features/pwa/#ios-safari","title":"iOS (Safari)","text":"<ol> <li>Open Media Viewer in Safari</li> <li>Tap the Share button (square with arrow)</li> <li>Scroll down and tap Add to Home Screen</li> <li>Optionally edit the name</li> <li>Tap Add</li> </ol>"},{"location":"features/pwa/#android-chrome","title":"Android (Chrome)","text":"<ol> <li>Open Media Viewer in Chrome</li> <li>Tap the menu button (three dots)</li> <li>Tap Add to Home Screen or Install App</li> <li>Confirm the installation</li> </ol>"},{"location":"features/pwa/#desktop-chromeedge","title":"Desktop (Chrome/Edge)","text":"<ol> <li>Open Media Viewer in Chrome or Edge</li> <li>Click the install icon in the address bar (or menu)</li> <li>Click Install</li> </ol>"},{"location":"features/pwa/#using-the-pwa","title":"Using the PWA","text":""},{"location":"features/pwa/#launching","title":"Launching","text":"<p>Tap the Media Viewer icon on your home screen or app drawer. The app opens in full-screen mode without browser controls.</p>"},{"location":"features/pwa/#navigation","title":"Navigation","text":"<ul> <li>Use in-app navigation (breadcrumbs, back gestures)</li> <li>The browser back button is not available in PWA mode</li> <li>Press ++escape++ to navigate up or close overlays</li> </ul>"},{"location":"features/pwa/#session-management","title":"Session Management","text":"<p>The PWA maintains your session like the browser version:</p> <ul> <li>Sessions expire based on server configuration</li> <li>You'll need to log in again after session expiration</li> <li>Active use keeps the session alive</li> </ul>"},{"location":"features/pwa/#limitations","title":"Limitations","text":""},{"location":"features/pwa/#no-browser-controls","title":"No Browser Controls","text":"<p>In PWA mode, you don't have access to:</p> <ul> <li>Browser back/forward buttons (use in-app navigation)</li> <li>Address bar (use search instead)</li> <li>Browser bookmarks (use favorites instead)</li> </ul>"},{"location":"features/pwa/#offline-access","title":"Offline Access","text":"<p>The PWA caches:</p> <ul> <li>Application code and styles</li> <li>Previously viewed thumbnails</li> </ul> <p>The PWA does not cache:</p> <ul> <li>Full-resolution images and videos</li> <li>New content not yet viewed</li> </ul> <p>An internet connection is required to:</p> <ul> <li>Log in</li> <li>Browse new content</li> <li>View full-resolution media</li> <li>Make changes (tags, favorites)</li> </ul>"},{"location":"features/pwa/#troubleshooting","title":"Troubleshooting","text":""},{"location":"features/pwa/#pwa-not-installing","title":"PWA Not Installing","text":"<ul> <li>Ensure you're using HTTPS (required for PWA)</li> <li>Try clearing browser cache</li> <li>Check that the browser supports PWA installation</li> </ul>"},{"location":"features/pwa/#session-issues","title":"Session Issues","text":"<p>If you're frequently logged out:</p> <ul> <li>Check your network connection</li> <li>The server may have a short session duration</li> <li>Contact your administrator to adjust <code>SESSION_DURATION</code></li> </ul>"},{"location":"features/pwa/#clearing-pwa-data","title":"Clearing PWA Data","text":"<p>To reset the PWA:</p> <ol> <li>Uninstall the PWA from your device</li> <li>Clear browser data for the Media Viewer site</li> <li>Reinstall the PWA</li> </ol>"},{"location":"features/selection-mode/","title":"Selection Mode","text":"<p>Selection mode allows you to perform bulk operations on multiple items at once, including tagging, favoriting, and tag copy/paste operations.</p>"},{"location":"features/selection-mode/#entering-selection-mode","title":"Entering Selection Mode","text":""},{"location":"features/selection-mode/#desktop","title":"Desktop","text":"<p>Click the checkbox area at the bottom of any gallery item. The checkbox area shows \"Select\" text on hover.</p>"},{"location":"features/selection-mode/#mobile","title":"Mobile","text":"<p>Long-press (touch and hold) any item for about half a second. A brief vibration confirms entry into selection mode.</p>"},{"location":"features/selection-mode/#selection-interface","title":"Selection Interface","text":"<p>When selection mode is active:</p> <ul> <li>A toolbar appears at the bottom of the screen</li> <li>Selected items show a checkmark overlay</li> <li>Unselected items appear slightly dimmed</li> <li>The selection count is displayed in the toolbar</li> </ul>"},{"location":"features/selection-mode/#selecting-items","title":"Selecting Items","text":""},{"location":"features/selection-mode/#individual-selection","title":"Individual Selection","text":"<ul> <li>Click/tap any item to toggle its selection</li> <li>Click the checkbox on desktop to toggle selection</li> </ul>"},{"location":"features/selection-mode/#select-all","title":"Select All","text":"<p>Click the All button in the toolbar or press ++ctrl+a++ to select all items in the current view.</p> <p>If all items are already selected, this action deselects all items.</p>"},{"location":"features/selection-mode/#drag-selection-mobile","title":"Drag Selection (Mobile)","text":"<p>After entering selection mode via long-press, you can drag to select multiple items at once:</p> <ol> <li>Keep your finger on the screen after the long-press</li> <li>Drag across other items</li> <li>All items between your starting point and current position are selected (in reading order)</li> </ol> <p>How it works:</p> <ul> <li>Gallery scrolling is frozen during drag to prevent accidental movement</li> <li>Items are selected in the natural flow/reading order (left-to-right, top-to-bottom)</li> <li>Dragging from the last item in a row down several rows selects all items in between</li> <li>Works naturally whether dragging forward or backward</li> <li>Release your finger to finish the drag selection</li> </ul> <p>For example, starting on the last item of Row 1 and dragging to the last item of Row 3 will select that first item plus all items in Rows 2 and 3 up to your ending point.</p>"},{"location":"features/selection-mode/#available-actions","title":"Available Actions","text":"<p>The selection toolbar provides these actions:</p>"},{"location":"features/selection-mode/#copy-tags","title":"Copy Tags","text":"<p>Available when exactly 1 item is selected</p> <p>Copies all tags from the selected item to a clipboard for pasting to other items.</p> <ul> <li>Click Copy Tags or press ++ctrl+c++</li> <li>A confirmation message shows how many tags were copied</li> </ul>"},{"location":"features/selection-mode/#paste-tags","title":"Paste Tags","text":"<p>Available when items are selected and tags have been copied</p> <p>Pastes previously copied tags to selected items.</p> <ul> <li>Click Paste Tags or press ++ctrl+v++</li> <li>A modal appears showing tags to paste</li> <li>Select/deselect individual tags as needed</li> <li>Click Paste Tags to apply</li> </ul> <p>The source item (where tags were copied from) is automatically excluded from paste destinations.</p>"},{"location":"features/selection-mode/#merge-tags","title":"Merge Tags","text":"<p>Available when 2 or more items are selected</p> <p>Collects all unique tags from selected items and applies them to all selected items.</p> <ul> <li>Click Merge Tags or press ++ctrl+m++</li> <li>A modal shows all tags found across selected items</li> <li>Tags not present on all items show a count (e.g., \"2/3\")</li> <li>Select tags to apply and click Merge Tags</li> </ul>"},{"location":"features/selection-mode/#tag","title":"Tag","text":"<p>Opens the bulk tag modal to add or remove tags from all selected items.</p> <ul> <li>Click Tag or press ++t++</li> <li>Add new tags or remove existing ones</li> <li>Changes apply to all selected items</li> </ul>"},{"location":"features/selection-mode/#favorite","title":"Favorite","text":"<p>Adds all selected items to favorites.</p> <ul> <li>Click Favorite or press ++f++</li> <li>Items already in favorites are skipped</li> <li>A confirmation shows how many items were added</li> </ul>"},{"location":"features/selection-mode/#exiting-selection-mode","title":"Exiting Selection Mode","text":"<ul> <li>Click the X button in the selection toolbar</li> <li>Press ++escape++</li> <li>Complete an action (tagging, favoriting, pasting)</li> </ul>"},{"location":"features/selection-mode/#selection-mode-tips","title":"Selection Mode Tips","text":""},{"location":"features/selection-mode/#efficient-bulk-tagging","title":"Efficient Bulk Tagging","text":"<ol> <li>Enter selection mode</li> <li>Select items that should share a tag</li> <li>Click Tag and add the common tag</li> <li>Selection mode exits automatically</li> </ol>"},{"location":"features/selection-mode/#copying-tags-between-items","title":"Copying Tags Between Items","text":"<ol> <li>Select the source item (with tags you want to copy)</li> <li>Press ++ctrl+c++ to copy its tags</li> <li>Select destination items</li> <li>Press ++ctrl+v++ to paste</li> <li>Confirm which tags to apply</li> </ol>"},{"location":"features/selection-mode/#merging-tags-across-items","title":"Merging Tags Across Items","text":"<p>Use merge when you have related items with different tags and want them all to share the same tags:</p> <ol> <li>Select all related items</li> <li>Press ++ctrl+m++</li> <li>Review and confirm the merged tag set</li> <li>All items now have all the tags</li> </ol>"},{"location":"features/selection-mode/#mobile-workflow","title":"Mobile Workflow","text":"<p>On mobile, selection mode is optimized for touch:</p> <ol> <li>Long-press to enter selection mode</li> <li>Tap items to select/deselect</li> <li>Drag to select multiple items in a range (gallery freezes during drag to prevent scrolling)</li> <li>Use toolbar buttons for actions</li> </ol>"},{"location":"features/tag-management/","title":"Tag Management","text":"<p>This page covers advanced tag management features and workflows. For tag-based search features, see the Search documentation.</p>"},{"location":"features/tag-management/#tag-display","title":"Tag Display","text":""},{"location":"features/tag-management/#gallery-items-desktop","title":"Gallery Items (Desktop)","text":"<p>On desktop, tags appear below each gallery item in \"X | tag\" format:</p> <ul> <li>The X on the left removes the tag when clicked</li> <li>The tag name on the right searches for that tag when clicked</li> <li>Up to 3 tags are shown</li> <li>Additional tags show as \"+N\" indicator</li> </ul>"},{"location":"features/tag-management/#gallery-items-mobile","title":"Gallery Items (Mobile)","text":"<p>On mobile, tags appear as simple chips overlaid on the thumbnail:</p> <ul> <li>Tap a tag to search for it</li> <li>Tap \"+N\" to see all tags</li> </ul>"},{"location":"features/tag-management/#tag-overflow-tooltip","title":"Tag Overflow Tooltip","text":"<p>When an item has more than 3 tags:</p> <ol> <li>Click the \"+N\" indicator</li> <li>A tooltip shows all tags</li> <li>Each tag has the same \"X | tag\" format</li> <li>Click X to remove, click tag name to search</li> <li>Click outside to close</li> </ol>"},{"location":"features/tag-management/#tag-operations","title":"Tag Operations","text":""},{"location":"features/tag-management/#adding-tags","title":"Adding Tags","text":"<p>Tags can be added from:</p> <ul> <li>Tag modal (via tag button on item)</li> <li>Lightbox (via tag button)</li> <li>Selection mode (bulk tagging)</li> </ul>"},{"location":"features/tag-management/#removing-tags","title":"Removing Tags","text":"<p>Tags can be removed from:</p> <ul> <li>Tag modal (click X on tag chip)</li> <li>Gallery item (click X on tag, desktop only)</li> <li>Tag overflow tooltip (click X on tag)</li> <li>Lightbox tag display (click X on tag)</li> </ul>"},{"location":"features/tag-management/#tag-manager-settings","title":"Tag Manager (Settings)","text":"<p>The Tag Manager in Settings provides centralized management for your entire tag library.</p>"},{"location":"features/tag-management/#accessing-tag-manager","title":"Accessing Tag Manager","text":"<ol> <li>Click the Settings button (gear icon)</li> <li>Navigate to the Tags tab</li> <li>The Tag Manager shows all tags with statistics</li> </ol>"},{"location":"features/tag-management/#features","title":"Features","text":""},{"location":"features/tag-management/#view-all-tags","title":"View All Tags","text":"<ul> <li>Sortable table with tag name and usage count</li> <li>Color indicators show tag colors (if assigned)</li> <li>Real-time sorting by name (alphabetical) or count (usage)</li> <li>Click column headers to toggle sort direction</li> </ul>"},{"location":"features/tag-management/#search-tags","title":"Search Tags","text":"<ul> <li>Type in the search bar to filter tags by name</li> <li>Instant filtering as you type</li> <li>Case-insensitive matching</li> </ul>"},{"location":"features/tag-management/#filter-tags","title":"Filter Tags","text":"<ul> <li>Show Only Unused: Display only tags with zero file associations</li> <li>Show All Tags: Reset to view entire tag library</li> <li>Useful for finding orphaned tags to clean up</li> </ul>"},{"location":"features/tag-management/#rename-tags","title":"Rename Tags","text":"<p>Rename tags to fix typos, standardize naming, or merge similar tags:</p> <ol> <li>Click Rename button next to any tag</li> <li>Enter the new tag name in the modal</li> <li>View the affected file count</li> <li>Confirm to apply changes</li> </ol> <p>Rename Behavior:</p> <ul> <li>Updates all files using the old tag name</li> <li>If new name exists, tags are automatically merged</li> <li>Case-only changes supported (e.g., \"animal\" \u2192 \"Animal\")</li> <li>Transactional operation (all-or-nothing)</li> </ul> <p>Example Use Cases:</p> <ul> <li>Fix typos: \"vacaton\" \u2192 \"vacation\"</li> <li>Standardize: \"Beach\" \u2192 \"beach\"</li> <li>Merge duplicates: \"holidays\" \u2192 \"vacation\"</li> </ul>"},{"location":"features/tag-management/#delete-tags","title":"Delete Tags","text":"<p>Remove unwanted tags from your library:</p> <ol> <li>Click Delete button next to any tag</li> <li>Modal shows tag name and affected file count</li> <li>Confirm deletion</li> <li>Tag removed from all files and database</li> </ol> <p>Delete Behavior:</p> <ul> <li>Removes tag from all associated files</li> <li>Cascade deletion ensures data consistency</li> <li>Shows count of affected files</li> <li>Cannot be undone (permanent deletion)</li> </ul> <p>When to Delete:</p> <ul> <li>Experimental tags no longer needed</li> <li>One-off tags created by mistake</li> <li>Unused tags cluttering the library</li> </ul>"},{"location":"features/tag-management/#best-practices","title":"Best Practices","text":"<ul> <li>Regular cleanup: Use \"Show Only Unused\" to find orphaned tags monthly</li> <li>Naming standards: Establish conventions (lowercase, hyphens vs spaces)</li> <li>Merge duplicates: Consolidate similar tags using rename</li> <li>Bulk operations: Use Tag Manager for library-wide changes</li> <li>Backup before major changes: Especially when merging or deleting many tags</li> </ul>"},{"location":"features/tag-management/#searching-by-tag","title":"Searching by Tag","text":"<p>Click any tag anywhere in the interface to search for all items with that tag.</p>"},{"location":"features/tag-management/#tag-exclusion-in-search","title":"Tag Exclusion in Search","text":"<p>Search supports excluding tags from results to find items that don't have specific tags:</p> <p>Exclusion Syntax:</p> <ul> <li><code>-tag:tagname</code> - Exclude items with this tag</li> <li><code>NOT tag:tagname</code> - Alternative exclusion syntax</li> </ul> <p>Combining Filters:</p> <ul> <li><code>tag:vacation -tag:2023</code> - Items tagged \"vacation\" but not \"2023\"</li> <li><code>beach -tag:private</code> - Text search for \"beach\" excluding items tagged \"private\"</li> <li>Mix multiple inclusions and exclusions as needed</li> </ul> <p>Quick Exclusion:</p> <ul> <li>Hover over any tag in search results to see the exclude button (\u2212)</li> <li>Click the exclude button to add that tag as an exclusion to your current search</li> <li>Right-click or long-press any tag to access \"Search for\" or \"Exclude\" options</li> </ul> <p>Autocomplete:</p> <p>When typing <code>-</code> or <code>-tag:</code>, autocomplete suggestions show available tags to exclude.</p>"},{"location":"features/tag-management/#search-view-tag-behavior","title":"Search View Tag Behavior","text":"<p>When viewing search results, tag interactions are search-focused:</p> <ul> <li>Clicking a tag searches for that tag</li> <li>The exclude button (\u2212) adds exclusions to your search</li> <li>Tag modal shows search options rather than editing options</li> <li>This helps you refine your search without leaving the results view</li> </ul>"},{"location":"features/tag-management/#bulk-tag-operations","title":"Bulk Tag Operations","text":""},{"location":"features/tag-management/#adding-tags-to-multiple-items","title":"Adding Tags to Multiple Items","text":"<ol> <li>Enter selection mode</li> <li>Select target items</li> <li>Click Tag in the toolbar</li> <li>Add tags in the modal</li> <li>Tags are added to all selected items</li> </ol>"},{"location":"features/tag-management/#removing-tags-from-multiple-items","title":"Removing Tags from Multiple Items","text":"<ol> <li>Enter selection mode</li> <li>Select target items</li> <li>Click Tag in the toolbar</li> <li>In the modal, existing tags show which are common to all items</li> <li>Click X on a tag to remove it from all selected items</li> </ol>"},{"location":"features/tag-management/#copy-and-paste","title":"Copy and Paste","text":"<p>Copy tags from one item to others:</p> <ol> <li>Select source item</li> <li>Copy tags (++ctrl+c++)</li> <li>Select destination items</li> <li>Paste tags (++ctrl+v++)</li> <li>Confirm in modal</li> </ol>"},{"location":"features/tag-management/#merge","title":"Merge","text":"<p>Combine tags from multiple items:</p> <ol> <li>Select items to merge</li> <li>Merge tags (++ctrl+m++)</li> <li>All unique tags are collected</li> <li>Confirm which to apply</li> <li>All selected items receive all selected tags</li> </ol>"},{"location":"features/tag-management/#tag-suggestions","title":"Tag Suggestions","text":"<p>When adding tags, the system suggests existing tags:</p> <ul> <li>Suggestions appear as you type</li> <li>Shows tag name and item count</li> <li>Click to add the suggested tag</li> <li>Helps maintain consistent tag naming</li> </ul>"},{"location":"features/tag-management/#best-practices_1","title":"Best Practices","text":""},{"location":"features/tag-management/#naming-conventions","title":"Naming Conventions","text":"<ul> <li>Use lowercase for consistency</li> <li>Use hyphens for multi-word tags: <code>family-reunion</code></li> <li>Consider prefixes for categories: <code>location-beach</code>, <code>event-birthday</code></li> </ul>"},{"location":"features/tag-management/#hierarchical-organization","title":"Hierarchical Organization","text":"<p>Create logical groupings with prefixes:</p> <pre><code>location-beach\nlocation-mountain\nlocation-city\n\nevent-birthday\nevent-wedding\nevent-holiday\n\nyear-2024\nyear-2023\n</code></pre>"},{"location":"features/tag-management/#tag-cleanup","title":"Tag Cleanup","text":"<p>Periodically review your tags:</p> <ol> <li>Search for each tag to see its contents</li> <li>Remove tags from misclassified items</li> <li>Merge similar tags by:<ul> <li>Searching for the old tag</li> <li>Selecting all results</li> <li>Adding the new tag</li> <li>Removing the old tag</li> </ul> </li> </ol>"},{"location":"features/tag-management/#keyboard-shortcuts","title":"Keyboard Shortcuts","text":"Shortcut Context Action ++ctrl+c++ Tag modal open Copy common tags to clipboard ++ctrl+shift+c++ Tag modal open Copy all unique tags to clipboard ++ctrl+v++ Selection mode Paste tags to selected items ++slash++ Anywhere Focus search bar ++ctrl+k++ Anywhere Focus search bar ++tab++ Search with suggestions Autocomplete current suggestion"},{"location":"getting-started/configuration/","title":"Configuration","text":"<p>Media Viewer is configured through environment variables. This page documents all available options.</p>"},{"location":"getting-started/configuration/#core-settings","title":"Core Settings","text":""},{"location":"getting-started/configuration/#media_dir","title":"MEDIA_DIR","text":"<p>Path to your media directory inside the container. Defaults to <code>/media</code>.</p> <pre><code>MEDIA_DIR=/media\n</code></pre>"},{"location":"getting-started/configuration/#cache_dir","title":"CACHE_DIR","text":"<p>Path where thumbnails and transcoded videos are stored. Defaults to <code>/cache</code>.</p> <pre><code>CACHE_DIR=/cache\n</code></pre>"},{"location":"getting-started/configuration/#database_dir","title":"DATABASE_DIR","text":"<p>Path where the SQLite database is stored. Defaults to <code>/database</code>.</p> <pre><code>DATABASE_DIR=/database\n</code></pre>"},{"location":"getting-started/configuration/#transcoder_log_dir","title":"TRANSCODER_LOG_DIR","text":"<p>Path where transcoder logs are saved (optional). No default value.</p> <pre><code>TRANSCODER_LOG_DIR=/logs/transcoder\n</code></pre> <p>When configured, FFmpeg output logs for each transcode operation are saved to this directory with timestamped filenames. Useful for debugging video transcoding issues.</p> <p>If not set, transcoder logs are not saved to disk.</p>"},{"location":"getting-started/configuration/#port","title":"PORT","text":"<p>Port the application listens on. Defaults to <code>8080</code>.</p> <pre><code>PORT=8080\n</code></pre>"},{"location":"getting-started/configuration/#session-settings","title":"Session Settings","text":""},{"location":"getting-started/configuration/#session_duration","title":"SESSION_DURATION","text":"<p>Duration of user sessions. Uses Go duration format (e.g., <code>1h</code>, <code>30m</code>, <code>24h</code>).</p> <p>Default: <code>24h</code></p> <pre><code>SESSION_DURATION=24h\n</code></pre> <p>Common values:</p> Duration Value 30 min <code>30m</code> 1 hour <code>1h</code> 4 hours <code>4h</code> 24 hours <code>24h</code> 7 days <code>168h</code> <p>Minimum Duration</p> <p>Setting <code>SESSION_DURATION</code> below <code>5m</code> is not recommended as it may cause sessions to expire between keepalive intervals.</p>"},{"location":"getting-started/configuration/#session_cleanup","title":"SESSION_CLEANUP","text":"<p>How often to clean up expired sessions from the database. Defaults to <code>1h</code>.</p> <pre><code>SESSION_CLEANUP=1h\n</code></pre>"},{"location":"getting-started/configuration/#indexing-settings","title":"Indexing Settings","text":""},{"location":"getting-started/configuration/#index_interval","title":"INDEX_INTERVAL","text":"<p>How often to perform a full re-index of the media directory. Defaults to <code>30m</code>.</p> <pre><code>INDEX_INTERVAL=30m\n</code></pre>"},{"location":"getting-started/configuration/#poll_interval","title":"POLL_INTERVAL","text":"<p>How often to check for filesystem changes (lightweight scan). Defaults to <code>30s</code>.</p> <pre><code>POLL_INTERVAL=30s\n</code></pre>"},{"location":"getting-started/configuration/#thumbnail_interval","title":"THUMBNAIL_INTERVAL","text":"<p>How often the thumbnail generator performs a full scan. Defaults to <code>6h</code>.</p> <pre><code>THUMBNAIL_INTERVAL=6h\n</code></pre>"},{"location":"getting-started/configuration/#index_workers","title":"INDEX_WORKERS","text":"<p>Number of parallel workers for directory indexing. Defaults to 3 for NFS safety.</p> <pre><code>INDEX_WORKERS=3\n</code></pre> <p>When to set this:</p> <ul> <li>NFS-mounted media: Set to <code>3</code> or lower to prevent overwhelming the NFS server</li> <li>Local storage: Can increase to <code>8</code>-<code>16</code> for faster indexing</li> <li>High-performance storage: Increase to <code>8</code>-<code>16</code> for optimal performance</li> </ul> <p>NFS Performance</p> <p>If you see \"stale file handle\" errors in the logs, your NFS server is being overwhelmed. Reduce <code>INDEX_WORKERS</code> to <code>1</code> or <code>2</code>.</p> <p>Recommended values:</p> Storage Type Recommended Value NFS mount (default) <code>3</code> NFS mount (conservative) <code>1</code> Local HDD/SSD <code>8</code> High-performance local <code>8</code>-<code>16</code>"},{"location":"getting-started/configuration/#metrics-settings","title":"Metrics Settings","text":""},{"location":"getting-started/configuration/#metrics_enabled","title":"METRICS_ENABLED","text":"<p>Enable or disable the Prometheus metrics server. Defaults to <code>true</code>.</p> <pre><code>METRICS_ENABLED=true\n</code></pre>"},{"location":"getting-started/configuration/#metrics_port","title":"METRICS_PORT","text":"<p>Port for the Prometheus metrics endpoint. Defaults to <code>9090</code>.</p> <pre><code>METRICS_PORT=9090\n</code></pre>"},{"location":"getting-started/configuration/#logging-settings","title":"Logging Settings","text":""},{"location":"getting-started/configuration/#log_level","title":"LOG_LEVEL","text":"<p>Server log level. Defaults to <code>info</code>.</p> <p>Options: <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code></p> <pre><code>LOG_LEVEL=info\n</code></pre>"},{"location":"getting-started/configuration/#log_static_files","title":"LOG_STATIC_FILES","text":"<p>Log static file requests. Defaults to <code>false</code>.</p> <pre><code>LOG_STATIC_FILES=false\n</code></pre>"},{"location":"getting-started/configuration/#log_health_checks","title":"LOG_HEALTH_CHECKS","text":"<p>Log health check endpoint requests. Defaults to <code>true</code>.</p> <pre><code>LOG_HEALTH_CHECKS=true\n</code></pre>"},{"location":"getting-started/configuration/#webauthn-settings","title":"WebAuthn Settings","text":"<p>See WebAuthn Setup for detailed configuration.</p>"},{"location":"getting-started/configuration/#webauthn_enabled","title":"WEBAUTHN_ENABLED","text":"<p>Enable passkey (WebAuthn) authentication. Defaults to <code>false</code>.</p> <pre><code>WEBAUTHN_ENABLED=true\n</code></pre>"},{"location":"getting-started/configuration/#webauthn_rp_id","title":"WEBAUTHN_RP_ID","text":"<p>WebAuthn Relying Party ID (your domain).</p> <pre><code>WEBAUTHN_RP_ID=example.com\n</code></pre>"},{"location":"getting-started/configuration/#webauthn_rp_name","title":"WEBAUTHN_RP_NAME","text":"<p>Display name shown in authenticator prompts. Defaults to <code>Media Viewer</code>.</p> <pre><code>WEBAUTHN_RP_NAME=\"My Media Library\"\n</code></pre>"},{"location":"getting-started/configuration/#webauthn_origins","title":"WEBAUTHN_ORIGINS","text":"<p>Comma-separated list of allowed origins.</p> <pre><code>WEBAUTHN_ORIGINS=https://example.com,https://media.example.com\n</code></pre>"},{"location":"getting-started/configuration/#memory-settings","title":"Memory Settings","text":""},{"location":"getting-started/configuration/#memory_ratio-recommended","title":"MEMORY_RATIO (Recommended)","text":"<p>Percentage of container memory to allocate to Go heap (0.0-1.0). Recommended for production.</p> <pre><code>MEMORY_RATIO=0.75  # Recommended value for production\n</code></pre> <p>Why use MEMORY_RATIO:</p> <ul> <li>\u2705 Container-aware: Respects memory limits</li> <li>\u2705 Adaptive: GC scales with workload</li> <li>\u2705 Lower overhead: 0.16% CPU during heavy load</li> <li>\u2705 Memory-safe: Prevents OOM conditions</li> </ul> <p>Benchmark results (3,106 thumbnail test):</p> <ul> <li><code>0.85</code> (default): 0.18% overhead, 7 GC/s under load</li> <li><code>0.75</code> (recommended): 0.16% overhead, 6 GC/s under load \u2705</li> <li><code>0.70</code>: 0.20% overhead, 8 GC/s under load</li> </ul>"},{"location":"getting-started/configuration/#gogc-alternative","title":"GOGC (Alternative)","text":"<p>Go garbage collection target percentage. Use for non-containerized deployments.</p> <pre><code>GOGC=150\n</code></pre> <p>When to use GOGC:</p> <ul> <li>Running on bare metal or VMs (not containerized)</li> <li>No memory limits set</li> <li>Want simple, fixed configuration</li> </ul> <p>Performance: 0.15% CPU overhead, 4.5 GC/s (constant rate)</p> <p>Note: MEMORY_RATIO=0.75 is preferred for Docker/Kubernetes deployments.</p>"},{"location":"getting-started/configuration/#memory_limit","title":"MEMORY_LIMIT","text":"<p>Container memory limit in bytes (typically set via Kubernetes Downward API).</p> <pre><code>MEMORY_LIMIT=536870912  # 512MB\n</code></pre>"},{"location":"getting-started/configuration/#gomemlimit","title":"GOMEMLIMIT","text":"<p>Direct override for Go's memory limit. Accepts values like <code>400MiB</code> or <code>1GiB</code>.</p> <pre><code>GOMEMLIMIT=400MiB\n</code></pre> <p>Note: If using Kubernetes, it is recommended to set this using the Downward API, e.g. in the container spec:</p> <pre><code>env:\n    - name: MEMORY_LIMIT\n        valueFrom:\n        resourceFieldRef:\n            resource: limits.memory\n</code></pre>"},{"location":"getting-started/configuration/#volume-mounts","title":"Volume Mounts","text":""},{"location":"getting-started/configuration/#media-directory","title":"Media Directory","text":"<p>Mount your media library as read-only for security:</p> <pre><code>-v /path/to/media:/media:ro\n</code></pre>"},{"location":"getting-started/configuration/#cache-directory","title":"Cache Directory","text":"<p>Persist thumbnails and transcoded videos:</p> <pre><code>-v media-cache:/cache\n</code></pre>"},{"location":"getting-started/configuration/#database-directory","title":"Database Directory","text":"<p>Persist application database (user, sessions, tags, favorites):</p> <pre><code>-v media-database:/database\n</code></pre>"},{"location":"getting-started/configuration/#example-configurations","title":"Example Configurations","text":""},{"location":"getting-started/configuration/#minimal-configuration","title":"Minimal Configuration","text":"<pre><code>services:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest\n        ports:\n            - '8080:8080'\n        volumes:\n            - /photos:/media:ro\n            - cache:/cache\n            - database:/database\n\nvolumes:\n    cache:\n    database:\n</code></pre>"},{"location":"getting-started/configuration/#production-configuration","title":"Production Configuration","text":"<pre><code>services:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest\n        ports:\n            - '8080:8080'\n            - '9090:9090'\n        volumes:\n            - /mnt/storage/media:/media:ro\n            - /var/lib/media-viewer/cache:/cache\n            - /var/lib/media-viewer/database:/database\n        environment:\n            - MEDIA_DIR=/media\n            - SESSION_DURATION=12h\n            - INDEX_INTERVAL=1h\n            - THUMBNAIL_INTERVAL=12h\n            - INDEX_WORKERS=3 # Recommended for NFS mounts\n            - METRICS_ENABLED=true\n            - LOG_LEVEL=info\n            - LOG_STATIC_FILES=false\n        restart: unless-stopped\n        healthcheck:\n            test:\n                ['CMD', 'wget', '--quiet', '--tries=1', '--spider', 'http://localhost:8080/health']\n            interval: 30s\n            timeout: 10s\n            retries: 3\n            start_period: 10s\n</code></pre>"},{"location":"getting-started/configuration/#development-configuration","title":"Development Configuration","text":"<pre><code>services:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest\n        ports:\n            - '8080:8080'\n            - '9090:9090'\n        volumes:\n            - ./sample-media:/media:ro\n            - dev-cache:/cache\n            - dev-database:/database\n        environment:\n            - LOG_LEVEL=debug\n            - LOG_STATIC_FILES=true\n            - INDEX_INTERVAL=5m\n            - THUMBNAIL_INTERVAL=30m\n\nvolumes:\n    dev-cache:\n    dev-database:\n</code></pre>"},{"location":"getting-started/configuration/#reverse-proxy-setup","title":"Reverse Proxy Setup","text":"<p>When running behind a reverse proxy (nginx, Traefik, Caddy), configure it to properly forward requests.</p>"},{"location":"getting-started/configuration/#nginx-example","title":"Nginx Example","text":"<pre><code>server {\n    listen 443 ssl http2;\n    server_name media.example.com;\n\n    ssl_certificate /path/to/cert.pem;\n    ssl_certificate_key /path/to/key.pem;\n\n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        # Increase timeouts for large file uploads/streaming\n        proxy_read_timeout 300s;\n        proxy_send_timeout 300s;\n    }\n}\n</code></pre>"},{"location":"getting-started/configuration/#traefik-example-docker-labels","title":"Traefik Example (Docker Labels)","text":"<pre><code>services:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest\n        labels:\n            - 'traefik.enable=true'\n            - 'traefik.http.routers.media-viewer.rule=Host(`media.example.com`)'\n            - 'traefik.http.routers.media-viewer.entrypoints=websecure'\n            - 'traefik.http.routers.media-viewer.tls.certresolver=letsencrypt'\n            - 'traefik.http.services.media-viewer.loadbalancer.server.port=8080'\n</code></pre>"},{"location":"getting-started/configuration/#caddy-example","title":"Caddy Example","text":"<pre><code>media.example.com {\n    reverse_proxy localhost:8080\n}\n</code></pre>"},{"location":"getting-started/configuration/#duration-format-reference","title":"Duration Format Reference","text":"<p>Many settings use Go's duration format:</p> Unit Suffix Example Nanoseconds <code>ns</code> <code>500ns</code> Microseconds <code>us</code> <code>100us</code> Milliseconds <code>ms</code> <code>500ms</code> Seconds <code>s</code> <code>30s</code> Minutes <code>m</code> <code>30m</code> Hours <code>h</code> <code>6h</code> <p>You can combine units: <code>1h30m</code> (1 hour 30 minutes)</p> <p>No Day Unit</p> <p>Go's duration format doesn't support a \"day\" unit. Use hours instead (e.g., <code>24h</code> for one day, <code>168h</code> for one week).</p>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>Media Viewer can be deployed using Docker (recommended) or built from source with Go.</p>"},{"location":"getting-started/installation/#docker-installation","title":"Docker Installation","text":"<p>Docker is the recommended installation method as it handles all dependencies automatically.</p>"},{"location":"getting-started/installation/#image-selection","title":"Image Selection","text":"<p>Two image variants are available:</p> <ul> <li><code>ghcr.io/djryanj/media-viewer:latest</code> - Alpine-based, supports Intel/AMD VA-API GPU acceleration</li> <li><code>ghcr.io/djryanj/media-viewer:latest-nvidia</code> - Debian-based, supports NVIDIA NVENC GPU acceleration</li> </ul> <p>For GPU support details, see the GPU Support Guide.</p>"},{"location":"getting-started/installation/#using-docker-compose","title":"Using Docker Compose","text":"<p>Create a <code>docker-compose.yml</code> file:</p> <pre><code>version: '3.8'\n\nservices:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest # Use :latest-nvidia for NVIDIA GPUs\n        container_name: media-viewer\n        ports:\n            - '8080:8080'\n            - '9090:9090'\n        volumes:\n            - /path/to/your/media:/media:ro\n            - media-cache:/cache\n            - media-database:/database\n        environment:\n            - MEDIA_DIR=/media\n            - CACHE_DIR=/cache\n            - DATABASE_DIR=/database\n            - PORT=8080\n            - METRICS_PORT=9090\n            - METRICS_ENABLED=true\n            - INDEX_INTERVAL=30m\n            - SESSION_DURATION=24h\n            - MEMORY_RATIO=0.75 # Recommended: Adaptive GC\n            # - GOGC=150  # Alternative for non-containerized deployments\n        restart: unless-stopped\n\nvolumes:\n    media-cache:\n    media-database:\n</code></pre> <p>Start the application:</p> <pre><code>docker-compose up -d\n</code></pre>"},{"location":"getting-started/installation/#using-docker-run","title":"Using Docker Run","text":"<pre><code>docker run -d \\\n  --name media-viewer \\\n  -p 8080:8080 \\\n  -p 9090:9090 \\\n  -v /path/to/your/media:/media:ro \\\n  -v media-cache:/cache \\\n  -v media-database:/database \\\n  ghcr.io/djryanj/media-viewer:latest\n</code></pre>"},{"location":"getting-started/installation/#gpu-accelerated-transcoding-optional","title":"GPU-Accelerated Transcoding (Optional)","text":"<p>For significantly faster video transcoding, you can enable GPU acceleration:</p>"},{"location":"getting-started/installation/#nvidia-gpu","title":"NVIDIA GPU","text":"<p>Important: Use the NVIDIA-optimized image for NVIDIA GPU support.</p> <p>Add GPU support to docker-compose.yml:</p> <pre><code>services:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest-nvidia # Use NVIDIA image\n        runtime: nvidia # Use NVIDIA runtime\n        environment:\n            - GPU_ACCEL=nvidia\n            - MEMORY_RATIO=0.75 # Recommended: Adaptive GC\n            # - GOGC=150  # Alternative for non-containerized deployments\n        # ... rest of configuration\n</code></pre> <p>Or with docker run:</p> <pre><code>docker run -d \\\n  --gpus all \\\n  -e GPU_ACCEL=nvidia \\\n  -p 8080:8080 \\\n  -v /path/to/media:/media:ro \\\n  ghcr.io/djryanj/media-viewer:latest-nvidia\n</code></pre> <p>Requirements:</p> <ul> <li>NVIDIA GPU with NVENC support</li> <li>NVIDIA Container Toolkit installed on host</li> <li>Use <code>:latest-nvidia</code> or <code>:v1.0.0-nvidia</code> image tags (Debian-based)</li> </ul>"},{"location":"getting-started/installation/#intelamd-gpu-va-api","title":"Intel/AMD GPU (VA-API)","text":"<p>Add device mapping to docker-compose.yml:</p> <pre><code>services:\n    media-viewer:\n        image: ghcr.io/djryanj/media-viewer:latest\n        devices:\n            - /dev/dri:/dev/dri\n        environment:\n            - GPU_ACCEL=vaapi\n            - MEMORY_RATIO=0.75 # Recommended: Adaptive GC\n            # - GOGC=150  # Alternative for non-containerized deployments\n        # ... rest of configuration\n</code></pre> <p>Or with docker run:</p> <pre><code>docker run -d \\\n  --device /dev/dri:/dev/dri \\\n  -e GPU_ACCEL=vaapi \\\n  ... \\\n  ghcr.io/djryanj/media-viewer:latest\n</code></pre> <p>Requirements: Intel or AMD GPU with VA-API support, <code>/dev/dri</code> device available</p>"},{"location":"getting-started/installation/#performance","title":"Performance","text":"<p>GPU transcoding provides 2-5x faster video processing with lower CPU usage, especially beneficial for:</p> <ul> <li>4K/8K video transcoding</li> <li>Multiple concurrent transcode operations</li> <li>Systems with limited CPU capacity</li> </ul> <p>If GPU is unavailable or fails, the system automatically falls back to CPU transcoding.</p>"},{"location":"getting-started/installation/#building-from-source","title":"Building from Source","text":"<p>For development or custom deployments:</p>"},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>Go 1.21 or later</li> <li>FFmpeg</li> <li>GCC (for SQLite CGO compilation)</li> <li>Node.js 18+ (for frontend development tools only)</li> </ul>"},{"location":"getting-started/installation/#steps","title":"Steps","text":"<ol> <li> <p>Clone the repository:</p> <pre><code>git clone https://github.com/djryanj/media-viewer.git\ncd media-viewer\n</code></pre> </li> <li> <p>Build the application:</p> <pre><code>go build -tags 'fts5' -o media-viewer ./cmd/media-viewer\n</code></pre> </li> <li> <p>(Optional) Build the password reset utility:</p> <pre><code>go build -tags 'fts5' -o resetpw ./cmd/resetpw\n</code></pre> </li> <li> <p>Configure environment variables (see Configuration)</p> </li> <li> <p>Start the server:</p> <pre><code>./media-viewer\n</code></pre> </li> </ol>"},{"location":"getting-started/installation/#initial-setup","title":"Initial Setup","text":"<p>On first run, Media Viewer will prompt you to create a password:</p> <ol> <li>Access the application at <code>http://localhost:8080</code></li> <li>You'll be redirected to the setup page</li> <li>Create a secure password (minimum 6 characters)</li> <li>Click Create Password</li> <li>You'll be automatically logged in</li> </ol>"},{"location":"getting-started/installation/#verifying-installation","title":"Verifying Installation","text":"<p>Once running, access Media Viewer at <code>http://localhost:8080</code> (or your configured port). You should see either:</p> <ul> <li>The setup page (first time) - create your password</li> <li>The login page (subsequent runs) - enter your password</li> </ul>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Configure your installation</li> <li>Follow the Quick Start guide</li> </ul>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>This guide covers the essential features to get you started with Media Viewer in five minutes.</p>"},{"location":"getting-started/quick-start/#first-time-setup","title":"First-Time Setup","text":"<p>On first run, you'll need to create a password:</p> <ol> <li>Navigate to your Media Viewer URL (e.g., <code>http://localhost:8080</code>)</li> <li>You'll be redirected to the setup page</li> <li>Enter a secure password (minimum 6 characters)</li> <li>Click Create Password</li> <li>You'll be automatically logged in</li> </ol>"},{"location":"getting-started/quick-start/#logging-in","title":"Logging In","text":"<p>For subsequent visits:</p> <ol> <li>Navigate to your Media Viewer URL</li> <li>Enter your password</li> <li>Click Login or press ++enter++</li> </ol>"},{"location":"getting-started/quick-start/#browsing-your-library","title":"Browsing Your Library","text":"<p>After logging in, you'll see the main gallery view displaying your media files and folders.</p>"},{"location":"getting-started/quick-start/#navigation","title":"Navigation","text":"<ul> <li>Click a folder to open it</li> <li>Use the breadcrumb at the top to navigate back to parent folders</li> <li>Click the home icon to return to the root directory</li> </ul>"},{"location":"getting-started/quick-start/#sorting-and-filtering","title":"Sorting and Filtering","text":"<p>Use the controls at the top of the gallery:</p> <ul> <li>Sort by: Name, Date, Size, or Type</li> <li>Sort order: Click the arrow icon to toggle ascending/descending</li> <li>Filter: Show All, Images only, Videos only, or Playlists only</li> </ul>"},{"location":"getting-started/quick-start/#viewing-media","title":"Viewing Media","text":""},{"location":"getting-started/quick-start/#images","title":"Images","text":"<p>Click any image thumbnail to open it in the lightbox viewer. From the lightbox:</p> <ul> <li>Use arrow keys or swipe to navigate between images</li> <li>Press ++escape++ to close</li> <li>Click the star icon to add to favorites</li> <li>Click the tag icon to manage tags</li> </ul>"},{"location":"getting-started/quick-start/#videos","title":"Videos","text":"<p>Click a video thumbnail to open it in the lightbox. Video controls appear on hover.</p>"},{"location":"getting-started/quick-start/#using-favorites","title":"Using Favorites","text":"<p>Favorites provide quick access to frequently viewed items.</p>"},{"location":"getting-started/quick-start/#adding-favorites","title":"Adding Favorites","text":"<ul> <li>Double-tap (mobile) or double-click (desktop) any item</li> <li>Or click the star icon on the item thumbnail</li> <li>Or open the item and click the star icon in the lightbox</li> </ul>"},{"location":"getting-started/quick-start/#viewing-favorites","title":"Viewing Favorites","text":"<p>Favorites appear in a horizontal strip at the top of the gallery when you have items marked as favorites.</p>"},{"location":"getting-started/quick-start/#basic-tagging","title":"Basic Tagging","text":"<p>Tags help organize your media into categories.</p>"},{"location":"getting-started/quick-start/#adding-tags","title":"Adding Tags","text":"<ol> <li>Click the tag icon on any item thumbnail</li> <li>Type a tag name in the input field</li> <li>Press ++enter++ or click Add</li> <li>Repeat for additional tags</li> </ol>"},{"location":"getting-started/quick-start/#searching-by-tag","title":"Searching by Tag","text":"<ul> <li>Click any tag to search for all items with that tag</li> <li>Or type <code>tag:tagname</code> in the search box</li> </ul>"},{"location":"getting-started/quick-start/#search","title":"Search","text":"<p>Use the search box at the top to find media:</p> <ul> <li>By name: Type any part of the filename</li> <li>By tag: Click any tag chip or use the search box</li> <li>By type: Use the filter dropdown</li> </ul> <p>The search provides suggestions as you type. Press ++enter++ to see full search results.</p>"},{"location":"getting-started/quick-start/#mobile-usage","title":"Mobile Usage","text":"<p>Media Viewer is fully responsive and works on mobile devices.</p>"},{"location":"getting-started/quick-start/#installing-as-an-app","title":"Installing as an App","text":"<p>On supported devices, you can install Media Viewer as a Progressive Web App:</p> <p>Android (Chrome, Edge, Samsung Internet):</p> <ol> <li>Open Media Viewer in your mobile browser</li> <li>Tap the three-dot menu (\u22ee)</li> <li>Tap \"Add to Home Screen\" or \"Install App\"</li> <li>Launch from your home screen for a full-screen experience</li> </ol> <p>iOS (Safari):</p> <ol> <li>Open Media Viewer in Safari</li> <li>Tap the Share button (square with arrow)</li> <li>Tap \"Add to Home Screen\"</li> <li>Launch from your home screen for a full-screen experience</li> </ol>"},{"location":"getting-started/quick-start/#touch-gestures","title":"Touch Gestures","text":"<ul> <li>Tap: Open item or folder</li> <li>Double-tap: Toggle favorite</li> <li>Long-press: Enter selection mode (bulk operations)</li> <li>Swipe: Navigate in lightbox</li> </ul>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Learn about Selection Mode for bulk operations</li> <li>Explore Tag Management for advanced organization</li> <li>Review Keyboard Shortcuts to speed up your workflow</li> <li>Set up Passkey Authentication for passwordless login</li> </ul>"},{"location":"includes/abbreviations/","title":"Abbreviations","text":"<p>[PWA]: Progressive Web App [API]: Application Programming Interface [UI]: User Interface [UX]: User Experience [CSS]: Cascading Style Sheets [HTML]: HyperText Markup Language [JSON]: JavaScript Object Notation [URL]: Uniform Resource Locator _[HTTPS]: HyperText Transfer Protocol Secure</p>"},{"location":"user-guide/browsing/","title":"Browsing Media","text":"<p>Media Viewer provides an intuitive interface for navigating and viewing your media library.</p>"},{"location":"user-guide/browsing/#gallery-view","title":"Gallery View","text":"<p>The gallery displays your media in a responsive grid layout. The number of columns adjusts based on your screen size.</p>"},{"location":"user-guide/browsing/#item-types","title":"Item Types","text":"<p>Items in the gallery are indicated by visual cues:</p> Type Indicator Folder Folder icon or folder thumbnail Image Image thumbnail Video Image thumbnail with play icon overlay Playlist List icon"},{"location":"user-guide/browsing/#item-information","title":"Item Information","text":"<p>On desktop, each item displays:</p> <ul> <li>Thumbnail or icon</li> <li>File name</li> <li>Type badge (folder, image, video, playlist)</li> <li>File size (for files) or item count (for folders)</li> <li>Tags (up to 3 visible, with +N indicator for more)</li> </ul> <p>On mobile, items show a compact view with the name overlaid on the thumbnail.</p>"},{"location":"user-guide/browsing/#navigation","title":"Navigation","text":""},{"location":"user-guide/browsing/#opening-items","title":"Opening Items","text":"<ul> <li>Folders: Click to enter the folder</li> <li>Images: Click to open in lightbox</li> <li>Videos: Click to open in lightbox</li> <li>Playlists: Click to open in playlist player</li> </ul>"},{"location":"user-guide/browsing/#folder-navigation","title":"Folder Navigation","text":"<p>Use these methods to navigate between folders:</p> <ul> <li>Click folders in the gallery to enter them</li> <li>Click breadcrumb segments to jump to parent folders</li> <li>Press ++escape++ to go to the parent folder (when no overlay is open)</li> <li>Use browser back/forward buttons</li> </ul>"},{"location":"user-guide/browsing/#sorting","title":"Sorting","text":"<p>Control the display order using the sort controls:</p> <p>Sort Fields:</p> <ul> <li>Name: Alphabetical order</li> <li>Date: By modification date</li> <li>Size: By file size</li> <li>Type: Grouped by file type</li> </ul> <p>Sort Order:</p> <p>Click the arrow icon to toggle between ascending and descending order.</p>"},{"location":"user-guide/browsing/#filtering","title":"Filtering","text":"<p>Use the filter dropdown to show specific media types:</p> <ul> <li>All: Show all items</li> <li>Images: Show only images</li> <li>Videos: Show only videos</li> <li>Playlists: Show only playlists</li> </ul>"},{"location":"user-guide/browsing/#lightbox","title":"Lightbox","text":"<p>The lightbox provides a full-screen viewing experience for images and videos.</p>"},{"location":"user-guide/browsing/#opening-the-lightbox","title":"Opening the Lightbox","text":"<p>Click any image or video thumbnail to open it in the lightbox.</p>"},{"location":"user-guide/browsing/#lightbox-controls","title":"Lightbox Controls","text":"Control Action Left/Right arrows Navigate to previous/next item Close button (X) Close lightbox Star icon Toggle favorite Tag icon Open tag manager Play icon Toggle autoplay (images) Loop icon Toggle video loop Download icon Download current file <p>Auto-Hide Interface</p> <p>After 3 seconds of viewing, control buttons and interface elements automatically fade away for an unobstructed view. Tap or click anywhere on the image or video to show or hide them. On desktop, moving your mouse shows controls automatically. Navigation arrows remain visible based on your settings.</p> <p>You can configure the clock to always stay visible (even when other controls fade) in Settings \u2192 Display \u2192 \"Always Keep Clock Visible\".</p>"},{"location":"user-guide/browsing/#navigation-in-lightbox","title":"Navigation in Lightbox","text":"<ul> <li>Keyboard: Use ++left++ and ++right++ arrow keys</li> <li>Mouse: Click the left/right edges of the screen</li> <li>Touch: Swipe left or right</li> </ul>"},{"location":"user-guide/browsing/#closing-the-lightbox","title":"Closing the Lightbox","text":"<ul> <li>Press ++escape++</li> <li>Click the X button</li> <li>Click outside the media</li> </ul>"},{"location":"user-guide/browsing/#infinite-scroll","title":"Infinite Scroll","text":"<p>The gallery uses infinite scroll to load content as you browse. As you scroll down, additional items load automatically. A loading indicator appears while new items are being fetched.</p> <p>If infinite scroll is unavailable, pagination controls appear at the bottom of the gallery.</p>"},{"location":"user-guide/browsing/#mobile-considerations","title":"Mobile Considerations","text":""},{"location":"user-guide/browsing/#touch-gestures","title":"Touch Gestures","text":"<ul> <li>Tap: Open item</li> <li>Double-tap: Toggle favorite</li> <li>Long-press: Enter selection mode</li> <li>Swipe (in lightbox): Navigate between items</li> </ul>"},{"location":"user-guide/browsing/#landscape-mode","title":"Landscape Mode","text":"<p>When viewing videos in landscape orientation, the interface adapts to maximize the viewing area. Controls appear on tap and auto-hide after a few seconds.</p>"},{"location":"user-guide/browsing/#installing-as-pwa","title":"Installing as PWA","text":"<p>For the best mobile experience, install Media Viewer as a Progressive Web App:</p> <ol> <li>Open Media Viewer in Safari (iOS) or Chrome (Android)</li> <li>Tap the share button (iOS) or menu button (Android)</li> <li>Select \"Add to Home Screen\"</li> <li>Launch from your home screen</li> </ol> <p>The PWA provides:</p> <ul> <li>Full-screen experience without browser chrome</li> <li>Faster loading</li> <li>Offline access to cached thumbnails</li> </ul>"},{"location":"user-guide/favorites/","title":"Favorites","text":"<p>Favorites provide quick access to items you view frequently. Favorited items appear in a dedicated strip at the top of the gallery for one-click access.</p>"},{"location":"user-guide/favorites/#adding-favorites","title":"Adding Favorites","text":"<p>There are several ways to mark an item as a favorite:</p>"},{"location":"user-guide/favorites/#double-tapdouble-click","title":"Double-Tap/Double-Click","text":"<p>The quickest method:</p> <ul> <li>Mobile: Double-tap any item thumbnail</li> <li>Desktop: Double-click any item thumbnail</li> </ul> <p>A brief animation confirms the action.</p>"},{"location":"user-guide/favorites/#star-icon","title":"Star Icon","text":"<p>Click the star icon on any item:</p> <ul> <li>In gallery: Hover over an item to reveal the star icon in the top-right corner</li> <li>In lightbox: Click the star icon in the top-left area</li> </ul>"},{"location":"user-guide/favorites/#selection-mode","title":"Selection Mode","text":"<p>Add multiple favorites at once:</p> <ol> <li>Enter selection mode (long-press on mobile, click checkbox on desktop)</li> <li>Select items to favorite</li> <li>Click the Favorite button in the selection toolbar</li> </ol>"},{"location":"user-guide/favorites/#removing-favorites","title":"Removing Favorites","text":"<p>Use any of the same methods to remove a favorite:</p> <ul> <li>Double-tap/double-click the item again</li> <li>Click the star icon (now shown as filled/highlighted)</li> <li>In selection mode, selected favorites can be toggled</li> </ul>"},{"location":"user-guide/favorites/#favorites-strip","title":"Favorites Strip","text":"<p>When you have favorites, they appear in a horizontal strip below the breadcrumb navigation.</p>"},{"location":"user-guide/favorites/#features","title":"Features","text":"<ul> <li>Scroll horizontally to see all favorites</li> <li>Click any favorite to open it directly</li> <li>Favorites show the same thumbnail and name as in the gallery</li> <li>The star icon on favorites is always visible</li> </ul>"},{"location":"user-guide/favorites/#visibility","title":"Visibility","text":"<p>The favorites strip:</p> <ul> <li>Appears automatically when you have at least one favorite</li> <li>Hides automatically when you remove your last favorite</li> <li>Persists across folders (favorites from any location are shown)</li> </ul>"},{"location":"user-guide/favorites/#favorites-and-folders","title":"Favorites and Folders","text":"<p>You can favorite any item type:</p> <ul> <li>Folders: Favorite frequently accessed folders for quick navigation</li> <li>Images: Favorite images you view often</li> <li>Videos: Favorite videos for quick playback</li> <li>Playlists: Favorite playlists for easy access</li> </ul>"},{"location":"user-guide/favorites/#use-cases","title":"Use Cases","text":""},{"location":"user-guide/favorites/#quick-access","title":"Quick Access","text":"<p>Favorite items you access daily or weekly, such as:</p> <ul> <li>Current project folders</li> <li>Recent photo albums</li> <li>Favorite videos</li> </ul>"},{"location":"user-guide/favorites/#temporary-bookmarks","title":"Temporary Bookmarks","text":"<p>Use favorites as temporary bookmarks while browsing:</p> <ol> <li>Favorite interesting items as you browse</li> <li>Review favorites later</li> <li>Remove favorites after reviewing</li> </ol>"},{"location":"user-guide/favorites/#curated-collections","title":"Curated Collections","text":"<p>Create a curated view of your best content:</p> <ol> <li>Browse your library</li> <li>Favorite standout items</li> <li>The favorites strip becomes a highlight reel</li> </ol>"},{"location":"user-guide/keyboard-shortcuts/","title":"Keyboard Shortcuts","text":"<p>Media Viewer supports keyboard shortcuts for efficient navigation and management.</p>"},{"location":"user-guide/keyboard-shortcuts/#global-shortcuts","title":"Global Shortcuts","text":"<p>These shortcuts work throughout the application:</p> Shortcut Action ++escape++ Close current overlay, go to parent folder, or logout ++slash++ or ++ctrl+k++ Focus search box"},{"location":"user-guide/keyboard-shortcuts/#gallery-shortcuts","title":"Gallery Shortcuts","text":"<p>When browsing the gallery:</p> Shortcut Action ++escape++ Go to parent folder (when no overlay is open)"},{"location":"user-guide/keyboard-shortcuts/#lightbox-shortcuts","title":"Lightbox Shortcuts","text":"<p>When viewing media in the lightbox:</p> Shortcut Action ++left++ Previous item ++right++ Next item ++escape++ Close lightbox ++space++ Play/pause (videos)"},{"location":"user-guide/keyboard-shortcuts/#selection-mode-shortcuts","title":"Selection Mode Shortcuts","text":"<p>When in selection mode:</p> Shortcut Action ++escape++ Exit selection mode ++ctrl+a++ Select all items ++ctrl+c++ Copy tags from selected item ++ctrl+v++ Paste tags to selected items ++ctrl+m++ Merge tags across selected items ++t++ Open tag modal for selected items ++f++ Add selected items to favorites"},{"location":"user-guide/keyboard-shortcuts/#tag-modal-shortcuts","title":"Tag Modal Shortcuts","text":"<p>When the tag modal is open:</p> Shortcut Action ++enter++ Add typed tag ++escape++ Close suggestions, or close modal ++ctrl+c++ Copy common tags to clipboard ++ctrl+shift+c++ Copy all unique tags to clipboard"},{"location":"user-guide/keyboard-shortcuts/#playlist-player-shortcuts","title":"Playlist Player Shortcuts","text":"<p>When the playlist player is open:</p> Shortcut Action ++space++ Play/pause ++left++ Previous video ++right++ Next video ++escape++ Close player"},{"location":"user-guide/keyboard-shortcuts/#search-shortcuts","title":"Search Shortcuts","text":"<p>When using search:</p> Shortcut Action ++enter++ View all search results ++escape++ Close search results ++up++ / ++down++ Navigate search suggestions ++tab++ Autocomplete current suggestion"},{"location":"user-guide/keyboard-shortcuts/#tips","title":"Tips","text":""},{"location":"user-guide/keyboard-shortcuts/#escape-key-behavior","title":"Escape Key Behavior","text":"<p>The ++escape++ key follows a logical hierarchy:</p> <ol> <li>Close any open dropdown or suggestions</li> <li>Close any open modal (tag manager, search results)</li> <li>Close lightbox or playlist player</li> <li>Exit selection mode</li> <li>Navigate to parent folder</li> <li>At root with nothing open: logout</li> </ol>"},{"location":"user-guide/keyboard-shortcuts/#selection-mode-entry","title":"Selection Mode Entry","text":"<ul> <li>Desktop: Click the checkbox area on any gallery item</li> <li>Mobile: Long-press any item</li> </ul>"},{"location":"user-guide/keyboard-shortcuts/#quick-favorites","title":"Quick Favorites","text":"<p>Double-click (desktop) or double-tap (mobile) any item to toggle its favorite status without opening it.</p>"},{"location":"user-guide/overview/","title":"User Guide Overview","text":"<p>This guide provides comprehensive documentation for all Media Viewer features. Whether you're browsing your collection, organizing with tags, or managing playlists, you'll find detailed instructions here.</p>"},{"location":"user-guide/overview/#core-concepts","title":"Core Concepts","text":""},{"location":"user-guide/overview/#gallery","title":"Gallery","text":"<p>The gallery is the main interface for browsing your media library. It displays items in a responsive grid that adapts to your screen size. Items can be folders, images, videos, or playlists.</p>"},{"location":"user-guide/overview/#lightbox","title":"Lightbox","text":"<p>The lightbox is a full-screen viewer for images and videos. It provides navigation controls, media information, and quick access to tagging and favorites.</p>"},{"location":"user-guide/overview/#tags","title":"Tags","text":"<p>Tags are labels you assign to media items for organization. An item can have multiple tags, and tags can be searched, filtered, and managed in bulk.</p>"},{"location":"user-guide/overview/#favorites","title":"Favorites","text":"<p>Favorites are bookmarked items that appear in a quick-access strip at the top of the gallery. Use favorites for items you access frequently.</p>"},{"location":"user-guide/overview/#playlists","title":"Playlists","text":"<p>Playlists are Windows Media Player (.wpl) files that define an ordered sequence of videos. Media Viewer can read and play these playlist files from your media library.</p>"},{"location":"user-guide/overview/#interface-elements","title":"Interface Elements","text":""},{"location":"user-guide/overview/#header","title":"Header","text":"<p>The header contains:</p> <ul> <li>Application title: Click to return to the root directory</li> <li>Search box: Find media by name or tag</li> <li>Sort controls: Change sort field and order</li> <li>Filter dropdown: Show specific media types</li> <li>User controls: Change password, clear cache, logout</li> </ul>"},{"location":"user-guide/overview/#breadcrumb","title":"Breadcrumb","text":"<p>The breadcrumb shows your current location in the folder hierarchy. Click any segment to navigate to that folder.</p>"},{"location":"user-guide/overview/#gallery-grid","title":"Gallery Grid","text":"<p>The main content area displays media items in a grid. On desktop, items show additional metadata including type, size, and tags.</p>"},{"location":"user-guide/overview/#favorites-strip","title":"Favorites Strip","text":"<p>When you have favorites, they appear in a horizontal scrollable strip below the breadcrumb.</p>"},{"location":"user-guide/overview/#stats-bar","title":"Stats Bar","text":"<p>The bottom bar displays library statistics including total images, videos, folders, and favorites.</p>"},{"location":"user-guide/overview/#guide-sections","title":"Guide Sections","text":"<ul> <li>Browsing Media - Navigate and view your library</li> <li>Tagging - Organize with tags</li> <li>Favorites - Bookmark items for quick access</li> <li>Playlists - Play Windows Media Player (.wpl) playlist files</li> <li>Search - Find media quickly</li> <li>Keyboard Shortcuts - Efficiency shortcuts</li> </ul>"},{"location":"user-guide/playlists/","title":"Playlists","text":"<p>Media Viewer can read and play Windows Media Player (.wpl) playlist files from your media library. These playlists provide an ordered collection of videos that play in sequence.</p>"},{"location":"user-guide/playlists/#playlist-format","title":"Playlist Format","text":"<p>Media Viewer supports Windows Media Player (.wpl) format only. These are XML-based playlist files typically created by Windows Media Player or other compatible software.</p>"},{"location":"user-guide/playlists/#wpl-file-structure","title":"WPL File Structure","text":"<p>WPL files are XML documents with this basic structure:</p> <pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;smil&gt;\n  &lt;head&gt;\n    &lt;title&gt;My Playlist&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;seq&gt;\n      &lt;media src=\"video1.mp4\" /&gt;\n      &lt;media src=\"video2.mp4\" /&gt;\n      &lt;media src=\"subfolder\\video3.mp4\" /&gt;\n    &lt;/seq&gt;\n  &lt;/body&gt;\n&lt;/smil&gt;\n</code></pre>"},{"location":"user-guide/playlists/#path-resolution","title":"Path Resolution","text":"<p>Media Viewer uses intelligent path resolution to locate videos:</p> <ul> <li>Handles Windows-style paths (backslashes and drive letters)</li> <li>Handles UNC network paths</li> <li>Resolves relative paths from the playlist location</li> <li>Falls back to filename matching if direct paths fail</li> </ul> <p>This allows playlists created on different systems or with different directory structures to work as long as the video files exist in your media directory.</p>"},{"location":"user-guide/playlists/#playing-playlists","title":"Playing Playlists","text":""},{"location":"user-guide/playlists/#opening-a-playlist","title":"Opening a Playlist","text":"<p>Click any playlist item in the gallery to open the playlist player.</p>"},{"location":"user-guide/playlists/#player-interface","title":"Player Interface","text":"<p>The playlist player displays:</p> <ul> <li>Video area: The currently playing video</li> <li>Playlist sidebar: List of all videos in the playlist</li> <li>Playback controls: Previous, play/pause, next buttons</li> </ul>"},{"location":"user-guide/playlists/#navigation","title":"Navigation","text":"<ul> <li>Click any video in the sidebar to jump to it</li> <li>Use the previous/next buttons to navigate sequentially</li> <li>Videos auto-advance when playback completes</li> </ul>"},{"location":"user-guide/playlists/#unavailable-videos","title":"Unavailable Videos","text":"<p>If a video in the playlist cannot be found:</p> <ul> <li>It appears grayed out with strikethrough text</li> <li>Clicking it has no effect</li> <li>Auto-advance skips unavailable videos</li> </ul>"},{"location":"user-guide/playlists/#playlist-sidebar","title":"Playlist Sidebar","text":""},{"location":"user-guide/playlists/#desktop-view","title":"Desktop View","text":"<p>On desktop, the playlist sidebar is always visible alongside the video.</p>"},{"location":"user-guide/playlists/#mobilelandscape-view","title":"Mobile/Landscape View","text":"<p>In landscape orientation on mobile:</p> <ul> <li>The sidebar is hidden by default</li> <li>Tap the playlist icon to show/hide the sidebar</li> <li>Swipe from the right edge to reveal the sidebar</li> </ul>"},{"location":"user-guide/playlists/#video-information","title":"Video Information","text":"<p>Each playlist entry shows:</p> <ul> <li>Video filename</li> <li>Tags (if the video has tags)</li> </ul>"},{"location":"user-guide/playlists/#creating-playlists","title":"Creating Playlists","text":"<p>Media Viewer does not have a built-in playlist creation feature. To create playlists:</p>"},{"location":"user-guide/playlists/#using-windows-media-player","title":"Using Windows Media Player","text":"<ol> <li>Open Windows Media Player</li> <li>Add videos to your library</li> <li>Create a new playlist</li> <li>Add videos to the playlist</li> <li>Save the playlist as a .wpl file in your media directory</li> </ol>"},{"location":"user-guide/playlists/#using-third-party-tools","title":"Using Third-Party Tools","text":"<p>Any software that creates Windows Media Player (.wpl) format playlists will work with Media Viewer.</p>"},{"location":"user-guide/playlists/#manual-wpl-creation","title":"Manual WPL Creation","text":"<p>For advanced users, you can create .wpl files manually:</p> <ol> <li>Create a new file with the <code>.wpl</code> extension</li> <li>Use the XML structure shown above</li> <li>Add <code>&lt;media src=\"path/to/video.mp4\" /&gt;</code> entries for each video</li> <li>Save the file in your media library</li> <li>Refresh or re-index Media Viewer to see the playlist</li> </ol> <p>Path Format</p> <p>Use forward slashes (<code>/</code>) or backslashes (<code>\\</code>) for paths. Relative paths are resolved from the playlist file location.</p>"},{"location":"user-guide/playlists/#playback-features","title":"Playback Features","text":""},{"location":"user-guide/playlists/#auto-advance","title":"Auto-Advance","text":"<p>Videos automatically advance to the next item when playback completes. The playlist loops back to the beginning after the last video.</p>"},{"location":"user-guide/playlists/#video-controls","title":"Video Controls","text":"<p>Standard video controls are available:</p> <ul> <li>Play/pause</li> <li>Seek bar</li> <li>Volume control</li> <li>Fullscreen toggle</li> </ul>"},{"location":"user-guide/playlists/#keyboard-shortcuts","title":"Keyboard Shortcuts","text":"<p>While the playlist player is open:</p> Key Action ++space++ Play/pause ++left++ Previous video ++right++ Next video ++escape++ Close player"},{"location":"user-guide/search/","title":"Search","text":"<p>Media Viewer provides powerful search capabilities to quickly find media in your library.</p> <p>Full-text search with tag filtering and autocomplete</p>"},{"location":"user-guide/search/#basic-search","title":"Basic Search","text":"<p>Type in the search box at the top of the page to search by filename.</p> <ul> <li>Search is case-insensitive</li> <li>Partial matches are supported</li> <li>Results update as you type</li> </ul>"},{"location":"user-guide/search/#search-dropdown","title":"Search Dropdown","text":"<p>As you type, a dropdown shows matching results:</p> <ul> <li>Up to 10 items are shown</li> <li>Results include thumbnail, name, and path</li> <li>Favorited items show a star indicator</li> <li>Click any result to open it directly</li> <li>Press ++enter++ to see all results</li> </ul>"},{"location":"user-guide/search/#full-results-view","title":"Full Results View","text":"<p>Press ++enter++ or click \"View all results\" to open the full search results view:</p> <ul> <li>Results display in a gallery grid</li> <li>An editable search bar at the top lets you refine your search</li> <li>Press ++tab++ to autocomplete suggestions</li> <li>Press ++slash++ or ++ctrl+k++ to focus the search bar</li> <li>Use the same interactions as the main gallery</li> <li>Click \"Close\" or press ++escape++ to return to browsing</li> </ul>"},{"location":"user-guide/search/#tag-search","title":"Tag Search","text":"<p>Search for items with specific tags using the <code>tag:</code> prefix:</p> <pre><code>tag:vacation\n</code></pre>"},{"location":"user-guide/search/#tag-suggestions","title":"Tag Suggestions","text":"<p>When you type <code>tag:</code>, suggestions appear showing:</p> <ul> <li>Matching tag names</li> <li>Number of items with each tag</li> </ul> <p>Click a suggestion to search for that tag.</p>"},{"location":"user-guide/search/#clicking-tags","title":"Clicking Tags","text":"<p>You can also search by clicking:</p> <ul> <li>Any tag displayed on a gallery item</li> <li>Any tag in the tag manager modal</li> <li>Any tag in the lightbox</li> </ul>"},{"location":"user-guide/search/#tag-exclusion","title":"Tag Exclusion","text":"<p>Exclude items with specific tags from your results:</p> <pre><code>-tag:private\n</code></pre> <p>or</p> <pre><code>NOT tag:private\n</code></pre> <p>Combining Inclusions and Exclusions:</p> <pre><code>tag:vacation -tag:2023\n</code></pre> <p>Finds items tagged \"vacation\" but not \"2023\".</p> <p>With Text Search:</p> <pre><code>beach -tag:private\n</code></pre> <p>Searches for \"beach\" excluding items tagged \"private\".</p>"},{"location":"user-guide/search/#tag-interactions-in-search-results","title":"Tag Interactions in Search Results","text":"<p>When viewing search results, tags have search-focused behavior:</p> <ul> <li>Hover over any tag to see the exclude button (\u2212)</li> <li>Click the exclude button to add that tag as an exclusion</li> <li>Right-click or long-press any tag for options:<ul> <li>\"Search for\" - Search for items with this tag</li> <li>\"Exclude\" - Exclude items with this tag</li> </ul> </li> <li>Type <code>-</code> or <code>-tag:</code> in the search bar for exclusion suggestions</li> </ul> <p>Note: In search view, clicking tags searches rather than opening the tag editor. This helps you refine your search without leaving the results.</p>"},{"location":"user-guide/search/#search-syntax","title":"Search Syntax","text":""},{"location":"user-guide/search/#by-filename","title":"By Filename","text":"<pre><code>sunset\n</code></pre> <p>Finds items with \"sunset\" anywhere in the filename.</p>"},{"location":"user-guide/search/#by-tag","title":"By Tag","text":"<pre><code>tag:nature\n</code></pre> <p>Finds items tagged with \"nature\".</p>"},{"location":"user-guide/search/#by-type","title":"By Type","text":"<p>Use the filter dropdown to restrict results to specific types:</p> <ul> <li>Images only</li> <li>Videos only</li> <li>Playlists only</li> </ul>"},{"location":"user-guide/search/#search-tips","title":"Search Tips","text":""},{"location":"user-guide/search/#finding-recent-additions","title":"Finding Recent Additions","text":"<ol> <li>Sort by Date (descending)</li> <li>The newest items appear first</li> </ol>"},{"location":"user-guide/search/#finding-large-files","title":"Finding Large Files","text":"<ol> <li>Sort by Size (descending)</li> <li>Filter by type if needed</li> </ol>"},{"location":"user-guide/search/#organizing-with-search","title":"Organizing with Search","text":"<p>Use search to find items that need organization:</p> <ol> <li>Search for items without tags (browse and look for items missing tags)</li> <li>Use selection mode to tag multiple items at once</li> </ol>"},{"location":"user-guide/search/#search-behavior","title":"Search Behavior","text":""},{"location":"user-guide/search/#scope","title":"Scope","text":"<p>Search covers your entire media library, not just the current folder.</p>"},{"location":"user-guide/search/#results","title":"Results","text":"<p>Search results include:</p> <ul> <li>Files (images, videos)</li> <li>Folders</li> <li>Playlists</li> </ul>"},{"location":"user-guide/search/#performance","title":"Performance","text":"<ul> <li>Search uses an index for fast results</li> <li>The index updates automatically when files change</li> <li>Large libraries may have a brief delay on first search</li> </ul>"},{"location":"user-guide/tagging/","title":"Tagging","text":"<p>Tags are labels you assign to media items for organization and quick retrieval. Media Viewer provides a flexible tagging system that supports individual and bulk operations.</p> <p>Selection mode enables efficient bulk tagging on mobile</p>"},{"location":"user-guide/tagging/#understanding-tags","title":"Understanding Tags","text":"<ul> <li>Tags are simple text labels (e.g., \"vacation\", \"family\", \"2024\")</li> <li>An item can have multiple tags</li> <li>Tags are shared across your entire library</li> <li>Tags are case-sensitive (\"Vacation\" and \"vacation\" are different tags)</li> </ul>"},{"location":"user-guide/tagging/#adding-tags","title":"Adding Tags","text":""},{"location":"user-guide/tagging/#from-the-gallery","title":"From the Gallery","text":"<ol> <li>Hover over an item to reveal the tag button (tag icon in the top-left corner)</li> <li>Click the tag button to open the tag manager</li> <li>Type a tag name in the input field</li> <li>Press ++enter++ or click Add</li> <li>Repeat for additional tags</li> <li>Click outside the modal or press ++escape++ to close</li> </ol>"},{"location":"user-guide/tagging/#from-the-lightbox","title":"From the Lightbox","text":"<ol> <li>Open an item in the lightbox</li> <li>Click the tag icon in the top-left area</li> <li>Add tags using the same process as above</li> </ol>"},{"location":"user-guide/tagging/#tag-suggestions","title":"Tag Suggestions","text":"<p>As you type, existing tags that match your input appear as suggestions. Click a suggestion to add that tag, or continue typing to create a new tag.</p>"},{"location":"user-guide/tagging/#removing-tags","title":"Removing Tags","text":""},{"location":"user-guide/tagging/#from-the-tag-manager","title":"From the Tag Manager","text":"<ol> <li>Open the tag manager for an item</li> <li>Click the X on any tag chip to remove it</li> </ol>"},{"location":"user-guide/tagging/#from-the-gallery-desktop","title":"From the Gallery (Desktop)","text":"<p>On desktop, tags are displayed on gallery items with a \"X | tag\" format:</p> <ol> <li>Hover over a tag on any gallery item</li> <li>Click the X on the left side of the tag to remove it</li> </ol>"},{"location":"user-guide/tagging/#from-the-tag-tooltip","title":"From the Tag Tooltip","text":"<p>When an item has more than 3 tags, a \"+N\" indicator appears:</p> <ol> <li>Click the \"+N\" indicator to see all tags</li> <li>Click the X on any tag to remove it</li> </ol>"},{"location":"user-guide/tagging/#bulk-tagging","title":"Bulk Tagging","text":"<p>Selection mode allows you to tag multiple items at once.</p>"},{"location":"user-guide/tagging/#entering-selection-mode","title":"Entering Selection Mode","text":"<ul> <li>Desktop: Click the checkbox area on any gallery item</li> <li>Mobile: Long-press any item</li> </ul>"},{"location":"user-guide/tagging/#tagging-selected-items","title":"Tagging Selected Items","text":"<ol> <li>Select the items you want to tag</li> <li>Click the Tag button in the selection toolbar</li> <li>Add tags in the bulk tag modal</li> <li>Tags are applied to all selected items</li> </ol>"},{"location":"user-guide/tagging/#tag-indicators-in-bulk-mode","title":"Tag Indicators in Bulk Mode","text":"<p>When tagging multiple items, the modal shows:</p> <ul> <li>Tags common to all selected items</li> <li>Tags present on some items (marked with a \"~\" indicator)</li> </ul>"},{"location":"user-guide/tagging/#copying-and-pasting-tags","title":"Copying and Pasting Tags","text":"<p>Media Viewer supports copying tags from one item and pasting them to others.</p>"},{"location":"user-guide/tagging/#copying-tags","title":"Copying Tags","text":"<ol> <li>Enter selection mode</li> <li>Select a single item</li> <li>Click Copy Tags or press ++ctrl+c++</li> </ol>"},{"location":"user-guide/tagging/#pasting-tags","title":"Pasting Tags","text":"<ol> <li>With tags copied, select destination item(s)</li> <li>Click Paste Tags or press ++ctrl+v++</li> <li>In the confirmation modal, select which tags to paste</li> <li>Click Paste Tags to apply</li> </ol>"},{"location":"user-guide/tagging/#merging-tags","title":"Merging Tags","text":"<p>When multiple items are selected, you can merge all their tags:</p> <ol> <li>Select 2 or more items</li> <li>Click Merge Tags or press ++ctrl+m++</li> <li>The modal shows all unique tags from selected items</li> <li>Tags not on all items show a count (e.g., \"nature (2/3)\")</li> <li>Select tags to apply and click Merge Tags</li> </ol> <p>All selected tags are applied to all selected items.</p>"},{"location":"user-guide/tagging/#searching-by-tag","title":"Searching by Tag","text":"<p>Click any tag to search for all items with that tag. Alternatively, use the search box with the <code>tag:</code> prefix:</p> <pre><code>tag:vacation\n</code></pre>"},{"location":"user-guide/tagging/#tag-exclusion","title":"Tag Exclusion","text":"<p>Exclude items with specific tags from search results:</p> <pre><code>-tag:private\n</code></pre> <p>or</p> <pre><code>NOT tag:private\n</code></pre> <p>Combining Filters:</p> <pre><code>tag:vacation -tag:2023\n</code></pre> <p>Finds items tagged \"vacation\" but not \"2023\".</p>"},{"location":"user-guide/tagging/#search-view-tag-behavior","title":"Search View Tag Behavior","text":"<p>When viewing search results, tag interactions are search-focused:</p> <ul> <li>Hover over any tag to see the exclude button (\u2212)</li> <li>Click the exclude button to add that tag as an exclusion to your search</li> <li>Right-click or long-press any tag for \"Search for\" or \"Exclude\" options</li> <li>Clicking tags searches for them rather than opening the tag editor</li> </ul> <p>This behavior helps you refine searches without leaving the results view.</p> <p>See Search for more search options.</p>"},{"location":"user-guide/tagging/#tag-management-tips","title":"Tag Management Tips","text":"<ul> <li>Use consistent naming conventions (e.g., always lowercase)</li> <li>Create a hierarchy with prefixes (e.g., \"location-beach\", \"location-mountain\")</li> <li>Use year tags for chronological organization (e.g., \"2024\", \"2023\")</li> <li>Combine tags for precise filtering (search for multiple tags)</li> </ul>"},{"location":"user-guide/tagging/#tag-manager","title":"Tag Manager","text":"<p>Access the centralized Tag Manager from Settings \u2192 Tags tab to organize and maintain your entire tag library.</p>"},{"location":"user-guide/tagging/#viewing-tags","title":"Viewing Tags","text":"<p>The Tag Manager displays all tags in your library with:</p> <ul> <li>Tag name with color indicator (if set)</li> <li>Usage count showing how many files have each tag</li> <li>Sortable columns by name (alphabetical) or count (most/least used)</li> </ul>"},{"location":"user-guide/tagging/#search-and-filter","title":"Search and Filter","text":"<ul> <li>Search bar: Type to filter tags by name in real-time</li> <li>Show Only Unused: Filter to see tags that aren't assigned to any files</li> <li>Show All Tags: Reset filter to view all tags</li> </ul>"},{"location":"user-guide/tagging/#renaming-tags","title":"Renaming Tags","text":"<p>Rename a tag to fix typos or update naming conventions:</p> <ol> <li>Click the Rename button next to any tag</li> <li>Enter the new tag name</li> <li>If the new name already exists, tags will be merged</li> <li>The rename affects all files using that tag</li> <li>Case-only changes are supported (e.g., \"animal\" \u2192 \"Animal\")</li> </ol> <p>Note: The affected file count is shown in the confirmation message.</p>"},{"location":"user-guide/tagging/#deleting-tags","title":"Deleting Tags","text":"<p>Remove unused or unwanted tags:</p> <ol> <li>Click the Delete button next to any tag</li> <li>Confirm the deletion in the modal</li> <li>The tag is removed from all files automatically</li> <li>The deletion count shows how many files were affected</li> </ol>"},{"location":"user-guide/tagging/#use-cases","title":"Use Cases","text":"<ul> <li>Clean up typos: Rename \"vacaton\" to \"vacation\"</li> <li>Standardize naming: Rename \"Beach\" to \"beach\" for consistency</li> <li>Merge duplicates: Rename \"holidays\" to \"vacation\" to combine similar tags</li> <li>Remove clutter: Delete experimental or one-off tags</li> <li>Find orphans: Use \"Show Only Unused\" to identify and remove tags no longer in use</li> </ul>"},{"location":"user-guide/webauthn/","title":"WebAuthn (Passkey) Authentication User Guide","text":"<p>Secure biometric authentication with passkeys</p>"},{"location":"user-guide/webauthn/#for-end-users","title":"For End Users","text":""},{"location":"user-guide/webauthn/#registering-a-passkey","title":"Registering a Passkey","text":"<ol> <li>Log in with your password</li> <li>Open Settings (\u2699\ufe0f icon in top-right)</li> <li>Navigate to \"Passkeys\" tab</li> <li>Click \"Add Passkey\"</li> <li>Name your passkey (e.g., \"MacBook Pro\", \"iPhone 14\", \"YubiKey\")</li> <li>Complete authentication:<ul> <li>Touch ID/Face ID prompt on Apple devices</li> <li>Windows Hello prompt on Windows</li> <li>Fingerprint prompt on Android</li> <li>Insert and tap security key if using external authenticator</li> </ul> </li> </ol>"},{"location":"user-guide/webauthn/#logging-in-with-a-passkey","title":"Logging In with a Passkey","text":"<p>Method 1: Auto-prompt (Firefox and older browsers)</p> <ol> <li>Navigate to login page</li> <li>Wait for passkey prompt to appear automatically</li> <li>Complete biometric authentication or tap security key</li> </ol> <p>Method 2: Autofill (Chrome, Safari, Edge)</p> <ol> <li>Navigate to login page</li> <li>Click or tap in the password field</li> <li>Select your passkey from the autofill dropdown</li> <li>Complete biometric authentication</li> </ol> <p>Method 3: Manual button</p> <ol> <li>Navigate to login page</li> <li>Click \"Sign in with Passkey\" button</li> <li>Complete biometric authentication or tap security key</li> </ol> <p>Fallback: Password</p> <ul> <li>You can always use your password if passkeys fail</li> <li>Password field remains available even with passkeys registered</li> </ul>"},{"location":"user-guide/webauthn/#managing-passkeys","title":"Managing Passkeys","text":"<p>View registered passkeys:</p> <ul> <li>Settings \u2192 Passkeys tab</li> <li>See device names, creation dates, and last used dates</li> </ul> <p>Delete a passkey:</p> <ul> <li>Click trash icon next to the passkey</li> <li>Confirm deletion</li> <li>The device/key will no longer be able to sign in</li> </ul> <p>Best practices:</p> <ul> <li>Register passkeys on devices you frequently use</li> <li>Use descriptive names (\"Work MacBook\", \"Personal iPhone\")</li> <li>Remove passkeys for lost or sold devices immediately</li> <li>Keep at least one backup authentication method</li> </ul>"},{"location":"user-guide/webauthn/#for-administrators","title":"For Administrators","text":""},{"location":"user-guide/webauthn/#initial-setups","title":"Initial Setups","text":"<ol> <li>Enable HTTPS on your server (required for production)</li> <li>Set environment variables (see Configuration section)</li> <li>Restart the application</li> <li>Verify configuration in application logs</li> </ol>"}]}