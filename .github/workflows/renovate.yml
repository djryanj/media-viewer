name: Renovate

on:
    workflow_dispatch:
        inputs:
            dryRun:
                description: 'Dry run mode'
                required: false
                default: 'false'
                type: choice
                options:
                    - 'true'
                    - 'false'
    schedule:
        # Run Monday at 6 AM UTC (matches renovate.json schedule)
        - cron: '0 6 * * 1'
    push:
        branches:
            - main
        paths:
            - '.github/renovate.json'
            - '.github/workflows/renovate.yml'

jobs:
    renovate:
        name: Run Renovate
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v6

            - name: Self-hosted Renovate
              uses: renovatebot/github-action@v46.0.1
              with:
                  configurationFile: .github/renovate.json
                  token: ${{ secrets.RENOVATE_TOKEN || secrets.GITHUB_TOKEN }}
              env:
                  LOG_LEVEL: ${{ github.event.inputs.dryRun == 'true' && 'debug' || 'info' }}
                  RENOVATE_DRY_RUN: ${{ github.event.inputs.dryRun || 'false' }}
