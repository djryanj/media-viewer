<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Login - Media Viewer</title>
        <link rel="stylesheet" href="/css/login.css" />
        <!-- Lucide Icons -->
        <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    </head>
    <body>
        <div class="login-container">
            <div class="login-box">
                <!-- Login Form -->
                <form id="login-form" class="auth-form hidden">
                    <h1>Media Viewer</h1>
                    <h2>Login</h2>

                    <!-- Error Message -->
                    <div id="login-error" class="error-message hidden">
                        <i data-lucide="alert-circle"></i>
                        <span>Invalid password</span>
                    </div>

                    <!-- Passkey Warning Messages -->
                    <div id="passkey-config-error" class="warning-message hidden">
                        <i data-lucide="alert-triangle"></i>
                        <span></span>
                    </div>

                    <div id="passkey-insecure-error" class="warning-message hidden">
                        <i data-lucide="alert-triangle"></i>
                        <span
                            >Passkeys require HTTPS. You're currently accessing over HTTP.
                            <a
                                href="https://djryanj.github.io/media-viewer/admin/webauthn/#secure-context-requirement"
                                target="_blank"
                                rel="noopener noreferrer"
                                >Learn how to set up HTTPS</a
                            >
                            to enable passkey authentication.</span
                        >
                    </div>

                    <div id="passkey-browser-error" class="info-message hidden">
                        <i data-lucide="info"></i>
                        <span
                            >Passkeys are not supported in this browser. Try using a modern browser
                            like Chrome, Safari, or Edge.</span
                        >
                    </div>

                    <!-- Passkey Login Section -->
                    <div id="passkey-section" class="passkey-section hidden">
                        <button type="button" id="passkey-login-btn" class="btn btn-passkey">
                            <i data-lucide="fingerprint" class="passkey-icon"></i>
                            <span class="btn-text">Sign in with Passkey</span>
                        </button>

                        <div class="divider">
                            <span>or use password</span>
                        </div>
                    </div>

                    <!-- Password Input -->
                    <div class="form-group">
                        <label for="password">Password</label>
                        <div class="password-input-wrapper">
                            <input
                                type="password"
                                id="password"
                                name="password"
                                required
                                autocomplete="username webauthn"
                                placeholder="Enter your password"
                            />
                            <button
                                type="button"
                                class="password-toggle"
                                tabindex="-1"
                                aria-label="Show password"
                            >
                                <i data-lucide="eye" class="eye-open"></i>
                                <i data-lucide="eye-off" class="eye-closed hidden"></i>
                            </button>
                        </div>
                    </div>

                    <button type="submit" id="login-submit" class="btn btn-primary">Login</button>
                </form>

                <!-- Setup Form (first-time password creation) -->
                <form id="setup-form" class="auth-form hidden">
                    <h1>Media Viewer</h1>
                    <h2>Create Password</h2>

                    <p class="setup-info">
                        Welcome! Create a password to protect your media library.
                    </p>

                    <div id="setup-error" class="error-message hidden">
                        <i data-lucide="alert-circle"></i>
                        <span>Error</span>
                    </div>

                    <div class="form-group">
                        <label for="setup-password">Password</label>
                        <div class="password-input-wrapper">
                            <input
                                type="password"
                                id="setup-password"
                                name="password"
                                required
                                minlength="6"
                                maxlength="72"
                                autocomplete="new-password"
                                placeholder="Create a password"
                            />
                            <button
                                type="button"
                                class="password-toggle"
                                tabindex="-1"
                                aria-label="Show password"
                            >
                                <i data-lucide="eye" class="eye-open"></i>
                                <i data-lucide="eye-off" class="eye-closed hidden"></i>
                            </button>
                        </div>
                        <span class="hint">6-72 characters</span>
                    </div>

                    <div class="form-group">
                        <label for="setup-confirm">Confirm Password</label>
                        <div class="password-input-wrapper">
                            <input
                                type="password"
                                id="setup-confirm"
                                name="confirm"
                                required
                                minlength="6"
                                maxlength="72"
                                autocomplete="new-password"
                                placeholder="Confirm your password"
                            />
                            <button
                                type="button"
                                class="password-toggle"
                                tabindex="-1"
                                aria-label="Show password"
                            >
                                <i data-lucide="eye" class="eye-open"></i>
                                <i data-lucide="eye-off" class="eye-closed hidden"></i>
                            </button>
                        </div>
                    </div>

                    <button type="submit" id="setup-submit" class="btn btn-primary">
                        Create Password
                    </button>
                </form>

                <!-- Loading State -->
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Loading...</p>
                </div>
            </div>
        </div>

        <script src="/js/webauthn.js"></script>
        <script src="/js/login.js"></script>
    </body>
</html>
