<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no, maximum-scale=1.0"
        />
        <title>Media Viewer</title>

        <!-- PWA Meta Tags -->
        <meta name="application-name" content="Media Viewer" />
        <meta name="theme-color" content="#1a1a2e" />
        <meta name="color-scheme" content="dark" />
        <meta name="mobile-web-app-capable" content="yes" />

        <!-- iOS Safari PWA Support -->
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="apple-mobile-web-app-title" content="Media Viewer" />

        <!-- iOS Safari Icons -->
        <link rel="apple-touch-icon" href="/icons/icon-180x180.png" />
        <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
        <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-167x167.png" />
        <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png" />

        <!-- Favicon -->
        <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png" />

        <!-- Web App Manifest -->
        <link rel="manifest" href="/manifest.json" />

        <!-- Prevent automatic detection -->
        <meta name="format-detection" content="telephone=no" />

        <!-- Styles -->
        <link rel="stylesheet" href="/css/style.css" />
        <!-- Lucide Icons -->
        <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    </head>

    <body>
        <!-- Header -->
        <header class="header">
            <div class="header-inner">
                <div class="header-top">
                    <a href="/" class="logo-link">
                        <img src="/icons/icon.svg" alt="Media Viewer" class="header-logo" />
                        <h1>Media Viewer</h1>
                    </a>
                </div>

                <div class="search-user-row">
                    <div class="search-container">
                        <div class="search-box">
                            <input
                                type="text"
                                id="search-input"
                                placeholder="Search files and tags..."
                                autocomplete="off"
                            />
                            <button
                                class="search-clear hidden"
                                id="search-clear"
                                aria-label="Clear search"
                            >
                                Ã—
                            </button>
                        </div>
                        <div class="search-dropdown hidden" id="search-dropdown"></div>
                    </div>
                </div>

                <div class="controls">
                    <div class="sort-controls">
                        <label for="sort-select">Sort:</label>
                        <select id="sort-select">
                            <option value="name">Name</option>
                            <option value="date">Date</option>
                            <option value="size">Size</option>
                            <option value="type">Type</option>
                        </select>
                        <button
                            class="btn-icon"
                            id="sort-direction"
                            aria-label="Toggle sort direction"
                        >
                            <span class="sort-icon">
                                <i data-lucide="arrow-up"></i>
                            </span>
                        </button>
                    </div>

                    <div class="filter-controls">
                        <label for="filter-select">Show:</label>
                        <select id="filter-select">
                            <option value="all">All</option>
                            <option value="images">Images</option>
                            <option value="videos">Videos</option>
                            <option value="playlists">Playlists</option>
                        </select>
                    </div>
                </div>

                <div class="user-controls">
                    <button class="btn-icon" id="settings-btn" aria-label="Settings">
                        <i data-lucide="settings"></i>
                    </button>
                    <button class="btn-icon" id="logout-btn" aria-label="Logout">
                        <i data-lucide="log-out"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <div class="breadcrumb-inner" id="breadcrumb"></div>
        </nav>

        <!-- Favorites Section -->
        <section class="favorites-section hidden" id="favorites-section">
            <div class="favorites-inner">
                <div class="section-header">
                    <h2><i data-lucide="star"></i> Favorites</h2>
                </div>
                <div class="favorites-gallery" id="favorites-gallery"></div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main-content">
            <div class="gallery" id="gallery"></div>

            <div id="pagination" class="pagination hidden">
                <button id="page-prev" class="btn">
                    <i data-lucide="chevron-left"></i> Previous
                </button>
                <span id="page-info"></span>
                <button id="page-next" class="btn">Next <i data-lucide="chevron-right"></i></button>
            </div>
        </main>

        <!-- Search Results -->
        <section class="search-results hidden" id="search-results">
            <div class="search-results-header">
                <div class="search-results-header-inner">
                    <div class="search-results-logo">
                        <img src="/icons/icon.svg" alt="Media Viewer" class="header-logo" />
                        <h1>Media Viewer</h1>
                    </div>
                    <div class="search-results-search-bar">
                        <div class="search-results-input-wrapper">
                            <i data-lucide="search" class="search-results-input-icon"></i>
                            <input
                                type="text"
                                id="search-results-input"
                                class="search-results-input"
                                placeholder="Modify search..."
                                autocomplete="off"
                                autocorrect="off"
                                autocapitalize="off"
                                spellcheck="false"
                            />
                            <button
                                id="search-results-clear"
                                class="search-results-clear hidden"
                                type="button"
                                aria-label="Clear search"
                            >
                                <i data-lucide="x"></i>
                            </button>
                        </div>
                        <div id="search-results-dropdown" class="search-dropdown hidden"></div>
                    </div>
                    <span class="search-results-count" id="search-results-count"></span>
                    <button
                        class="btn-icon"
                        id="search-results-close"
                        aria-label="Close search results"
                    >
                        <i data-lucide="x"></i>
                    </button>
                </div>
            </div>
            <div class="search-results-gallery" id="search-results-gallery"></div>
            <div id="search-pagination" class="pagination hidden">
                <button id="search-page-prev" class="btn">
                    <i data-lucide="chevron-left"></i> Previous
                </button>
                <span id="search-page-info"></span>
                <button id="search-page-next" class="btn">
                    Next <i data-lucide="chevron-right"></i>
                </button>
            </div>
        </section>

        <!-- Lightbox -->
        <div class="lightbox hidden" id="lightbox">
            <button class="lightbox-pin" id="lightbox-pin" title="Add to favorites (F)">
                <i data-lucide="star"></i>
            </button>
            <button class="lightbox-tag" id="lightbox-tag" title="Manage tags (T)">
                <i data-lucide="tag"></i>
            </button>
            <button class="lightbox-download" id="lightbox-download" title="Download (D)">
                <i data-lucide="download"></i>
            </button>
            <button class="lightbox-close" title="Close (Esc)">
                <i data-lucide="x"></i>
            </button>
            <button class="lightbox-prev" title="Previous">
                <i data-lucide="chevron-left"></i>
            </button>
            <button class="lightbox-next" title="Next">
                <i data-lucide="chevron-right"></i>
            </button>
            <div class="lightbox-content">
                <img id="lightbox-image" class="lightbox-image" src="" alt="" />
                <div class="lightbox-video-wrapper">
                    <video id="lightbox-video" class="lightbox-video hidden"></video>
                    <!-- VideoPlayer component will create controls here -->
                </div>
            </div>
            <div class="lightbox-info">
                <span id="lightbox-title"></span>
                <span id="lightbox-counter"></span>
            </div>
        </div>

        <!-- Player Modal -->
        <div class="player-modal hidden" id="player-modal">
            <div class="player-container">
                <div class="player-header">
                    <h2 id="playlist-title">Playlist</h2>
                    <div class="player-header-controls">
                        <button class="player-maximize" id="player-maximize" title="Theater mode">
                            <i data-lucide="monitor"></i>
                        </button>
                        <button class="player-fullscreen" id="player-fullscreen" title="Fullscreen">
                            <i data-lucide="maximize-2"></i>
                        </button>
                        <button class="player-close">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                </div>
                <div class="player-body">
                    <div class="video-wrapper">
                        <div class="video-container">
                            <video id="playlist-video"></video>
                            <!-- VideoPlayer component will create controls dynamically -->
                        </div>
                    </div>
                    <aside class="playlist-sidebar">
                        <h3>Playlist</h3>
                        <ul id="playlist-items"></ul>
                    </aside>
                </div>
            </div>
        </div>

        <!-- Tag Modal -->
        <div id="tag-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <span><i data-lucide="tag"></i></span>
                    <h2>Manage Tags</h2>
                    <button id="tag-modal-close" class="modal-close">
                        <i data-lucide="x"></i>
                    </button>
                </div>

                <div class="modal-body">
                    <div id="tag-modal-path" class="tag-modal-file"></div>

                    <div class="tag-input-container">
                        <input type="text" id="tag-input" placeholder="Add a tag..." />
                        <button id="add-tag-btn" class="btn btn-primary">Add</button>
                    </div>

                    <div id="tag-suggestions" class="tag-suggestions hidden"></div>

                    <div class="current-tags-section">
                        <h3>Current Tags</h3>
                        <div id="current-tags" class="current-tags">
                            <span class="no-tags">No tags</span>
                        </div>

                        <div class="tag-modal-copy-actions">
                            <button
                                id="tag-modal-copy-btn"
                                class="btn btn-secondary tag-modal-copy-btn hidden"
                            >
                                <i data-lucide="clipboard-copy"></i>
                                <span>Copy Tags</span>
                            </button>
                            <button
                                id="tag-modal-copy-all-btn"
                                class="btn btn-secondary tag-modal-copy-btn hidden"
                            >
                                <i data-lucide="clipboard-list"></i>
                                <span>Copy All Tags</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirm Modal -->
        <div class="confirm-modal hidden" id="confirm-modal">
            <div class="confirm-modal-content">
                <div class="confirm-modal-icon" id="confirm-modal-icon">
                    <i data-lucide="alert-triangle"></i>
                </div>
                <h3 id="confirm-modal-title">Confirm</h3>
                <p id="confirm-modal-message">Are you sure?</p>
                <div class="confirm-modal-buttons">
                    <button class="btn btn-secondary" id="confirm-modal-cancel">Cancel</button>
                    <button class="btn btn-danger" id="confirm-modal-confirm">Confirm</button>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div
            id="settings-modal"
            class="modal hidden"
            role="dialog"
            aria-labelledby="settings-title"
            aria-modal="true"
        >
            <div class="modal-backdrop"></div>
            <div class="modal-content settings-modal-content">
                <div class="modal-header">
                    <h2 id="settings-title">
                        <i data-lucide="settings"></i>
                        Settings
                    </h2>
                    <button class="modal-close" aria-label="Close settings">
                        <i data-lucide="x"></i>
                    </button>
                </div>

                <!-- Settings Tabs -->
                <div class="settings-tabs" role="tablist">
                    <button
                        class="settings-tab active"
                        data-tab="security"
                        role="tab"
                        aria-selected="true"
                    >
                        <i data-lucide="lock"></i>
                        <span class="settings-tab-text">Security</span>
                    </button>
                    <button
                        class="settings-tab"
                        data-tab="passkeys"
                        role="tab"
                        aria-selected="false"
                    >
                        <i data-lucide="fingerprint"></i>
                        <span class="settings-tab-text">Passkeys</span>
                    </button>
                    <button class="settings-tab" data-tab="cache" role="tab" aria-selected="false">
                        <i data-lucide="hard-drive"></i>
                        <span class="settings-tab-text">Cache</span>
                    </button>
                    <button class="settings-tab" data-tab="about" role="tab" aria-selected="false">
                        <i data-lucide="info"></i>
                        <span class="settings-tab-text">About</span>
                    </button>
                </div>

                <!-- Settings Panels -->
                <div class="settings-panels">
                    <!-- Security Panel -->
                    <div
                        id="settings-security"
                        class="settings-panel active"
                        role="tabpanel"
                        aria-labelledby="tab-security"
                    >
                        <h3>Change Password</h3>
                        <p class="settings-description">
                            Update your account password. You'll need to log in again on all devices
                            after changing your password.
                        </p>

                        <form id="settings-password-form" class="settings-form">
                            <div class="form-group">
                                <label for="settings-current-password">Current Password</label>
                                <div class="password-input-wrapper">
                                    <input
                                        type="password"
                                        id="settings-current-password"
                                        name="currentPassword"
                                        required
                                        autocomplete="current-password"
                                    />
                                    <button
                                        type="button"
                                        class="password-toggle"
                                        tabindex="-1"
                                        aria-label="Toggle password visibility"
                                    >
                                        <i data-lucide="eye" class="eye-open"></i>
                                        <i data-lucide="eye-off" class="eye-closed hidden"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="settings-new-password">New Password</label>
                                <div class="password-input-wrapper">
                                    <input
                                        type="password"
                                        id="settings-new-password"
                                        name="newPassword"
                                        required
                                        minlength="6"
                                        maxlength="72"
                                        autocomplete="new-password"
                                    />
                                    <button
                                        type="button"
                                        class="password-toggle"
                                        tabindex="-1"
                                        aria-label="Toggle password visibility"
                                    >
                                        <i data-lucide="eye" class="eye-open"></i>
                                        <i data-lucide="eye-off" class="eye-closed hidden"></i>
                                    </button>
                                </div>
                                <span class="hint">6-72 characters</span>
                            </div>

                            <div class="form-group">
                                <label for="settings-confirm-password">Confirm New Password</label>
                                <div class="password-input-wrapper">
                                    <input
                                        type="password"
                                        id="settings-confirm-password"
                                        name="confirmPassword"
                                        required
                                        minlength="6"
                                        maxlength="72"
                                        autocomplete="new-password"
                                    />
                                    <button
                                        type="button"
                                        class="password-toggle"
                                        tabindex="-1"
                                        aria-label="Toggle password visibility"
                                    >
                                        <i data-lucide="eye" class="eye-open"></i>
                                        <i data-lucide="eye-off" class="eye-closed hidden"></i>
                                    </button>
                                </div>
                            </div>

                            <div id="settings-password-error" class="error-message hidden">
                                <span></span>
                            </div>

                            <div id="settings-password-success" class="success-message hidden">
                                <span></span>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    Update Password
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Passkeys Panel -->
                    <div
                        id="settings-passkeys"
                        class="settings-panel"
                        role="tabpanel"
                        aria-labelledby="tab-passkeys"
                    >
                        <h3>Passkeys</h3>
                        <p class="settings-description">
                            Passkeys let you sign in securely using your fingerprint, face, or
                            screen lock instead of a password. You can register multiple passkeys
                            for different devices.
                        </p>

                        <div id="passkeys-not-enabled" class="warning-message hidden">
                            <i data-lucide="alert-triangle" style="width: 18px; height: 18px"></i>
                            <span
                                >WebAuthn is not enabled or is misconfigured on the server. Set the
                                <code>WEBAUTHN_ENABLED</code>, <code>WEBAUTHN_RP_ID</code>, and
                                <code>WEBAUTHN_ORIGINS</code> environment variables correctly first.
                                <a
                                    href="https://djryanj.github.io/media-viewer/admin/webauthn/#configuration"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    >See configuration guide</a
                                >.</span
                            >
                        </div>

                        <div id="passkeys-not-supported" class="info-message hidden">
                            <i data-lucide="info" style="width: 18px; height: 18px"></i>
                            <span
                                >Passkeys are not supported in this browser. Try using a modern
                                browser like Chrome, Safari, or Edge.</span
                            >
                        </div>

                        <div id="passkeys-insecure-context" class="warning-message hidden">
                            <i data-lucide="alert-triangle" style="width: 18px; height: 18px"></i>
                            <span
                                >Passkeys require HTTPS. You're currently accessing Media Viewer
                                over HTTP.
                                <a
                                    href="https://djryanj.github.io/media-viewer/admin/webauthn/#secure-context-requirement"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    >Learn how to set up HTTPS</a
                                >
                                to enable passkey authentication.</span
                            >
                        </div>

                        <div id="passkeys-container">
                            <div id="passkeys-loading" class="settings-loading">
                                <div class="spinner"></div>
                                <span>Loading passkeys...</span>
                            </div>

                            <div id="passkeys-list" class="passkeys-list hidden">
                                <!-- Passkeys will be rendered here -->
                            </div>

                            <div id="passkeys-empty" class="passkeys-empty hidden">
                                <i
                                    data-lucide="fingerprint"
                                    style="width: 48px; height: 48px; stroke-width: 1.5px"
                                ></i>
                                <p>No passkeys registered yet</p>
                                <p class="hint">Add a passkey to enable biometric login</p>
                            </div>

                            <div id="passkeys-error" class="error-message hidden">
                                <span></span>
                            </div>

                            <button
                                type="button"
                                id="add-passkey-btn"
                                class="btn btn-secondary add-passkey-btn"
                            >
                                <i data-lucide="plus"></i>
                                Add Passkey
                            </button>
                        </div>
                    </div>

                    <!-- Cache Panel -->
                    <div
                        id="settings-cache"
                        class="settings-panel"
                        role="tabpanel"
                        aria-labelledby="tab-cache"
                    >
                        <h3>Cache Management</h3>
                        <p class="settings-description">
                            Manage thumbnail cache and media index. Use these options if you're
                            experiencing display issues or have added new media.
                        </p>

                        <div class="cache-actions">
                            <div class="cache-action-card">
                                <div class="cache-action-info">
                                    <h4>Rebuild Thumbnails</h4>
                                    <p>
                                        Regenerate all thumbnail images. This may take a while
                                        depending on your library size.
                                    </p>
                                </div>
                                <button
                                    type="button"
                                    id="rebuild-thumbnails-btn"
                                    class="btn btn-secondary"
                                >
                                    <i data-lucide="refresh-cw"></i>
                                    Rebuild Thumbnails
                                </button>
                            </div>

                            <div class="cache-action-card">
                                <div class="cache-action-info">
                                    <h4>Reindex Media</h4>
                                    <p>
                                        Scan for new, modified, or deleted files. Usually happens
                                        automatically.
                                    </p>
                                </div>
                                <button type="button" id="reindex-btn" class="btn btn-secondary">
                                    <i data-lucide="database-backup"></i>
                                    Reindex Now
                                </button>
                            </div>

                            <div class="cache-action-card">
                                <div class="cache-action-info">
                                    <h4>Clear Transcoded Videos</h4>
                                    <p>Remove cached video transcodes to free up disk space.</p>
                                </div>
                                <button
                                    type="button"
                                    id="clear-transcode-btn"
                                    class="btn btn-secondary"
                                >
                                    <i data-lucide="trash-2"></i>
                                    Clear Cache
                                </button>
                            </div>
                        </div>

                        <div id="cache-status" class="cache-status hidden">
                            <div class="spinner"></div>
                            <span id="cache-status-text">Processing...</span>
                        </div>

                        <div id="cache-success" class="success-message hidden">
                            <span></span>
                        </div>

                        <div id="cache-error" class="error-message hidden">
                            <span></span>
                        </div>
                    </div>

                    <!-- About Panel -->
                    <div
                        id="settings-about"
                        class="settings-panel"
                        role="tabpanel"
                        aria-labelledby="tab-about"
                    >
                        <h3>About Media Viewer</h3>

                        <div class="about-info">
                            <div class="about-logo">
                                <img src="/icons/icon.svg" alt="Media Viewer" />
                            </div>

                            <div class="about-details">
                                <h4>Media Viewer</h4>
                                <p class="version" id="app-version">Version: Loading...</p>

                                <dl class="about-stats">
                                    <dt>Total Files</dt>
                                    <dd id="stats-files">-</dd>
                                    <dt>Images</dt>
                                    <dd id="stats-images">-</dd>
                                    <dt>Videos</dt>
                                    <dd id="stats-videos">-</dd>
                                    <dt>Folders</dt>
                                    <dd id="stats-folders">-</dd>
                                </dl>
                            </div>
                        </div>

                        <div class="about-links">
                            <a
                                href="https://github.com/djryanj/media-viewer"
                                target="_blank"
                                rel="noopener noreferrer"
                                class="about-link"
                            >
                                <i data-lucide="github"></i>
                                View on GitHub
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Passkey Name Modal -->
        <div
            id="passkey-name-modal"
            class="modal hidden"
            role="dialog"
            aria-labelledby="passkey-name-title"
            aria-modal="true"
        >
            <div class="modal-backdrop"></div>
            <div class="modal-content modal-small">
                <div class="modal-header">
                    <h3 id="passkey-name-title">
                        <i data-lucide="fingerprint"></i>
                        Name Your Passkey
                    </h3>
                    <button class="modal-close" id="passkey-name-cancel-x" aria-label="Cancel">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="modal-description">
                        Give this passkey a name to help you identify which device it's for.
                    </p>
                    <div class="form-group">
                        <label for="passkey-name-input">Passkey Name</label>
                        <input
                            type="text"
                            id="passkey-name-input"
                            placeholder="e.g., MacBook Pro, iPhone, Work Laptop"
                            maxlength="50"
                            autocomplete="off"
                        />
                        <span class="hint">This name is only visible to you</span>
                    </div>
                    <div id="passkey-name-error" class="error-message hidden">
                        <i data-lucide="alert-circle"></i>
                        <span></span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="passkey-name-cancel">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="passkey-name-confirm">
                        Continue
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div class="loading hidden" id="loading">
            <div class="spinner"></div>
        </div>

        <!-- Stats Bar -->
        <footer class="stats-bar">
            <div class="stats-bar-inner" id="stats-info"></div>
        </footer>

        <!-- Scripts -->
        <script src="/js/history.js"></script>
        <script src="/js/preferences.js"></script>
        <script src="/js/infinite-scroll.js"></script>
        <script src="/js/infinite-scroll-search.js"></script>
        <script src="/js/gallery.js"></script>
        <script src="/js/favorites.js"></script>
        <script src="/js/search.js"></script>
        <script src="/js/tags.js"></script>
        <script src="/js/wake-lock.js"></script>
        <script src="/js/video-player.js"></script>
        <script src="/js/video-controls.js"></script>
        <script src="/js/lightbox.js"></script>
        <script src="/js/playlist.js"></script>
        <script src="/js/selection.js"></script>
        <script src="/js/tag-tooltip.js"></script>
        <script src="/js/tag-clipboard.js"></script>
        <script src="/js/session.js"></script>
        <script src="/js/webauthn.js"></script>
        <script src="/js/settings.js"></script>
        <script src="/js/app.js"></script>
    </body>
</html>
